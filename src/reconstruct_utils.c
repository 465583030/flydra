/* Generated by Cython 0.9.8.1.1 on Fri Oct 10 19:49:33 2008 */

#define PY_SSIZE_T_CLEAN
#include "Python.h"
#include "structmember.h"
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#ifndef DL_EXPORT
  #define DL_EXPORT(t) t
#endif
#if PY_VERSION_HEX < 0x02040000
  #define METH_COEXIST 0
#endif
#if PY_VERSION_HEX < 0x02050000
  typedef int Py_ssize_t;
  #define PY_SSIZE_T_MAX INT_MAX
  #define PY_SSIZE_T_MIN INT_MIN
  #define PyInt_FromSsize_t(z) PyInt_FromLong(z)
  #define PyInt_AsSsize_t(o)   PyInt_AsLong(o)
  #define PyNumber_Index(o)    PyNumber_Int(o)
  #define PyIndex_Check(o)     PyNumber_Check(o)
#endif
#if PY_VERSION_HEX < 0x02060000
  #define Py_REFCNT(ob) (((PyObject*)(ob))->ob_refcnt)
  #define Py_TYPE(ob)   (((PyObject*)(ob))->ob_type)
  #define Py_SIZE(ob)   (((PyVarObject*)(ob))->ob_size)
  #define PyVarObject_HEAD_INIT(type, size) \
          PyObject_HEAD_INIT(type) size,
  #define PyType_Modified(t)

  typedef struct {
       void *buf;
       Py_ssize_t len;
       int readonly;
       const char *format;
       int ndim;
       Py_ssize_t *shape;
       Py_ssize_t *strides;
       Py_ssize_t *suboffsets;
       Py_ssize_t itemsize;
       void *internal;
  } Py_buffer;

  #define PyBUF_SIMPLE 0
  #define PyBUF_WRITABLE 0x0001
  #define PyBUF_LOCK 0x0002
  #define PyBUF_FORMAT 0x0004
  #define PyBUF_ND 0x0008
  #define PyBUF_STRIDES (0x0010 | PyBUF_ND)
  #define PyBUF_C_CONTIGUOUS (0x0020 | PyBUF_STRIDES)
  #define PyBUF_F_CONTIGUOUS (0x0040 | PyBUF_STRIDES)
  #define PyBUF_ANY_CONTIGUOUS (0x0080 | PyBUF_STRIDES)
  #define PyBUF_INDIRECT (0x0100 | PyBUF_STRIDES)

#endif
#if PY_MAJOR_VERSION < 3
  #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
#else
  #define __Pyx_BUILTIN_MODULE_NAME "builtins"
#endif
#if PY_MAJOR_VERSION >= 3
  #define Py_TPFLAGS_CHECKTYPES 0
  #define Py_TPFLAGS_HAVE_INDEX 0
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBaseString_Type            PyUnicode_Type
  #define PyString_Type                PyBytes_Type
  #define PyInt_Type                   PyLong_Type
  #define PyInt_Check(op)              PyLong_Check(op)
  #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
  #define PyInt_FromString             PyLong_FromString
  #define PyInt_FromUnicode            PyLong_FromUnicode
  #define PyInt_FromLong               PyLong_FromLong
  #define PyInt_FromSize_t             PyLong_FromSize_t
  #define PyInt_FromSsize_t            PyLong_FromSsize_t
  #define PyInt_AsLong                 PyLong_AsLong
  #define PyInt_AS_LONG                PyLong_AS_LONG
  #define PyInt_AsSsize_t              PyLong_AsSsize_t
  #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
  #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
#else
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
  #define PyBytes_Type                 PyString_Type
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyMethod_New(func, self, klass) PyInstanceMethod_New(func)
#endif
#if !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
#else
  #define _USE_MATH_DEFINES
#endif
#ifdef __cplusplus
#define __PYX_EXTERN_C extern "C"
#else
#define __PYX_EXTERN_C extern
#endif
#include <math.h>
#define __PYX_HAVE_API__reconstruct_utils
#include "math.h"


#ifdef __GNUC__
#define INLINE __inline__
#elif _WIN32
#define INLINE __inline
#else
#define INLINE 
#endif

typedef struct {PyObject **p; char *s; long n; char is_unicode; char intern; char is_identifier;} __Pyx_StringTabEntry; /*proto*/



static int __pyx_skip_dispatch = 0;


/* Type Conversion Predeclarations */

#if PY_MAJOR_VERSION < 3
#define __Pyx_PyBytes_FromString PyString_FromString
#define __Pyx_PyBytes_AsString   PyString_AsString
#else
#define __Pyx_PyBytes_FromString PyBytes_FromString
#define __Pyx_PyBytes_AsString   PyBytes_AsString
#endif

#define __Pyx_PyBool_FromLong(b) ((b) ? (Py_INCREF(Py_True), Py_True) : (Py_INCREF(Py_False), Py_False))
static INLINE int __Pyx_PyObject_IsTrue(PyObject* x);
static INLINE PY_LONG_LONG __pyx_PyInt_AsLongLong(PyObject* x);
static INLINE unsigned PY_LONG_LONG __pyx_PyInt_AsUnsignedLongLong(PyObject* x);
static INLINE Py_ssize_t __pyx_PyIndex_AsSsize_t(PyObject* b);

#define __pyx_PyInt_AsLong(x) (PyInt_CheckExact(x) ? PyInt_AS_LONG(x) : PyInt_AsLong(x))
#define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))

static INLINE unsigned char __pyx_PyInt_unsigned_char(PyObject* x);
static INLINE unsigned short __pyx_PyInt_unsigned_short(PyObject* x);
static INLINE char __pyx_PyInt_char(PyObject* x);
static INLINE short __pyx_PyInt_short(PyObject* x);
static INLINE int __pyx_PyInt_int(PyObject* x);
static INLINE long __pyx_PyInt_long(PyObject* x);
static INLINE signed char __pyx_PyInt_signed_char(PyObject* x);
static INLINE signed short __pyx_PyInt_signed_short(PyObject* x);
static INLINE signed int __pyx_PyInt_signed_int(PyObject* x);
static INLINE signed long __pyx_PyInt_signed_long(PyObject* x);
static INLINE long double __pyx_PyInt_long_double(PyObject* x);
#ifdef __GNUC__
/* Test for GCC > 2.95 */
#if __GNUC__ > 2 ||               (__GNUC__ == 2 && (__GNUC_MINOR__ > 95)) 
#define likely(x)   __builtin_expect(!!(x), 1)
#define unlikely(x) __builtin_expect(!!(x), 0)
#else /* __GNUC__ > 2 ... */
#define likely(x)   (x)
#define unlikely(x) (x)
#endif /* __GNUC__ > 2 ... */
#else /* __GNUC__ */
#define likely(x)   (x)
#define unlikely(x) (x)
#endif /* __GNUC__ */
    
static PyObject *__pyx_m;
static PyObject *__pyx_b;
static PyObject *__pyx_empty_tuple;
static int __pyx_lineno;
static int __pyx_clineno = 0;
static const char * __pyx_cfilenm= __FILE__;
static const char *__pyx_filename;
static const char **__pyx_f;

static INLINE int __Pyx_SplitStarArg(PyObject **args, Py_ssize_t nargs, PyObject **args2); /*proto*/

static int __Pyx_CheckKeywordStrings(PyObject *kwdict, const char* function_name, int kw_allowed); /*proto*/

static INLINE void __Pyx_RaiseArgtupleTooLong(Py_ssize_t num_expected, Py_ssize_t num_found); /*proto*/

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list); /*proto*/

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name); /*proto*/

static PyObject *__Pyx_CreateClass(PyObject *bases, PyObject *dict, PyObject *name, char *modname); /*proto*/

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb); /*proto*/

static INLINE PyObject* __Pyx_PyObject_Append(PyObject* L, PyObject* x) {
    if (likely(PyList_CheckExact(L))) {
        if (PyList_Append(L, x) < 0) return NULL;
        Py_INCREF(Py_None);
        return Py_None; // this is just to have an accurate signature
    }
    else {
        return PyObject_CallMethod(L, "append", "(O)", x);
    }
}

static PyObject *__Pyx_UnpackItem(PyObject *, Py_ssize_t index); /*proto*/
static int __Pyx_EndUnpack(PyObject *); /*proto*/

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb); /*proto*/

static INLINE PyObject *__Pyx_GetItemInt(PyObject *o, Py_ssize_t i, int is_unsigned) {
    PyObject *r;
    if (PyList_CheckExact(o) && 0 <= i && i < PyList_GET_SIZE(o)) {
        r = PyList_GET_ITEM(o, i);
        Py_INCREF(r);
    }
    else if (PyTuple_CheckExact(o) && 0 <= i && i < PyTuple_GET_SIZE(o)) {
        r = PyTuple_GET_ITEM(o, i);
        Py_INCREF(r);
    }
    else if (Py_TYPE(o)->tp_as_sequence && Py_TYPE(o)->tp_as_sequence->sq_item && (likely(i >= 0) || !is_unsigned))
        r = PySequence_GetItem(o, i);
    else {
        PyObject *j = (likely(i >= 0) || !is_unsigned) ? PyInt_FromLong(i) : PyLong_FromUnsignedLongLong((sizeof(unsigned long long) > sizeof(Py_ssize_t) ? (1ULL << (sizeof(Py_ssize_t)*8)) : 0) + i);
        if (!j)
            return 0;
        r = PyObject_GetItem(o, j);
        Py_DECREF(j);
    }
    return r;
}

static int __Pyx_Print(PyObject *, int); /*proto*/
#if PY_MAJOR_VERSION >= 3
static PyObject* __pyx_print = 0;
static PyObject* __pyx_print_kwargs = 0;
#endif

static INLINE int __Pyx_SetItemInt(PyObject *o, Py_ssize_t i, PyObject *v, int is_unsigned) {
    int r;
    if (PyList_CheckExact(o) && 0 <= i && i < PyList_GET_SIZE(o)) {
        Py_DECREF(PyList_GET_ITEM(o, i));
        Py_INCREF(v);
        PyList_SET_ITEM(o, i, v);
        return 1;
    }
    else if (Py_TYPE(o)->tp_as_sequence && Py_TYPE(o)->tp_as_sequence->sq_ass_item && (likely(i >= 0) || !is_unsigned))
        r = PySequence_SetItem(o, i, v);
    else {
        PyObject *j = (likely(i >= 0) || !is_unsigned) ? PyInt_FromLong(i) : PyLong_FromUnsignedLongLong((sizeof(unsigned long long) > sizeof(Py_ssize_t) ? (1ULL << (sizeof(Py_ssize_t)*8)) : 0) + i);
        if (!j)
            return -1;
        r = PyObject_SetItem(o, j, v);
        Py_DECREF(j);
    }
    return r;
}

static void __Pyx_AddTraceback(const char *funcname); /*proto*/

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t); /*proto*/

/* Type declarations */

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":51
 *     return ReconstructHelper(*args,**kw)
 * 
 * cdef class ReconstructHelper:             # <<<<<<<<<<<<<<
 *     cdef readonly double fc1, fc2, cc1, cc2
 *     cdef readonly double k1, k2, p1, p2
 */

struct __pyx_obj_17reconstruct_utils_ReconstructHelper {
  PyObject_HEAD
  double fc1;
  double fc2;
  double cc1;
  double cc2;
  double k1;
  double k2;
  double p1;
  double p2;
  double alpha_c;
};
/* Module declarations from reconstruct_utils */

static PyTypeObject *__pyx_ptype_17reconstruct_utils_ReconstructHelper = 0;
static double __pyx_v_17reconstruct_utils_cinf;
static float __pyx_v_17reconstruct_utils_MINIMUM_ECCENTRICITY;


/* Implementation of reconstruct_utils */
static char __pyx_k_5[] = "*";
static PyObject *__pyx_int_0;
static PyObject *__pyx_int_1;
static PyObject *__pyx_int_2;
static PyObject *__pyx_int_5;
static PyObject *__pyx_int_3;
static PyObject *__pyx_int_4;
static PyObject *__pyx_int_neg_1;
static char __pyx_k___init__[] = "__init__";
static PyObject *__pyx_kp___init__;
static char __pyx_k___reduce__[] = "__reduce__";
static PyObject *__pyx_kp___reduce__;
static char __pyx_k_add_element[] = "add_element";
static PyObject *__pyx_kp_add_element;
static char __pyx_k_save_to_rad_file[] = "save_to_rad_file";
static PyObject *__pyx_kp_save_to_rad_file;
static char __pyx_k___richcmp__[] = "__richcmp__";
static PyObject *__pyx_kp___richcmp__;
static char __pyx_k_get_K[] = "get_K";
static PyObject *__pyx_kp_get_K;
static char __pyx_k_get_nlparams[] = "get_nlparams";
static PyObject *__pyx_kp_get_nlparams;
static char __pyx_k_undistort[] = "undistort";
static PyObject *__pyx_kp_undistort;
static char __pyx_k_distort[] = "distort";
static PyObject *__pyx_kp_distort;
static char __pyx_k_undistort_image[] = "undistort_image";
static PyObject *__pyx_kp_undistort_image;
static char __pyx_k_numpy[] = "numpy";
static PyObject *__pyx_kp_numpy;
static char __pyx_k_1[] = "numpy.dual";
static PyObject *__pyx_kp_1;
static char __pyx_k_inf[] = "inf";
static PyObject *__pyx_kp_inf;
static char __pyx_k_2[] = "flydra.common_variables";
static PyObject *__pyx_kp_2;
static char __pyx_k_flydra[] = "flydra";
static PyObject *__pyx_kp_flydra;
static char __pyx_k_3[] = "flydra.undistort";
static PyObject *__pyx_kp_3;
static char __pyx_k_4[] = "xml.etree.ElementTree";
static PyObject *__pyx_kp_4;
static char __pyx_k_ET[] = "ET";
static PyObject *__pyx_kp_ET;
static char __pyx_k_common_variables[] = "common_variables";
static PyObject *__pyx_kp_common_variables;
static char __pyx_k_6[] = "MINIMUM_ECCENTRICITY";
static PyObject *__pyx_kp_6;
static char __pyx_k_7[] = "NoAcceptablePointFound";
static PyObject *__pyx_kp_7;
static char __pyx_k_Exception[] = "Exception";
static PyObject *__pyx_kp_Exception;
static char __pyx_k_8[] = "hypothesis_testing_algorithm__find_best_3d";
static PyObject *__pyx_kp_8;
static char __pyx_k_9[] = "find_best_3d";
static PyObject *__pyx_kp_9;
static char __pyx_k_execfile[] = "execfile";
static PyObject *__pyx_kp_execfile;
static char __pyx_k_10[] = "K12";
static PyObject *__pyx_kp_10;
static char __pyx_k_NotImplementedError[] = "NotImplementedError";
static PyObject *__pyx_kp_NotImplementedError;
static char __pyx_k_12[] = "K11";
static PyObject *__pyx_kp_12;
static char __pyx_k_13[] = "K22";
static PyObject *__pyx_kp_13;
static char __pyx_k_14[] = "K13";
static PyObject *__pyx_kp_14;
static char __pyx_k_15[] = "K23";
static PyObject *__pyx_kp_15;
static char __pyx_k_16[] = "kc1";
static PyObject *__pyx_kp_16;
static char __pyx_k_17[] = "kc2";
static PyObject *__pyx_kp_17;
static char __pyx_k_18[] = "kc3";
static PyObject *__pyx_kp_18;
static char __pyx_k_19[] = "kc4";
static PyObject *__pyx_kp_19;
static char __pyx_k_iselement[] = "iselement";
static PyObject *__pyx_kp_iselement;
static char __pyx_k_tag[] = "tag";
static PyObject *__pyx_kp_tag;
static char __pyx_k_20[] = "non_linear_parameters";
static PyObject *__pyx_kp_20;
static char __pyx_k_21[] = "fc1";
static PyObject *__pyx_kp_21;
static char __pyx_k_22[] = "fc2";
static PyObject *__pyx_kp_22;
static char __pyx_k_23[] = "cc1";
static PyObject *__pyx_kp_23;
static char __pyx_k_24[] = "cc2";
static PyObject *__pyx_kp_24;
static char __pyx_k_25[] = "k1";
static PyObject *__pyx_kp_25;
static char __pyx_k_26[] = "k2";
static PyObject *__pyx_kp_26;
static char __pyx_k_27[] = "p1";
static PyObject *__pyx_kp_27;
static char __pyx_k_28[] = "p2";
static PyObject *__pyx_kp_28;
static char __pyx_k_29[] = "alpha_c";
static PyObject *__pyx_kp_29;
static char __pyx_k_append[] = "append";
static PyObject *__pyx_kp_append;
static char __pyx_k_find[] = "find";
static PyObject *__pyx_kp_find;
static char __pyx_k_text[] = "text";
static PyObject *__pyx_kp_text;
static char __pyx_k_30[] = "make_ReconstructHelper";
static PyObject *__pyx_kp_30;
static char __pyx_k_SubElement[] = "SubElement";
static PyObject *__pyx_kp_SubElement;
static char __pyx_k_31[] = "non_linear_parameters";
static PyObject *__pyx_kp_31;
static char __pyx_k_32[] = "fc1";
static PyObject *__pyx_kp_32;
static char __pyx_k_33[] = "fc2";
static PyObject *__pyx_kp_33;
static char __pyx_k_34[] = "cc1";
static PyObject *__pyx_kp_34;
static char __pyx_k_35[] = "cc2";
static PyObject *__pyx_kp_35;
static char __pyx_k_36[] = "k1";
static PyObject *__pyx_kp_36;
static char __pyx_k_37[] = "k2";
static PyObject *__pyx_kp_37;
static char __pyx_k_38[] = "p1";
static PyObject *__pyx_kp_38;
static char __pyx_k_39[] = "p2";
static PyObject *__pyx_kp_39;
static char __pyx_k_40[] = "alpha_c";
static PyObject *__pyx_kp_40;
static char __pyx_k_open[] = "open";
static PyObject *__pyx_kp_open;
static char __pyx_k_41[] = "w";
static PyObject *__pyx_kp_41;
static char __pyx_k_write[] = "write";
static PyObject *__pyx_kp_write;
static char __pyx_k_close[] = "close";
static PyObject *__pyx_kp_close;
static char __pyx_k_allclose[] = "allclose";
static PyObject *__pyx_kp_allclose;
static char __pyx_k_array[] = "array";
static PyObject *__pyx_kp_array;
static char __pyx_k_shape[] = "shape";
static PyObject *__pyx_kp_shape;
static char __pyx_k_dtype[] = "dtype";
static PyObject *__pyx_kp_dtype;
static char __pyx_k_59[] = "uint8";
static PyObject *__pyx_kp_59;
static char __pyx_k_rect[] = "rect";
static PyObject *__pyx_kp_rect;
static char __pyx_k_f[] = "f";
static PyObject *__pyx_kp_f;
static char __pyx_k_c[] = "c";
static PyObject *__pyx_kp_c;
static char __pyx_k_k[] = "k";
static PyObject *__pyx_kp_k;
static char __pyx_k_astype[] = "astype";
static PyObject *__pyx_kp_astype;
static char __pyx_k_dual[] = "dual";
static PyObject *__pyx_kp_dual;
static char __pyx_k_svd[] = "svd";
static PyObject *__pyx_kp_svd;
static char __pyx_k_cam_ids[] = "cam_ids";
static PyObject *__pyx_kp_cam_ids;
static char __pyx_k_min[] = "min";
static PyObject *__pyx_kp_min;
static char __pyx_k_zeros[] = "zeros";
static PyObject *__pyx_kp_zeros;
static char __pyx_k_60[] = "float64";
static PyObject *__pyx_kp_60;
static char __pyx_k_Pmat[] = "Pmat";
static PyObject *__pyx_kp_Pmat;
static char __pyx_k_enumerate[] = "enumerate";
static PyObject *__pyx_kp_enumerate;
static char __pyx_k_KeyError[] = "KeyError";
static PyObject *__pyx_kp_KeyError;
static char __pyx_k_62[] = "cam_combinations_by_size";
static PyObject *__pyx_kp_62;
static char __pyx_k_extend[] = "extend";
static PyObject *__pyx_kp_extend;
static char __pyx_k_dot[] = "dot";
static PyObject *__pyx_kp_dot;
static char __pyx_k_isnan[] = "isnan";
static PyObject *__pyx_kp_isnan;
static char __pyx_k_full_matrices[] = "full_matrices";
static PyObject *__pyx_kp_full_matrices;
static char __pyx_k_linalg[] = "linalg";
static PyObject *__pyx_kp_linalg;
static char __pyx_k_LinAlgError[] = "LinAlgError";
static PyObject *__pyx_kp_LinAlgError;
static PyObject *__pyx_kp_5;
static PyObject *__pyx_builtin_Exception;
static PyObject *__pyx_builtin_execfile;
static PyObject *__pyx_builtin_NotImplementedError;
static PyObject *__pyx_builtin_open;
static PyObject *__pyx_builtin_min;
static PyObject *__pyx_builtin_enumerate;
static PyObject *__pyx_builtin_KeyError;
static PyObject *__pyx_kp_11;
static char __pyx_k_11[] = "need to properly roundtrip alpha_c != 0";
static PyObject *__pyx_kp_42;
static PyObject *__pyx_kp_43;
static PyObject *__pyx_kp_44;
static PyObject *__pyx_kp_45;
static PyObject *__pyx_kp_46;
static PyObject *__pyx_kp_47;
static PyObject *__pyx_kp_48;
static PyObject *__pyx_kp_49;
static PyObject *__pyx_kp_50;
static PyObject *__pyx_kp_51;
static PyObject *__pyx_kp_52;
static PyObject *__pyx_kp_53;
static PyObject *__pyx_kp_54;
static PyObject *__pyx_kp_55;
static PyObject *__pyx_kp_56;
static PyObject *__pyx_kp_57;
static PyObject *__pyx_kp_58;
static char __pyx_k_42[] = "K11 = %s;\n";
static char __pyx_k_43[] = "K12 = %s;\n";
static char __pyx_k_44[] = "K13 = %s;\n";
static char __pyx_k_45[] = "K21 = %s;\n";
static char __pyx_k_46[] = "K22 = %s;\n";
static char __pyx_k_47[] = "K23 = %s;\n";
static char __pyx_k_48[] = "K31 = %s;\n";
static char __pyx_k_49[] = "K32 = %s;\n";
static char __pyx_k_50[] = "K33 = %s;\n";
static char __pyx_k_51[] = "\n";
static char __pyx_k_52[] = "kc1 = %s;\n";
static char __pyx_k_53[] = "kc2 = %s;\n";
static char __pyx_k_54[] = "kc3 = %s;\n";
static char __pyx_k_55[] = "kc4 = %s;\n";
static char __pyx_k_56[] = "\n";
static char __pyx_k_57[] = "comments = '%s';\n";
static char __pyx_k_58[] = "\n";
static PyObject *__pyx_kp_61;
static PyObject *__pyx_kp_63;
static PyObject *__pyx_kp_64;
static PyObject *__pyx_kp_65;
static PyObject *__pyx_kp_66;
static PyObject *__pyx_kp_67;
static PyObject *__pyx_kp_68;
static char __pyx_k_61[] = "HYPOTHESIS TEST -    shorting for n_cams %d (this=%f, ACCEPTABLE_DISTANCE_PIXELS=%f)";
static char __pyx_k_63[] = "HYPOTHESIS TEST - mean_dist = %f for cam_ids_used = %s (always pt 0)";
static char __pyx_k_64[] = "HYPOTHESIS TEST - least_err, ACCEPTABLE_DISTANCE_PIXELS: %f, %f";
static char __pyx_k_65[] = "least error was %f";
static char __pyx_k_66[] = "HYPOTHESIS TEST - n_cams %d: %f";
static char __pyx_k_67[] = "SVD error, P=";
static char __pyx_k_68[] = "Error on P";

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":27
 *     int isinf(double x)
 * 
 * def make_ReconstructHelper_from_rad_file(filename):             # <<<<<<<<<<<<<<
 *     params = {}
 *     execfile(filename,params)
 */

static PyObject *__pyx_pf_17reconstruct_utils_make_ReconstructHelper_from_rad_file(PyObject *__pyx_self, PyObject *__pyx_v_filename); /*proto*/
static PyObject *__pyx_pf_17reconstruct_utils_make_ReconstructHelper_from_rad_file(PyObject *__pyx_self, PyObject *__pyx_v_filename) {
  PyObject *__pyx_v_params;
  PyObject *__pyx_v_helper;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  int __pyx_3;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  PyObject *__pyx_9 = 0;
  PyObject *__pyx_10 = 0;
  __pyx_self = __pyx_self;
  __pyx_v_params = Py_None; Py_INCREF(Py_None);
  __pyx_v_helper = Py_None; Py_INCREF(Py_None);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":28
 * 
 * def make_ReconstructHelper_from_rad_file(filename):
 *     params = {}             # <<<<<<<<<<<<<<
 *     execfile(filename,params)
 *     if params['K12'] != 0:
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 28; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_params);
  __pyx_v_params = ((PyObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":29
 * def make_ReconstructHelper_from_rad_file(filename):
 *     params = {}
 *     execfile(filename,params)             # <<<<<<<<<<<<<<
 *     if params['K12'] != 0:
 *         raise NotImplementedError('need to properly roundtrip alpha_c != 0')
 */
  __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_filename);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_filename);
  Py_INCREF(__pyx_v_params);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_v_params);
  __pyx_2 = PyObject_Call(__pyx_builtin_execfile, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":30
 *     params = {}
 *     execfile(filename,params)
 *     if params['K12'] != 0:             # <<<<<<<<<<<<<<
 *         raise NotImplementedError('need to properly roundtrip alpha_c != 0')
 *     helper = ReconstructHelper(
 */
  __pyx_1 = PyObject_GetItem(__pyx_v_params, __pyx_kp_10); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyObject_RichCompare(__pyx_1, __pyx_int_0, Py_NE); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_3 = __Pyx_PyObject_IsTrue(__pyx_2); if (unlikely(__pyx_3 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 30; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  if (__pyx_3) {

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":31
 *     execfile(filename,params)
 *     if params['K12'] != 0:
 *         raise NotImplementedError('need to properly roundtrip alpha_c != 0')             # <<<<<<<<<<<<<<
 *     helper = ReconstructHelper(
 *         params['K11'], params['K22'], params['K13'], params['K23'],
 */
    __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_INCREF(__pyx_kp_11);
    PyTuple_SET_ITEM(__pyx_1, 0, __pyx_kp_11);
    __pyx_2 = PyObject_Call(__pyx_builtin_NotImplementedError, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    __Pyx_Raise(__pyx_2, 0, 0);
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":33
 *         raise NotImplementedError('need to properly roundtrip alpha_c != 0')
 *     helper = ReconstructHelper(
 *         params['K11'], params['K22'], params['K13'], params['K23'],             # <<<<<<<<<<<<<<
 *         params['kc1'], params['kc2'], params['kc3'], params['kc4'])
 *     return helper
 */
  __pyx_1 = PyObject_GetItem(__pyx_v_params, __pyx_kp_12); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyObject_GetItem(__pyx_v_params, __pyx_kp_13); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyObject_GetItem(__pyx_v_params, __pyx_kp_14); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_5 = PyObject_GetItem(__pyx_v_params, __pyx_kp_15); if (!__pyx_5) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":34
 *     helper = ReconstructHelper(
 *         params['K11'], params['K22'], params['K13'], params['K23'],
 *         params['kc1'], params['kc2'], params['kc3'], params['kc4'])             # <<<<<<<<<<<<<<
 *     return helper
 * 
 */
  __pyx_6 = PyObject_GetItem(__pyx_v_params, __pyx_kp_16); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_7 = PyObject_GetItem(__pyx_v_params, __pyx_kp_17); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_8 = PyObject_GetItem(__pyx_v_params, __pyx_kp_18); if (!__pyx_8) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_9 = PyObject_GetItem(__pyx_v_params, __pyx_kp_19); if (!__pyx_9) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 34; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_10 = PyTuple_New(8); if (unlikely(!__pyx_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_10, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_10, 1, __pyx_2);
  PyTuple_SET_ITEM(__pyx_10, 2, __pyx_4);
  PyTuple_SET_ITEM(__pyx_10, 3, __pyx_5);
  PyTuple_SET_ITEM(__pyx_10, 4, __pyx_6);
  PyTuple_SET_ITEM(__pyx_10, 5, __pyx_7);
  PyTuple_SET_ITEM(__pyx_10, 6, __pyx_8);
  PyTuple_SET_ITEM(__pyx_10, 7, __pyx_9);
  __pyx_1 = 0;
  __pyx_2 = 0;
  __pyx_4 = 0;
  __pyx_5 = 0;
  __pyx_6 = 0;
  __pyx_7 = 0;
  __pyx_8 = 0;
  __pyx_9 = 0;
  __pyx_1 = PyObject_Call(((PyObject*)__pyx_ptype_17reconstruct_utils_ReconstructHelper), ((PyObject *)__pyx_10), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 32; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_10)); __pyx_10 = 0;
  Py_DECREF(__pyx_v_helper);
  __pyx_v_helper = __pyx_1;
  __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":35
 *         params['K11'], params['K22'], params['K13'], params['K23'],
 *         params['kc1'], params['kc2'], params['kc3'], params['kc4'])
 *     return helper             # <<<<<<<<<<<<<<
 * 
 * def ReconstructHelper_from_xml(elem):
 */
  Py_INCREF(__pyx_v_helper);
  __pyx_r = __pyx_v_helper;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  Py_XDECREF(__pyx_9);
  Py_XDECREF(__pyx_10);
  __Pyx_AddTraceback("reconstruct_utils.make_ReconstructHelper_from_rad_file");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_params);
  Py_DECREF(__pyx_v_helper);
  return __pyx_r;
}

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":37
 *     return helper
 * 
 * def ReconstructHelper_from_xml(elem):             # <<<<<<<<<<<<<<
 *     assert ET.iselement(elem)
 *     assert elem.tag == "non_linear_parameters"
 */

static PyObject *__pyx_pf_17reconstruct_utils_ReconstructHelper_from_xml(PyObject *__pyx_self, PyObject *__pyx_v_elem); /*proto*/
static PyObject *__pyx_pf_17reconstruct_utils_ReconstructHelper_from_xml(PyObject *__pyx_self, PyObject *__pyx_v_elem) {
  PyObject *__pyx_v_args;
  PyObject *__pyx_v_name;
  PyObject *__pyx_v_helper;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  Py_ssize_t __pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  __pyx_self = __pyx_self;
  __pyx_v_args = Py_None; Py_INCREF(Py_None);
  __pyx_v_name = Py_None; Py_INCREF(Py_None);
  __pyx_v_helper = Py_None; Py_INCREF(Py_None);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":38
 * 
 * def ReconstructHelper_from_xml(elem):
 *     assert ET.iselement(elem)             # <<<<<<<<<<<<<<
 *     assert elem.tag == "non_linear_parameters"
 * 
 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_ET); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_iselement); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_elem);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_elem);
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_4 = __Pyx_PyObject_IsTrue(__pyx_3); if (unlikely(__pyx_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (unlikely(!__pyx_4)) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 38; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  #endif

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":39
 * def ReconstructHelper_from_xml(elem):
 *     assert ET.iselement(elem)
 *     assert elem.tag == "non_linear_parameters"             # <<<<<<<<<<<<<<
 * 
 *     args = []
 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_2 = PyObject_GetAttr(__pyx_v_elem, __pyx_kp_tag); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyObject_RichCompare(__pyx_2, __pyx_kp_20, Py_EQ); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_4 = __Pyx_PyObject_IsTrue(__pyx_1); if (unlikely(__pyx_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (unlikely(!__pyx_4)) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 39; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  #endif

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":41
 *     assert elem.tag == "non_linear_parameters"
 * 
 *     args = []             # <<<<<<<<<<<<<<
 *     for name in ['fc1','fc2','cc1','cc2','k1','k2','p1','p2','alpha_c']:
 *         args.append( float(elem.find(name).text) )
 */
  __pyx_3 = PyList_New(0); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 41; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_args);
  __pyx_v_args = ((PyObject *)__pyx_3);
  __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":42
 * 
 *     args = []
 *     for name in ['fc1','fc2','cc1','cc2','k1','k2','p1','p2','alpha_c']:             # <<<<<<<<<<<<<<
 *         args.append( float(elem.find(name).text) )
 *     args = tuple(args)
 */
  __pyx_2 = PyList_New(9); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_kp_21);
  PyList_SET_ITEM(__pyx_2, 0, __pyx_kp_21);
  Py_INCREF(__pyx_kp_22);
  PyList_SET_ITEM(__pyx_2, 1, __pyx_kp_22);
  Py_INCREF(__pyx_kp_23);
  PyList_SET_ITEM(__pyx_2, 2, __pyx_kp_23);
  Py_INCREF(__pyx_kp_24);
  PyList_SET_ITEM(__pyx_2, 3, __pyx_kp_24);
  Py_INCREF(__pyx_kp_25);
  PyList_SET_ITEM(__pyx_2, 4, __pyx_kp_25);
  Py_INCREF(__pyx_kp_26);
  PyList_SET_ITEM(__pyx_2, 5, __pyx_kp_26);
  Py_INCREF(__pyx_kp_27);
  PyList_SET_ITEM(__pyx_2, 6, __pyx_kp_27);
  Py_INCREF(__pyx_kp_28);
  PyList_SET_ITEM(__pyx_2, 7, __pyx_kp_28);
  Py_INCREF(__pyx_kp_29);
  PyList_SET_ITEM(__pyx_2, 8, __pyx_kp_29);
  if (PyList_CheckExact(((PyObject *)__pyx_2)) || PyTuple_CheckExact(((PyObject *)__pyx_2))) {
    __pyx_5 = 0; __pyx_1 = ((PyObject *)__pyx_2); Py_INCREF(__pyx_1);
  } else {
    __pyx_5 = -1; __pyx_1 = PyObject_GetIter(((PyObject *)__pyx_2)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_1))) {
      if (__pyx_5 >= PyList_GET_SIZE(__pyx_1)) break;
      __pyx_3 = PyList_GET_ITEM(__pyx_1, __pyx_5); Py_INCREF(__pyx_3); __pyx_5++;
    } else if (likely(PyTuple_CheckExact(__pyx_1))) {
      if (__pyx_5 >= PyTuple_GET_SIZE(__pyx_1)) break;
      __pyx_3 = PyTuple_GET_ITEM(__pyx_1, __pyx_5); Py_INCREF(__pyx_3); __pyx_5++;
    } else {
      __pyx_3 = PyIter_Next(__pyx_1);
      if (!__pyx_3) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 42; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
    }
    Py_DECREF(__pyx_v_name);
    __pyx_v_name = __pyx_3;
    __pyx_3 = 0;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":43
 *     args = []
 *     for name in ['fc1','fc2','cc1','cc2','k1','k2','p1','p2','alpha_c']:
 *         args.append( float(elem.find(name).text) )             # <<<<<<<<<<<<<<
 *     args = tuple(args)
 *     helper = ReconstructHelper(*args)
 */
    __pyx_2 = PyObject_GetAttr(__pyx_v_elem, __pyx_kp_find); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_3 = PyTuple_New(1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_INCREF(__pyx_v_name);
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_name);
    __pyx_6 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
    __pyx_2 = PyObject_GetAttr(__pyx_6, __pyx_kp_text); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    __pyx_3 = PyTuple_New(1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_2);
    __pyx_2 = 0;
    __pyx_6 = PyObject_Call(((PyObject*)&PyFloat_Type), ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
    __pyx_2 = __Pyx_PyObject_Append(__pyx_v_args, __pyx_6); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 43; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;
  }
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":44
 *     for name in ['fc1','fc2','cc1','cc2','k1','k2','p1','p2','alpha_c']:
 *         args.append( float(elem.find(name).text) )
 *     args = tuple(args)             # <<<<<<<<<<<<<<
 *     helper = ReconstructHelper(*args)
 *     return helper
 */
  __pyx_3 = PyTuple_New(1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_args);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_args);
  __pyx_6 = PyObject_Call(((PyObject*)&PyTuple_Type), ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 44; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
  Py_DECREF(__pyx_v_args);
  __pyx_v_args = __pyx_6;
  __pyx_6 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":45
 *         args.append( float(elem.find(name).text) )
 *     args = tuple(args)
 *     helper = ReconstructHelper(*args)             # <<<<<<<<<<<<<<
 *     return helper
 * 
 */
  __pyx_2 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyObject_Call(((PyObject*)__pyx_ptype_17reconstruct_utils_ReconstructHelper), __pyx_2, NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 45; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_v_helper);
  __pyx_v_helper = __pyx_1;
  __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":46
 *     args = tuple(args)
 *     helper = ReconstructHelper(*args)
 *     return helper             # <<<<<<<<<<<<<<
 * 
 * def make_ReconstructHelper(*args,**kw):
 */
  Py_INCREF(__pyx_v_helper);
  __pyx_r = __pyx_v_helper;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper_from_xml");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_name);
  Py_DECREF(__pyx_v_helper);
  return __pyx_r;
}

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":48
 *     return helper
 * 
 * def make_ReconstructHelper(*args,**kw):             # <<<<<<<<<<<<<<
 *     return ReconstructHelper(*args,**kw)
 * 
 */

static PyObject *__pyx_pf_17reconstruct_utils_make_ReconstructHelper(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_17reconstruct_utils_make_ReconstructHelper(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_args = 0;
  PyObject *__pyx_v_kw = 0;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  __pyx_self = __pyx_self;
  if (unlikely(__pyx_kwds)) {
    if (unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "make_ReconstructHelper", 1))) return NULL;
  }
  __pyx_v_kw = (__pyx_kwds) ? PyDict_Copy(__pyx_kwds) : PyDict_New();
  if (unlikely(!__pyx_v_kw)) return NULL;
  Py_INCREF(__pyx_args);
  __pyx_v_args = __pyx_args;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":49
 * 
 * def make_ReconstructHelper(*args,**kw):
 *     return ReconstructHelper(*args,**kw)             # <<<<<<<<<<<<<<
 * 
 * cdef class ReconstructHelper:
 */
  __pyx_1 = PySequence_Tuple(__pyx_v_args); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyEval_CallObjectWithKeywords(((PyObject*)__pyx_ptype_17reconstruct_utils_ReconstructHelper), __pyx_1, __pyx_v_kw); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 49; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_r = __pyx_2;
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  __Pyx_AddTraceback("reconstruct_utils.make_ReconstructHelper");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_args);
  Py_DECREF(__pyx_v_kw);
  return __pyx_r;
}

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":56
 *     cdef readonly double alpha_c
 * 
 *     def __init__(self, fc1, fc2, cc1, cc2, k1, k2, p1, p2, alpha_c=0 ):             # <<<<<<<<<<<<<<
 *         """create instance of ReconstructHelper
 * 
 */

static int __pyx_pf_17reconstruct_utils_17ReconstructHelper___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_17reconstruct_utils_17ReconstructHelper___init__[] = "create instance of ReconstructHelper\n\n        ReconstructHelper(fc1, fc2, cc1, cc2, k1, k2, p1, p2 )\n        where:\n        fc - focal length\n        cc - camera center\n        k - radial distortion parameters (non-linear)\n        p - tangential distortion parameters (non-linear)\n        alpha_c - skew between X and Y pixel axes\n        ";
static int __pyx_pf_17reconstruct_utils_17ReconstructHelper___init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_fc1 = 0;
  PyObject *__pyx_v_fc2 = 0;
  PyObject *__pyx_v_cc1 = 0;
  PyObject *__pyx_v_cc2 = 0;
  PyObject *__pyx_v_k1 = 0;
  PyObject *__pyx_v_k2 = 0;
  PyObject *__pyx_v_p1 = 0;
  PyObject *__pyx_v_p2 = 0;
  PyObject *__pyx_v_alpha_c = 0;
  int __pyx_r;
  double __pyx_1;
  static char *__pyx_argnames[] = {"fc1","fc2","cc1","cc2","k1","k2","p1","p2","alpha_c",0};
  __pyx_v_alpha_c = __pyx_int_0;
  if (likely(!__pyx_kwds) && likely(8 <= PyTuple_GET_SIZE(__pyx_args)) && likely(PyTuple_GET_SIZE(__pyx_args) <= 9)) {
    __pyx_v_fc1 = PyTuple_GET_ITEM(__pyx_args, 0);
    __pyx_v_fc2 = PyTuple_GET_ITEM(__pyx_args, 1);
    __pyx_v_cc1 = PyTuple_GET_ITEM(__pyx_args, 2);
    __pyx_v_cc2 = PyTuple_GET_ITEM(__pyx_args, 3);
    __pyx_v_k1 = PyTuple_GET_ITEM(__pyx_args, 4);
    __pyx_v_k2 = PyTuple_GET_ITEM(__pyx_args, 5);
    __pyx_v_p1 = PyTuple_GET_ITEM(__pyx_args, 6);
    __pyx_v_p2 = PyTuple_GET_ITEM(__pyx_args, 7);
    if (PyTuple_GET_SIZE(__pyx_args) > 8) {
      __pyx_v_alpha_c = PyTuple_GET_ITEM(__pyx_args, 8);
    }
  }
  else {
    if (unlikely(!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OOOOOOOO|O", __pyx_argnames, &__pyx_v_fc1, &__pyx_v_fc2, &__pyx_v_cc1, &__pyx_v_cc2, &__pyx_v_k1, &__pyx_v_k2, &__pyx_v_p1, &__pyx_v_p2, &__pyx_v_alpha_c))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 56; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4;
  __pyx_L3_error:;
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.__init__");
  return -1;
  __pyx_L4:;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":67
 *         alpha_c - skew between X and Y pixel axes
 *         """
 *         self.fc1 = fc1             # <<<<<<<<<<<<<<
 *         self.fc2 = fc2
 *         self.cc1 = cc1
 */
  __pyx_1 = __pyx_PyFloat_AsDouble(__pyx_v_fc1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 67; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc1 = __pyx_1;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":68
 *         """
 *         self.fc1 = fc1
 *         self.fc2 = fc2             # <<<<<<<<<<<<<<
 *         self.cc1 = cc1
 *         self.cc2 = cc2
 */
  __pyx_1 = __pyx_PyFloat_AsDouble(__pyx_v_fc2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 68; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc2 = __pyx_1;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":69
 *         self.fc1 = fc1
 *         self.fc2 = fc2
 *         self.cc1 = cc1             # <<<<<<<<<<<<<<
 *         self.cc2 = cc2
 *         self.k1 = k1
 */
  __pyx_1 = __pyx_PyFloat_AsDouble(__pyx_v_cc1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 69; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc1 = __pyx_1;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":70
 *         self.fc2 = fc2
 *         self.cc1 = cc1
 *         self.cc2 = cc2             # <<<<<<<<<<<<<<
 *         self.k1 = k1
 *         self.k2 = k2
 */
  __pyx_1 = __pyx_PyFloat_AsDouble(__pyx_v_cc2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 70; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc2 = __pyx_1;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":71
 *         self.cc1 = cc1
 *         self.cc2 = cc2
 *         self.k1 = k1             # <<<<<<<<<<<<<<
 *         self.k2 = k2
 *         self.p1 = p1
 */
  __pyx_1 = __pyx_PyFloat_AsDouble(__pyx_v_k1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 71; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->k1 = __pyx_1;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":72
 *         self.cc2 = cc2
 *         self.k1 = k1
 *         self.k2 = k2             # <<<<<<<<<<<<<<
 *         self.p1 = p1
 *         self.p2 = p2
 */
  __pyx_1 = __pyx_PyFloat_AsDouble(__pyx_v_k2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->k2 = __pyx_1;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":73
 *         self.k1 = k1
 *         self.k2 = k2
 *         self.p1 = p1             # <<<<<<<<<<<<<<
 *         self.p2 = p2
 *         self.alpha_c = alpha_c
 */
  __pyx_1 = __pyx_PyFloat_AsDouble(__pyx_v_p1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 73; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p1 = __pyx_1;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":74
 *         self.k2 = k2
 *         self.p1 = p1
 *         self.p2 = p2             # <<<<<<<<<<<<<<
 *         self.alpha_c = alpha_c
 * 
 */
  __pyx_1 = __pyx_PyFloat_AsDouble(__pyx_v_p2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 74; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p2 = __pyx_1;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":75
 *         self.p1 = p1
 *         self.p2 = p2
 *         self.alpha_c = alpha_c             # <<<<<<<<<<<<<<
 * 
 *     def __reduce__(self):
 */
  __pyx_1 = __pyx_PyFloat_AsDouble(__pyx_v_alpha_c); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->alpha_c = __pyx_1;

  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.__init__");
  __pyx_r = -1;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":77
 *         self.alpha_c = alpha_c
 * 
 *     def __reduce__(self):             # <<<<<<<<<<<<<<
 *         """this allows ReconstructHelper to be pickled"""
 *         args = (self.fc1, self.fc2, self.cc1, self.cc2,
 */

static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper___reduce__(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static char __pyx_doc_17reconstruct_utils_17ReconstructHelper___reduce__[] = "this allows ReconstructHelper to be pickled";
static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper___reduce__(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_v_args;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  PyObject *__pyx_8 = 0;
  PyObject *__pyx_9 = 0;
  PyObject *__pyx_10 = 0;
  __pyx_v_args = Py_None; Py_INCREF(Py_None);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":79
 *     def __reduce__(self):
 *         """this allows ReconstructHelper to be pickled"""
 *         args = (self.fc1, self.fc2, self.cc1, self.cc2,             # <<<<<<<<<<<<<<
 *                 self.k1, self.k2, self.p1, self.p2, self.alpha_c)
 *         return (make_ReconstructHelper, args)
 */
  __pyx_1 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc2); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":80
 *         """this allows ReconstructHelper to be pickled"""
 *         args = (self.fc1, self.fc2, self.cc1, self.cc2,
 *                 self.k1, self.k2, self.p1, self.p2, self.alpha_c)             # <<<<<<<<<<<<<<
 *         return (make_ReconstructHelper, args)
 * 
 */
  __pyx_5 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->k1); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_6 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->k2); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_7 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p1); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_8 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p2); if (unlikely(!__pyx_8)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_9 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->alpha_c); if (unlikely(!__pyx_9)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 80; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_10 = PyTuple_New(9); if (unlikely(!__pyx_10)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 79; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_10, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_10, 1, __pyx_2);
  PyTuple_SET_ITEM(__pyx_10, 2, __pyx_3);
  PyTuple_SET_ITEM(__pyx_10, 3, __pyx_4);
  PyTuple_SET_ITEM(__pyx_10, 4, __pyx_5);
  PyTuple_SET_ITEM(__pyx_10, 5, __pyx_6);
  PyTuple_SET_ITEM(__pyx_10, 6, __pyx_7);
  PyTuple_SET_ITEM(__pyx_10, 7, __pyx_8);
  PyTuple_SET_ITEM(__pyx_10, 8, __pyx_9);
  __pyx_1 = 0;
  __pyx_2 = 0;
  __pyx_3 = 0;
  __pyx_4 = 0;
  __pyx_5 = 0;
  __pyx_6 = 0;
  __pyx_7 = 0;
  __pyx_8 = 0;
  __pyx_9 = 0;
  Py_DECREF(__pyx_v_args);
  __pyx_v_args = ((PyObject *)__pyx_10);
  __pyx_10 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":81
 *         args = (self.fc1, self.fc2, self.cc1, self.cc2,
 *                 self.k1, self.k2, self.p1, self.p2, self.alpha_c)
 *         return (make_ReconstructHelper, args)             # <<<<<<<<<<<<<<
 * 
 *     def add_element(self, parent):
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_30); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyTuple_New(2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 81; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_1);
  Py_INCREF(__pyx_v_args);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_v_args);
  __pyx_1 = 0;
  __pyx_r = ((PyObject *)__pyx_2);
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_8);
  Py_XDECREF(__pyx_9);
  Py_XDECREF(__pyx_10);
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.__reduce__");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_args);
  return __pyx_r;
}

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":83
 *         return (make_ReconstructHelper, args)
 * 
 *     def add_element(self, parent):             # <<<<<<<<<<<<<<
 *         """add self as XML element to parent"""
 *         assert ET.iselement(parent)
 */

static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper_add_element(PyObject *__pyx_v_self, PyObject *__pyx_v_parent); /*proto*/
static char __pyx_doc_17reconstruct_utils_17ReconstructHelper_add_element[] = "add self as XML element to parent";
static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper_add_element(PyObject *__pyx_v_self, PyObject *__pyx_v_parent) {
  PyObject *__pyx_v_elem;
  PyObject *__pyx_v_name;
  PyObject *__pyx_v_e;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  Py_ssize_t __pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  __pyx_v_elem = Py_None; Py_INCREF(Py_None);
  __pyx_v_name = Py_None; Py_INCREF(Py_None);
  __pyx_v_e = Py_None; Py_INCREF(Py_None);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":85
 *     def add_element(self, parent):
 *         """add self as XML element to parent"""
 *         assert ET.iselement(parent)             # <<<<<<<<<<<<<<
 *         elem = ET.SubElement(parent,"non_linear_parameters")
 * 
 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_ET); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_iselement); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_parent);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_parent);
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_4 = __Pyx_PyObject_IsTrue(__pyx_3); if (unlikely(__pyx_4 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (unlikely(!__pyx_4)) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 85; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  #endif

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":86
 *         """add self as XML element to parent"""
 *         assert ET.iselement(parent)
 *         elem = ET.SubElement(parent,"non_linear_parameters")             # <<<<<<<<<<<<<<
 * 
 *         for name in ['fc1','fc2','cc1','cc2','k1','k2','p1','p2','alpha_c']:
 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_ET); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_kp_SubElement); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_3 = PyTuple_New(2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_parent);
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_v_parent);
  Py_INCREF(__pyx_kp_31);
  PyTuple_SET_ITEM(__pyx_3, 1, __pyx_kp_31);
  __pyx_2 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 86; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
  Py_DECREF(__pyx_v_elem);
  __pyx_v_elem = __pyx_2;
  __pyx_2 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":88
 *         elem = ET.SubElement(parent,"non_linear_parameters")
 * 
 *         for name in ['fc1','fc2','cc1','cc2','k1','k2','p1','p2','alpha_c']:             # <<<<<<<<<<<<<<
 *             e = ET.SubElement(elem, name)
 *             e.text = repr( getattr(self,name) )
 */
  __pyx_1 = PyList_New(9); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_kp_32);
  PyList_SET_ITEM(__pyx_1, 0, __pyx_kp_32);
  Py_INCREF(__pyx_kp_33);
  PyList_SET_ITEM(__pyx_1, 1, __pyx_kp_33);
  Py_INCREF(__pyx_kp_34);
  PyList_SET_ITEM(__pyx_1, 2, __pyx_kp_34);
  Py_INCREF(__pyx_kp_35);
  PyList_SET_ITEM(__pyx_1, 3, __pyx_kp_35);
  Py_INCREF(__pyx_kp_36);
  PyList_SET_ITEM(__pyx_1, 4, __pyx_kp_36);
  Py_INCREF(__pyx_kp_37);
  PyList_SET_ITEM(__pyx_1, 5, __pyx_kp_37);
  Py_INCREF(__pyx_kp_38);
  PyList_SET_ITEM(__pyx_1, 6, __pyx_kp_38);
  Py_INCREF(__pyx_kp_39);
  PyList_SET_ITEM(__pyx_1, 7, __pyx_kp_39);
  Py_INCREF(__pyx_kp_40);
  PyList_SET_ITEM(__pyx_1, 8, __pyx_kp_40);
  if (PyList_CheckExact(((PyObject *)__pyx_1)) || PyTuple_CheckExact(((PyObject *)__pyx_1))) {
    __pyx_5 = 0; __pyx_3 = ((PyObject *)__pyx_1); Py_INCREF(__pyx_3);
  } else {
    __pyx_5 = -1; __pyx_3 = PyObject_GetIter(((PyObject *)__pyx_1)); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_3))) {
      if (__pyx_5 >= PyList_GET_SIZE(__pyx_3)) break;
      __pyx_2 = PyList_GET_ITEM(__pyx_3, __pyx_5); Py_INCREF(__pyx_2); __pyx_5++;
    } else if (likely(PyTuple_CheckExact(__pyx_3))) {
      if (__pyx_5 >= PyTuple_GET_SIZE(__pyx_3)) break;
      __pyx_2 = PyTuple_GET_ITEM(__pyx_3, __pyx_5); Py_INCREF(__pyx_2); __pyx_5++;
    } else {
      __pyx_2 = PyIter_Next(__pyx_3);
      if (!__pyx_2) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 88; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
    }
    Py_DECREF(__pyx_v_name);
    __pyx_v_name = __pyx_2;
    __pyx_2 = 0;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":89
 * 
 *         for name in ['fc1','fc2','cc1','cc2','k1','k2','p1','p2','alpha_c']:
 *             e = ET.SubElement(elem, name)             # <<<<<<<<<<<<<<
 *             e.text = repr( getattr(self,name) )
 * 
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_ET); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_SubElement); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_INCREF(__pyx_v_elem);
    PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_elem);
    Py_INCREF(__pyx_v_name);
    PyTuple_SET_ITEM(__pyx_1, 1, __pyx_v_name);
    __pyx_6 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 89; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    Py_DECREF(__pyx_v_e);
    __pyx_v_e = __pyx_6;
    __pyx_6 = 0;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":90
 *         for name in ['fc1','fc2','cc1','cc2','k1','k2','p1','p2','alpha_c']:
 *             e = ET.SubElement(elem, name)
 *             e.text = repr( getattr(self,name) )             # <<<<<<<<<<<<<<
 * 
 *     def save_to_rad_file( self, fname, comments=None ):
 */
    __pyx_2 = PyObject_GetAttr(__pyx_v_self, __pyx_v_name); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 90; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_1 = PyObject_Repr(__pyx_2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 90; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (PyObject_SetAttr(__pyx_v_e, __pyx_kp_text, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 90; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
  }
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.add_element");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_elem);
  Py_DECREF(__pyx_v_name);
  Py_DECREF(__pyx_v_e);
  return __pyx_r;
}

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":92
 *             e.text = repr( getattr(self,name) )
 * 
 *     def save_to_rad_file( self, fname, comments=None ):             # <<<<<<<<<<<<<<
 *         rad_fd = open(fname,'w')
 *         K = self.get_K()
 */

static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper_save_to_rad_file(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper_save_to_rad_file(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_fname = 0;
  PyObject *__pyx_v_comments = 0;
  PyObject *__pyx_v_rad_fd;
  PyObject *__pyx_v_K;
  PyObject *__pyx_v_nlparams;
  PyObject *__pyx_v_k1;
  PyObject *__pyx_v_k2;
  PyObject *__pyx_v_p1;
  PyObject *__pyx_v_p2;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  int __pyx_4;
  static char *__pyx_argnames[] = {"fname","comments",0};
  __pyx_v_comments = Py_None;
  if (likely(!__pyx_kwds) && likely(1 <= PyTuple_GET_SIZE(__pyx_args)) && likely(PyTuple_GET_SIZE(__pyx_args) <= 2)) {
    __pyx_v_fname = PyTuple_GET_ITEM(__pyx_args, 0);
    if (PyTuple_GET_SIZE(__pyx_args) > 1) {
      __pyx_v_comments = PyTuple_GET_ITEM(__pyx_args, 1);
    }
  }
  else {
    if (unlikely(!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "O|O", __pyx_argnames, &__pyx_v_fname, &__pyx_v_comments))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 92; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4;
  __pyx_L3_error:;
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.save_to_rad_file");
  return NULL;
  __pyx_L4:;
  Py_INCREF(__pyx_v_comments);
  __pyx_v_rad_fd = Py_None; Py_INCREF(Py_None);
  __pyx_v_K = Py_None; Py_INCREF(Py_None);
  __pyx_v_nlparams = Py_None; Py_INCREF(Py_None);
  __pyx_v_k1 = Py_None; Py_INCREF(Py_None);
  __pyx_v_k2 = Py_None; Py_INCREF(Py_None);
  __pyx_v_p1 = Py_None; Py_INCREF(Py_None);
  __pyx_v_p2 = Py_None; Py_INCREF(Py_None);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":93
 * 
 *     def save_to_rad_file( self, fname, comments=None ):
 *         rad_fd = open(fname,'w')             # <<<<<<<<<<<<<<
 *         K = self.get_K()
 *         nlparams = self.get_nlparams()
 */
  __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_fname);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_fname);
  Py_INCREF(__pyx_kp_41);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_kp_41);
  __pyx_2 = PyObject_Call(__pyx_builtin_open, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_v_rad_fd);
  __pyx_v_rad_fd = __pyx_2;
  __pyx_2 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":94
 *     def save_to_rad_file( self, fname, comments=None ):
 *         rad_fd = open(fname,'w')
 *         K = self.get_K()             # <<<<<<<<<<<<<<
 *         nlparams = self.get_nlparams()
 *         k1, k2, p1, p2 = nlparams
 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_get_K); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 94; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_v_K);
  __pyx_v_K = __pyx_2;
  __pyx_2 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":95
 *         rad_fd = open(fname,'w')
 *         K = self.get_K()
 *         nlparams = self.get_nlparams()             # <<<<<<<<<<<<<<
 *         k1, k2, p1, p2 = nlparams
 *         rad_fd.write('K11 = %s;\n'%repr(K[0,0]))
 */
  __pyx_1 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_get_nlparams); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyObject_Call(__pyx_1, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 95; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_v_nlparams);
  __pyx_v_nlparams = __pyx_2;
  __pyx_2 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":96
 *         K = self.get_K()
 *         nlparams = self.get_nlparams()
 *         k1, k2, p1, p2 = nlparams             # <<<<<<<<<<<<<<
 *         rad_fd.write('K11 = %s;\n'%repr(K[0,0]))
 *         rad_fd.write('K12 = %s;\n'%repr(K[0,1]))
 */
  if (PyTuple_CheckExact(__pyx_v_nlparams) && PyTuple_GET_SIZE(__pyx_v_nlparams) == 4) {
    PyObject* tuple = __pyx_v_nlparams;
    __pyx_2 = PyTuple_GET_ITEM(tuple, 0);
    Py_INCREF(__pyx_2);
    Py_DECREF(__pyx_v_k1);
    __pyx_v_k1 = __pyx_2;
    __pyx_2 = 0;
    __pyx_2 = PyTuple_GET_ITEM(tuple, 1);
    Py_INCREF(__pyx_2);
    Py_DECREF(__pyx_v_k2);
    __pyx_v_k2 = __pyx_2;
    __pyx_2 = 0;
    __pyx_2 = PyTuple_GET_ITEM(tuple, 2);
    Py_INCREF(__pyx_2);
    Py_DECREF(__pyx_v_p1);
    __pyx_v_p1 = __pyx_2;
    __pyx_2 = 0;
    __pyx_2 = PyTuple_GET_ITEM(tuple, 3);
    Py_INCREF(__pyx_2);
    Py_DECREF(__pyx_v_p2);
    __pyx_v_p2 = __pyx_2;
    __pyx_2 = 0;
  }
  else {
    __pyx_1 = PyObject_GetIter(__pyx_v_nlparams); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_2 = __Pyx_UnpackItem(__pyx_1, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_v_k1);
    __pyx_v_k1 = __pyx_2;
    __pyx_2 = 0;
    __pyx_2 = __Pyx_UnpackItem(__pyx_1, 1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_v_k2);
    __pyx_v_k2 = __pyx_2;
    __pyx_2 = 0;
    __pyx_2 = __Pyx_UnpackItem(__pyx_1, 2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_v_p1);
    __pyx_v_p1 = __pyx_2;
    __pyx_2 = 0;
    __pyx_2 = __Pyx_UnpackItem(__pyx_1, 3); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_v_p2);
    __pyx_v_p2 = __pyx_2;
    __pyx_2 = 0;
    if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 96; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
  }

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":97
 *         nlparams = self.get_nlparams()
 *         k1, k2, p1, p2 = nlparams
 *         rad_fd.write('K11 = %s;\n'%repr(K[0,0]))             # <<<<<<<<<<<<<<
 *         rad_fd.write('K12 = %s;\n'%repr(K[0,1]))
 *         rad_fd.write('K13 = %s;\n'%repr(K[0,2]))
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_int_0);
  Py_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_int_0);
  __pyx_3 = PyObject_GetItem(__pyx_v_K, ((PyObject *)__pyx_1)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_1 = PyObject_Repr(__pyx_3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyNumber_Remainder(__pyx_kp_42, __pyx_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 97; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":98
 *         k1, k2, p1, p2 = nlparams
 *         rad_fd.write('K11 = %s;\n'%repr(K[0,0]))
 *         rad_fd.write('K12 = %s;\n'%repr(K[0,1]))             # <<<<<<<<<<<<<<
 *         rad_fd.write('K13 = %s;\n'%repr(K[0,2]))
 *         rad_fd.write('K21 = %s;\n'%repr(K[1,0]))
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_int_0);
  Py_INCREF(__pyx_int_1);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_int_1);
  __pyx_3 = PyObject_GetItem(__pyx_v_K, ((PyObject *)__pyx_1)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_1 = PyObject_Repr(__pyx_3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyNumber_Remainder(__pyx_kp_43, __pyx_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 98; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":99
 *         rad_fd.write('K11 = %s;\n'%repr(K[0,0]))
 *         rad_fd.write('K12 = %s;\n'%repr(K[0,1]))
 *         rad_fd.write('K13 = %s;\n'%repr(K[0,2]))             # <<<<<<<<<<<<<<
 *         rad_fd.write('K21 = %s;\n'%repr(K[1,0]))
 *         rad_fd.write('K22 = %s;\n'%repr(K[1,1]))
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_int_0);
  Py_INCREF(__pyx_int_2);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_int_2);
  __pyx_3 = PyObject_GetItem(__pyx_v_K, ((PyObject *)__pyx_1)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_1 = PyObject_Repr(__pyx_3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyNumber_Remainder(__pyx_kp_44, __pyx_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 99; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":100
 *         rad_fd.write('K12 = %s;\n'%repr(K[0,1]))
 *         rad_fd.write('K13 = %s;\n'%repr(K[0,2]))
 *         rad_fd.write('K21 = %s;\n'%repr(K[1,0]))             # <<<<<<<<<<<<<<
 *         rad_fd.write('K22 = %s;\n'%repr(K[1,1]))
 *         rad_fd.write('K23 = %s;\n'%repr(K[1,2]))
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_1);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_int_1);
  Py_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_int_0);
  __pyx_3 = PyObject_GetItem(__pyx_v_K, ((PyObject *)__pyx_1)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_1 = PyObject_Repr(__pyx_3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyNumber_Remainder(__pyx_kp_45, __pyx_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 100; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":101
 *         rad_fd.write('K13 = %s;\n'%repr(K[0,2]))
 *         rad_fd.write('K21 = %s;\n'%repr(K[1,0]))
 *         rad_fd.write('K22 = %s;\n'%repr(K[1,1]))             # <<<<<<<<<<<<<<
 *         rad_fd.write('K23 = %s;\n'%repr(K[1,2]))
 *         rad_fd.write('K31 = %s;\n'%repr(K[2,0]))
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_1);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_int_1);
  Py_INCREF(__pyx_int_1);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_int_1);
  __pyx_3 = PyObject_GetItem(__pyx_v_K, ((PyObject *)__pyx_1)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_1 = PyObject_Repr(__pyx_3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyNumber_Remainder(__pyx_kp_46, __pyx_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 101; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":102
 *         rad_fd.write('K21 = %s;\n'%repr(K[1,0]))
 *         rad_fd.write('K22 = %s;\n'%repr(K[1,1]))
 *         rad_fd.write('K23 = %s;\n'%repr(K[1,2]))             # <<<<<<<<<<<<<<
 *         rad_fd.write('K31 = %s;\n'%repr(K[2,0]))
 *         rad_fd.write('K32 = %s;\n'%repr(K[2,1]))
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_1);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_int_1);
  Py_INCREF(__pyx_int_2);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_int_2);
  __pyx_3 = PyObject_GetItem(__pyx_v_K, ((PyObject *)__pyx_1)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_1 = PyObject_Repr(__pyx_3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyNumber_Remainder(__pyx_kp_47, __pyx_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 102; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":103
 *         rad_fd.write('K22 = %s;\n'%repr(K[1,1]))
 *         rad_fd.write('K23 = %s;\n'%repr(K[1,2]))
 *         rad_fd.write('K31 = %s;\n'%repr(K[2,0]))             # <<<<<<<<<<<<<<
 *         rad_fd.write('K32 = %s;\n'%repr(K[2,1]))
 *         rad_fd.write('K33 = %s;\n'%repr(K[2,2]))
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_2);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_int_2);
  Py_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_int_0);
  __pyx_3 = PyObject_GetItem(__pyx_v_K, ((PyObject *)__pyx_1)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_1 = PyObject_Repr(__pyx_3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyNumber_Remainder(__pyx_kp_48, __pyx_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":104
 *         rad_fd.write('K23 = %s;\n'%repr(K[1,2]))
 *         rad_fd.write('K31 = %s;\n'%repr(K[2,0]))
 *         rad_fd.write('K32 = %s;\n'%repr(K[2,1]))             # <<<<<<<<<<<<<<
 *         rad_fd.write('K33 = %s;\n'%repr(K[2,2]))
 *         rad_fd.write('\n')
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_2);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_int_2);
  Py_INCREF(__pyx_int_1);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_int_1);
  __pyx_3 = PyObject_GetItem(__pyx_v_K, ((PyObject *)__pyx_1)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_1 = PyObject_Repr(__pyx_3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyNumber_Remainder(__pyx_kp_49, __pyx_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 104; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":105
 *         rad_fd.write('K31 = %s;\n'%repr(K[2,0]))
 *         rad_fd.write('K32 = %s;\n'%repr(K[2,1]))
 *         rad_fd.write('K33 = %s;\n'%repr(K[2,2]))             # <<<<<<<<<<<<<<
 *         rad_fd.write('\n')
 *         rad_fd.write('kc1 = %s;\n'%repr(k1))
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_2);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_int_2);
  Py_INCREF(__pyx_int_2);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_int_2);
  __pyx_3 = PyObject_GetItem(__pyx_v_K, ((PyObject *)__pyx_1)); if (!__pyx_3) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  __pyx_1 = PyObject_Repr(__pyx_3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyNumber_Remainder(__pyx_kp_50, __pyx_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 105; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":106
 *         rad_fd.write('K32 = %s;\n'%repr(K[2,1]))
 *         rad_fd.write('K33 = %s;\n'%repr(K[2,2]))
 *         rad_fd.write('\n')             # <<<<<<<<<<<<<<
 *         rad_fd.write('kc1 = %s;\n'%repr(k1))
 *         rad_fd.write('kc2 = %s;\n'%repr(k2))
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_kp_51);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_kp_51);
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 106; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":107
 *         rad_fd.write('K33 = %s;\n'%repr(K[2,2]))
 *         rad_fd.write('\n')
 *         rad_fd.write('kc1 = %s;\n'%repr(k1))             # <<<<<<<<<<<<<<
 *         rad_fd.write('kc2 = %s;\n'%repr(k2))
 *         rad_fd.write('kc3 = %s;\n'%repr(p1))
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyObject_Repr(__pyx_v_k1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyNumber_Remainder(__pyx_kp_52, __pyx_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 107; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":108
 *         rad_fd.write('\n')
 *         rad_fd.write('kc1 = %s;\n'%repr(k1))
 *         rad_fd.write('kc2 = %s;\n'%repr(k2))             # <<<<<<<<<<<<<<
 *         rad_fd.write('kc3 = %s;\n'%repr(p1))
 *         rad_fd.write('kc4 = %s;\n'%repr(p2))
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyObject_Repr(__pyx_v_k2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyNumber_Remainder(__pyx_kp_53, __pyx_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 108; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":109
 *         rad_fd.write('kc1 = %s;\n'%repr(k1))
 *         rad_fd.write('kc2 = %s;\n'%repr(k2))
 *         rad_fd.write('kc3 = %s;\n'%repr(p1))             # <<<<<<<<<<<<<<
 *         rad_fd.write('kc4 = %s;\n'%repr(p2))
 *         rad_fd.write('\n')
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyObject_Repr(__pyx_v_p1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyNumber_Remainder(__pyx_kp_54, __pyx_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 109; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":110
 *         rad_fd.write('kc2 = %s;\n'%repr(k2))
 *         rad_fd.write('kc3 = %s;\n'%repr(p1))
 *         rad_fd.write('kc4 = %s;\n'%repr(p2))             # <<<<<<<<<<<<<<
 *         rad_fd.write('\n')
 *         if comments is not None:
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyObject_Repr(__pyx_v_p2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyNumber_Remainder(__pyx_kp_55, __pyx_1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_3);
  __pyx_3 = 0;
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 110; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":111
 *         rad_fd.write('kc3 = %s;\n'%repr(p1))
 *         rad_fd.write('kc4 = %s;\n'%repr(p2))
 *         rad_fd.write('\n')             # <<<<<<<<<<<<<<
 *         if comments is not None:
 *             comments = str(comments)
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_kp_56);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_kp_56);
  __pyx_3 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":112
 *         rad_fd.write('kc4 = %s;\n'%repr(p2))
 *         rad_fd.write('\n')
 *         if comments is not None:             # <<<<<<<<<<<<<<
 *             comments = str(comments)
 *         rad_fd.write("comments = '%s';\n"%comments)
 */
  __pyx_4 = (__pyx_v_comments != Py_None);
  if (__pyx_4) {

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":113
 *         rad_fd.write('\n')
 *         if comments is not None:
 *             comments = str(comments)             # <<<<<<<<<<<<<<
 *         rad_fd.write("comments = '%s';\n"%comments)
 *         rad_fd.write('\n')
 */
    __pyx_2 = PyTuple_New(1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_INCREF(__pyx_v_comments);
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_comments);
    __pyx_1 = PyObject_Call(((PyObject*)&PyBytes_Type), ((PyObject *)__pyx_2), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 113; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
    Py_DECREF(__pyx_v_comments);
    __pyx_v_comments = __pyx_1;
    __pyx_1 = 0;
    goto __pyx_L5;
  }
  __pyx_L5:;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":114
 *         if comments is not None:
 *             comments = str(comments)
 *         rad_fd.write("comments = '%s';\n"%comments)             # <<<<<<<<<<<<<<
 *         rad_fd.write('\n')
 *         rad_fd.close()
 */
  __pyx_3 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyNumber_Remainder(__pyx_kp_57, __pyx_v_comments); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_2 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 114; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":115
 *             comments = str(comments)
 *         rad_fd.write("comments = '%s';\n"%comments)
 *         rad_fd.write('\n')             # <<<<<<<<<<<<<<
 *         rad_fd.close()
 * 
 */
  __pyx_3 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_write); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_kp_58);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_kp_58);
  __pyx_2 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 115; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":116
 *         rad_fd.write("comments = '%s';\n"%comments)
 *         rad_fd.write('\n')
 *         rad_fd.close()             # <<<<<<<<<<<<<<
 * 
 *     def __richcmp__(self,other,op):
 */
  __pyx_3 = PyObject_GetAttr(__pyx_v_rad_fd, __pyx_kp_close); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 116; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.save_to_rad_file");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_rad_fd);
  Py_DECREF(__pyx_v_K);
  Py_DECREF(__pyx_v_nlparams);
  Py_DECREF(__pyx_v_k1);
  Py_DECREF(__pyx_v_k2);
  Py_DECREF(__pyx_v_p1);
  Py_DECREF(__pyx_v_p2);
  Py_DECREF(__pyx_v_comments);
  return __pyx_r;
}

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":118
 *         rad_fd.close()
 * 
 *     def __richcmp__(self,other,op):             # <<<<<<<<<<<<<<
 *         # cmp op
 *         #  < 0
 */

static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper___richcmp__(PyObject *__pyx_v_self, PyObject *__pyx_v_other, int __pyx_arg_op); /*proto*/
static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper___richcmp__(PyObject *__pyx_v_self, PyObject *__pyx_v_other, int __pyx_arg_op) {
  PyObject *__pyx_v_op = 0;
  PyObject *__pyx_v_isequal;
  PyObject *__pyx_v_result;
  PyObject *__pyx_r;
  int __pyx_1;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  PyObject *__pyx_6 = 0;
  int __pyx_7;
  __pyx_v_op = PyInt_FromLong(__pyx_arg_op); if (unlikely(!__pyx_v_op)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 118; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  goto __pyx_L4;
  __pyx_L3_error:;
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.__richcmp__");
  return NULL;
  __pyx_L4:;
  __pyx_v_isequal = Py_None; Py_INCREF(Py_None);
  __pyx_v_result = Py_None; Py_INCREF(Py_None);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":127
 *         # >= 5
 * 
 *         if isinstance(other, ReconstructHelper):             # <<<<<<<<<<<<<<
 *             isequal = (numpy.allclose(self.get_K(),other.get_K()) and
 *                       numpy.allclose(self.get_nlparams(),other.get_nlparams()) )
 */
  __pyx_1 = PyObject_IsInstance(__pyx_v_other, ((PyObject*)__pyx_ptype_17reconstruct_utils_ReconstructHelper)); if (unlikely(__pyx_1 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 127; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (__pyx_1) {

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":128
 * 
 *         if isinstance(other, ReconstructHelper):
 *             isequal = (numpy.allclose(self.get_K(),other.get_K()) and             # <<<<<<<<<<<<<<
 *                       numpy.allclose(self.get_nlparams(),other.get_nlparams()) )
 *         else:
 */
    __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_numpy); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_kp_allclose); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_3 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_get_K); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_5 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_3 = PyObject_GetAttr(__pyx_v_other, __pyx_kp_get_K); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_6 = PyObject_Call(__pyx_3, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_3); __pyx_3 = 0;
    __pyx_3 = PyTuple_New(2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_3, 0, __pyx_5);
    PyTuple_SET_ITEM(__pyx_3, 1, __pyx_6);
    __pyx_5 = 0;
    __pyx_6 = 0;
    __pyx_2 = PyObject_Call(__pyx_4, ((PyObject *)__pyx_3), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    Py_DECREF(((PyObject *)__pyx_3)); __pyx_3 = 0;
    __pyx_1 = __Pyx_PyObject_IsTrue(__pyx_2); if (unlikely(__pyx_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 128; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_1) {
      Py_DECREF(__pyx_2); __pyx_2 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":129
 *         if isinstance(other, ReconstructHelper):
 *             isequal = (numpy.allclose(self.get_K(),other.get_K()) and
 *                       numpy.allclose(self.get_nlparams(),other.get_nlparams()) )             # <<<<<<<<<<<<<<
 *         else:
 *             isequal = False
 */
      __pyx_5 = __Pyx_GetName(__pyx_m, __pyx_kp_numpy); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_6 = PyObject_GetAttr(__pyx_5, __pyx_kp_allclose); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __pyx_4 = PyObject_GetAttr(__pyx_v_self, __pyx_kp_get_nlparams); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_3 = PyObject_Call(__pyx_4, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_5 = PyObject_GetAttr(__pyx_v_other, __pyx_kp_get_nlparams); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_4 = PyObject_Call(__pyx_5, ((PyObject *)__pyx_empty_tuple), NULL); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_5); __pyx_5 = 0;
      __pyx_5 = PyTuple_New(2); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      PyTuple_SET_ITEM(__pyx_5, 0, __pyx_3);
      PyTuple_SET_ITEM(__pyx_5, 1, __pyx_4);
      __pyx_3 = 0;
      __pyx_4 = 0;
      __pyx_2 = PyObject_Call(__pyx_6, ((PyObject *)__pyx_5), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 129; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(((PyObject *)__pyx_5)); __pyx_5 = 0;
    }
    Py_DECREF(__pyx_v_isequal);
    __pyx_v_isequal = __pyx_2;
    __pyx_2 = 0;
    goto __pyx_L5;
  }
  /*else*/ {

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":131
 *                       numpy.allclose(self.get_nlparams(),other.get_nlparams()) )
 *         else:
 *             isequal = False             # <<<<<<<<<<<<<<
 * 
 *         if op in [1,2,5]:
 */
    __pyx_3 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_v_isequal);
    __pyx_v_isequal = __pyx_3;
    __pyx_3 = 0;
  }
  __pyx_L5:;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":133
 *             isequal = False
 * 
 *         if op in [1,2,5]:             # <<<<<<<<<<<<<<
 *             result = isequal
 *         elif op == 3:
 */
  __pyx_4 = __pyx_v_op;
  Py_INCREF(__pyx_4);
  __pyx_6 = PyObject_RichCompare(__pyx_4, __pyx_int_1, Py_EQ); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_7 = __Pyx_PyObject_IsTrue(__pyx_6); if (unlikely((__pyx_7 == (int)-1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  __pyx_1 = ((int)__pyx_7);
  if (!__pyx_1) {
    __pyx_5 = PyObject_RichCompare(__pyx_4, __pyx_int_2, Py_EQ); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_7 = __Pyx_PyObject_IsTrue(__pyx_5); if (unlikely((__pyx_7 == (int)-1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_5); __pyx_5 = 0;
    __pyx_1 = ((int)__pyx_7);
  }
  if (!__pyx_1) {
    __pyx_2 = PyObject_RichCompare(__pyx_4, __pyx_int_5, Py_EQ); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_7 = __Pyx_PyObject_IsTrue(__pyx_2); if (unlikely((__pyx_7 == (int)-1))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_1 = ((int)__pyx_7);
  }
  if (__pyx_1) {

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":134
 * 
 *         if op in [1,2,5]:
 *             result = isequal             # <<<<<<<<<<<<<<
 *         elif op == 3:
 *             result = not isequal
 */
    Py_INCREF(__pyx_v_isequal);
    Py_DECREF(__pyx_v_result);
    __pyx_v_result = __pyx_v_isequal;
    goto __pyx_L6;
  }

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":135
 *         if op in [1,2,5]:
 *             result = isequal
 *         elif op == 3:             # <<<<<<<<<<<<<<
 *             result = not isequal
 *         else:
 */
  __pyx_3 = PyObject_RichCompare(__pyx_v_op, __pyx_int_3, Py_EQ); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_7 = __Pyx_PyObject_IsTrue(__pyx_3); if (unlikely(__pyx_7 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 135; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (__pyx_7) {

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":136
 *             result = isequal
 *         elif op == 3:
 *             result = not isequal             # <<<<<<<<<<<<<<
 *         else:
 *             result = False
 */
    __pyx_1 = __Pyx_PyObject_IsTrue(__pyx_v_isequal); if (unlikely(__pyx_1 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_6 = __Pyx_PyBool_FromLong((!__pyx_1)); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 136; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_v_result);
    __pyx_v_result = __pyx_6;
    __pyx_6 = 0;
    goto __pyx_L6;
  }
  /*else*/ {

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":138
 *             result = not isequal
 *         else:
 *             result = False             # <<<<<<<<<<<<<<
 *         return result
 * 
 */
    __pyx_5 = __Pyx_PyBool_FromLong(0); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 138; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_v_result);
    __pyx_v_result = __pyx_5;
    __pyx_5 = 0;
  }
  __pyx_L6:;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":139
 *         else:
 *             result = False
 *         return result             # <<<<<<<<<<<<<<
 * 
 *     def get_K(self):
 */
  Py_INCREF(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  Py_XDECREF(__pyx_6);
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.__richcmp__");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_op);
  Py_DECREF(__pyx_v_isequal);
  Py_DECREF(__pyx_v_result);
  return __pyx_r;
}

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":141
 *         return result
 * 
 *     def get_K(self):             # <<<<<<<<<<<<<<
 *         # See
 *         # http://www.vision.caltech.edu/bouguetj/calib_doc/htmls/parameters.html
 */

static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper_get_K(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper_get_K(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_v_K;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;
  __pyx_v_K = Py_None; Py_INCREF(Py_None);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":144
 *         # See
 *         # http://www.vision.caltech.edu/bouguetj/calib_doc/htmls/parameters.html
 *         K = numpy.array((( self.fc1, self.alpha_c*self.fc1, self.cc1),             # <<<<<<<<<<<<<<
 *                          ( 0,        self.fc2,              self.cc2),
 *                          ( 0,        0,                     1       )))
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_numpy); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_array); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyFloat_FromDouble((((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->alpha_c * ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc1)); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc1); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_5 = PyTuple_New(3); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_5, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_5, 1, __pyx_3);
  PyTuple_SET_ITEM(__pyx_5, 2, __pyx_4);
  __pyx_1 = 0;
  __pyx_3 = 0;
  __pyx_4 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":145
 *         # http://www.vision.caltech.edu/bouguetj/calib_doc/htmls/parameters.html
 *         K = numpy.array((( self.fc1, self.alpha_c*self.fc1, self.cc1),
 *                          ( 0,        self.fc2,              self.cc2),             # <<<<<<<<<<<<<<
 *                          ( 0,        0,                     1       )))
 *         return K
 */
  __pyx_1 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyTuple_New(3); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 145; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_4, 0, __pyx_int_0);
  PyTuple_SET_ITEM(__pyx_4, 1, __pyx_1);
  PyTuple_SET_ITEM(__pyx_4, 2, __pyx_3);
  __pyx_1 = 0;
  __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":146
 *         K = numpy.array((( self.fc1, self.alpha_c*self.fc1, self.cc1),
 *                          ( 0,        self.fc2,              self.cc2),
 *                          ( 0,        0,                     1       )))             # <<<<<<<<<<<<<<
 *         return K
 * 
 */
  __pyx_1 = PyTuple_New(3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 146; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_1, 0, __pyx_int_0);
  Py_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_1, 1, __pyx_int_0);
  Py_INCREF(__pyx_int_1);
  PyTuple_SET_ITEM(__pyx_1, 2, __pyx_int_1);
  __pyx_3 = PyTuple_New(3); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_3, 0, ((PyObject *)__pyx_5));
  PyTuple_SET_ITEM(__pyx_3, 1, ((PyObject *)__pyx_4));
  PyTuple_SET_ITEM(__pyx_3, 2, ((PyObject *)__pyx_1));
  __pyx_5 = 0;
  __pyx_4 = 0;
  __pyx_1 = 0;
  __pyx_5 = PyTuple_New(1); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_5, 0, ((PyObject *)__pyx_3));
  __pyx_3 = 0;
  __pyx_4 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_5), NULL); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 144; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_5)); __pyx_5 = 0;
  Py_DECREF(__pyx_v_K);
  __pyx_v_K = __pyx_4;
  __pyx_4 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":147
 *                          ( 0,        self.fc2,              self.cc2),
 *                          ( 0,        0,                     1       )))
 *         return K             # <<<<<<<<<<<<<<
 * 
 *     def get_nlparams(self):
 */
  Py_INCREF(__pyx_v_K);
  __pyx_r = __pyx_v_K;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.get_K");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_K);
  return __pyx_r;
}

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":149
 *         return K
 * 
 *     def get_nlparams(self):             # <<<<<<<<<<<<<<
 *         return (self.k1, self.k2, self.p1, self.p2)
 * 
 */

static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper_get_nlparams(PyObject *__pyx_v_self, PyObject *unused); /*proto*/
static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper_get_nlparams(PyObject *__pyx_v_self, PyObject *unused) {
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  PyObject *__pyx_5 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":150
 * 
 *     def get_nlparams(self):
 *         return (self.k1, self.k2, self.p1, self.p2)             # <<<<<<<<<<<<<<
 * 
 *     def undistort(self, double x_kk, double y_kk):
 */
  __pyx_1 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->k1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->k2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p2); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_5 = PyTuple_New(4); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 150; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_5, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_5, 1, __pyx_2);
  PyTuple_SET_ITEM(__pyx_5, 2, __pyx_3);
  PyTuple_SET_ITEM(__pyx_5, 3, __pyx_4);
  __pyx_1 = 0;
  __pyx_2 = 0;
  __pyx_3 = 0;
  __pyx_4 = 0;
  __pyx_r = ((PyObject *)__pyx_5);
  __pyx_5 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.get_nlparams");
  __pyx_r = NULL;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":152
 *         return (self.k1, self.k2, self.p1, self.p2)
 * 
 *     def undistort(self, double x_kk, double y_kk):             # <<<<<<<<<<<<<<
 *         """undistort 2D coordinate pair
 * 
 */

static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper_undistort(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_17reconstruct_utils_17ReconstructHelper_undistort[] = "undistort 2D coordinate pair\n\n        Iteratively performs an undistortion using camera intrinsic\n        parameters.\n\n        Implementation translated from CalTechCal.\n\n        See also the OpenCV reference manual, which has the equation\n        used.\n        ";
static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper_undistort(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_x_kk;
  double __pyx_v_y_kk;
  double __pyx_v_xl;
  double __pyx_v_yl;
  double __pyx_v_xd;
  double __pyx_v_yd;
  double __pyx_v_x;
  double __pyx_v_y;
  double __pyx_v_r_2;
  double __pyx_v_k_radial;
  double __pyx_v_delta_x;
  double __pyx_v_delta_y;
  int __pyx_v_i;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  static char *__pyx_argnames[] = {"x_kk","y_kk",0};
  if (likely(!__pyx_kwds) && likely(PyTuple_GET_SIZE(__pyx_args) == 2)) {
    __pyx_v_x_kk = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_y_kk = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  else {
    if (unlikely(!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "dd", __pyx_argnames, &__pyx_v_x_kk, &__pyx_v_y_kk))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 152; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4;
  __pyx_L3_error:;
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.undistort");
  return NULL;
  __pyx_L4:;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":172
 *         # undoradial.m / CalTechCal/normalize.m
 * 
 *         xd = ( x_kk - self.cc1 ) / self.fc1             # <<<<<<<<<<<<<<
 *         yd = ( y_kk - self.cc2 ) / self.fc2
 * 
 */
  __pyx_v_xd = ((__pyx_v_x_kk - ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc1) / ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc1);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":173
 * 
 *         xd = ( x_kk - self.cc1 ) / self.fc1
 *         yd = ( y_kk - self.cc2 ) / self.fc2             # <<<<<<<<<<<<<<
 * 
 *         xd = xd - self.alpha_c * yd
 */
  __pyx_v_yd = ((__pyx_v_y_kk - ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc2) / ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc2);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":175
 *         yd = ( y_kk - self.cc2 ) / self.fc2
 * 
 *         xd = xd - self.alpha_c * yd             # <<<<<<<<<<<<<<
 * 
 *         # comp_distortion_oulu.m
 */
  __pyx_v_xd = (__pyx_v_xd - (((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->alpha_c * __pyx_v_yd));

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":180
 * 
 *         # initial guess
 *         x = xd             # <<<<<<<<<<<<<<
 *         y = yd
 * 
 */
  __pyx_v_x = __pyx_v_xd;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":181
 *         # initial guess
 *         x = xd
 *         y = yd             # <<<<<<<<<<<<<<
 * 
 *         for i from 0<=i<20:
 */
  __pyx_v_y = __pyx_v_yd;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":183
 *         y = yd
 * 
 *         for i from 0<=i<20:             # <<<<<<<<<<<<<<
 *             r_2 = x*x + y*y
 *             k_radial = 1.0 + (self.k1) * r_2 + (self.k2) * r_2*r_2
 */
  for (__pyx_v_i = 0; __pyx_v_i < 20; __pyx_v_i++) {

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":184
 * 
 *         for i from 0<=i<20:
 *             r_2 = x*x + y*y             # <<<<<<<<<<<<<<
 *             k_radial = 1.0 + (self.k1) * r_2 + (self.k2) * r_2*r_2
 *             delta_x = 2.0 * (self.p1)*x*y + (self.p2)*(r_2 + 2.0*x*x)
 */
    __pyx_v_r_2 = ((__pyx_v_x * __pyx_v_x) + (__pyx_v_y * __pyx_v_y));

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":185
 *         for i from 0<=i<20:
 *             r_2 = x*x + y*y
 *             k_radial = 1.0 + (self.k1) * r_2 + (self.k2) * r_2*r_2             # <<<<<<<<<<<<<<
 *             delta_x = 2.0 * (self.p1)*x*y + (self.p2)*(r_2 + 2.0*x*x)
 *             delta_y = (self.p1) * (r_2 + 2.0*y*y)+2.0*(self.p2)*x*y
 */
    __pyx_v_k_radial = ((1.0 + (((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->k1 * __pyx_v_r_2)) + ((((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->k2 * __pyx_v_r_2) * __pyx_v_r_2));

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":186
 *             r_2 = x*x + y*y
 *             k_radial = 1.0 + (self.k1) * r_2 + (self.k2) * r_2*r_2
 *             delta_x = 2.0 * (self.p1)*x*y + (self.p2)*(r_2 + 2.0*x*x)             # <<<<<<<<<<<<<<
 *             delta_y = (self.p1) * (r_2 + 2.0*y*y)+2.0*(self.p2)*x*y
 *             x = (xd-delta_x)/k_radial
 */
    __pyx_v_delta_x = ((((2.0 * ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p1) * __pyx_v_x) * __pyx_v_y) + (((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p2 * (__pyx_v_r_2 + ((2.0 * __pyx_v_x) * __pyx_v_x))));

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":187
 *             k_radial = 1.0 + (self.k1) * r_2 + (self.k2) * r_2*r_2
 *             delta_x = 2.0 * (self.p1)*x*y + (self.p2)*(r_2 + 2.0*x*x)
 *             delta_y = (self.p1) * (r_2 + 2.0*y*y)+2.0*(self.p2)*x*y             # <<<<<<<<<<<<<<
 *             x = (xd-delta_x)/k_radial
 *             y = (yd-delta_y)/k_radial
 */
    __pyx_v_delta_y = ((((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p1 * (__pyx_v_r_2 + ((2.0 * __pyx_v_y) * __pyx_v_y))) + (((2.0 * ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p2) * __pyx_v_x) * __pyx_v_y));

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":188
 *             delta_x = 2.0 * (self.p1)*x*y + (self.p2)*(r_2 + 2.0*x*x)
 *             delta_y = (self.p1) * (r_2 + 2.0*y*y)+2.0*(self.p2)*x*y
 *             x = (xd-delta_x)/k_radial             # <<<<<<<<<<<<<<
 *             y = (yd-delta_y)/k_radial
 * 
 */
    __pyx_v_x = ((__pyx_v_xd - __pyx_v_delta_x) / __pyx_v_k_radial);

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":189
 *             delta_y = (self.p1) * (r_2 + 2.0*y*y)+2.0*(self.p2)*x*y
 *             x = (xd-delta_x)/k_radial
 *             y = (yd-delta_y)/k_radial             # <<<<<<<<<<<<<<
 * 
 *         # undoradial.m
 */
    __pyx_v_y = ((__pyx_v_yd - __pyx_v_delta_y) / __pyx_v_k_radial);
  }

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":193
 *         # undoradial.m
 * 
 *         xl = (self.fc1)*x + (self.fc1*self.alpha_c)*y + (self.cc1)             # <<<<<<<<<<<<<<
 *         yl = (self.fc2)*y + (self.cc2)
 *         return (xl, yl)
 */
  __pyx_v_xl = (((((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc1 * __pyx_v_x) + ((((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc1 * ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->alpha_c) * __pyx_v_y)) + ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc1);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":194
 * 
 *         xl = (self.fc1)*x + (self.fc1*self.alpha_c)*y + (self.cc1)
 *         yl = (self.fc2)*y + (self.cc2)             # <<<<<<<<<<<<<<
 *         return (xl, yl)
 * 
 */
  __pyx_v_yl = ((((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc2 * __pyx_v_y) + ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc2);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":195
 *         xl = (self.fc1)*x + (self.fc1*self.alpha_c)*y + (self.cc1)
 *         yl = (self.fc2)*y + (self.cc2)
 *         return (xl, yl)             # <<<<<<<<<<<<<<
 * 
 *     def distort(self, double xl, double yl):
 */
  __pyx_1 = PyFloat_FromDouble(__pyx_v_xl); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyFloat_FromDouble(__pyx_v_yl); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyTuple_New(2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 195; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_3, 1, __pyx_2);
  __pyx_1 = 0;
  __pyx_2 = 0;
  __pyx_r = ((PyObject *)__pyx_3);
  __pyx_3 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.undistort");
  __pyx_r = NULL;
  __pyx_L0:;
  return __pyx_r;
}

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":197
 *         return (xl, yl)
 * 
 *     def distort(self, double xl, double yl):             # <<<<<<<<<<<<<<
 *         """distort 2D coordinate pair"""
 * 
 */

static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper_distort(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_17reconstruct_utils_17ReconstructHelper_distort[] = "distort 2D coordinate pair";
static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper_distort(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_xl;
  double __pyx_v_yl;
  double __pyx_v_x;
  double __pyx_v_y;
  double __pyx_v_r_2;
  double __pyx_v_term1;
  double __pyx_v_xd;
  double __pyx_v_yd;
  PyObject *__pyx_v_r_4;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  double __pyx_4;
  static char *__pyx_argnames[] = {"xl","yl",0};
  if (likely(!__pyx_kwds) && likely(PyTuple_GET_SIZE(__pyx_args) == 2)) {
    __pyx_v_xl = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 0)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    __pyx_v_yl = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 1)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  else {
    if (unlikely(!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "dd", __pyx_argnames, &__pyx_v_xl, &__pyx_v_yl))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 197; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4;
  __pyx_L3_error:;
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.distort");
  return NULL;
  __pyx_L4:;
  __pyx_v_r_4 = Py_None; Py_INCREF(Py_None);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":202
 *         cdef double x, y, r_2, term1, xd, yd
 * 
 *         x = ( xl - self.cc1 ) / self.fc1             # <<<<<<<<<<<<<<
 *         y = ( yl - self.cc2 ) / self.fc2
 * 
 */
  __pyx_v_x = ((__pyx_v_xl - ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc1) / ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc1);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":203
 * 
 *         x = ( xl - self.cc1 ) / self.fc1
 *         y = ( yl - self.cc2 ) / self.fc2             # <<<<<<<<<<<<<<
 * 
 *         r_2 = x*x + y*y
 */
  __pyx_v_y = ((__pyx_v_yl - ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc2) / ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc2);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":205
 *         y = ( yl - self.cc2 ) / self.fc2
 * 
 *         r_2 = x*x + y*y             # <<<<<<<<<<<<<<
 *         r_4 = r_2**2
 *         term1 = self.k1*r_2 + self.k2*r_4
 */
  __pyx_v_r_2 = ((__pyx_v_x * __pyx_v_x) + (__pyx_v_y * __pyx_v_y));

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":206
 * 
 *         r_2 = x*x + y*y
 *         r_4 = r_2**2             # <<<<<<<<<<<<<<
 *         term1 = self.k1*r_2 + self.k2*r_4
 * 
 */
  __pyx_1 = PyFloat_FromDouble(pow(__pyx_v_r_2, 2)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_r_4);
  __pyx_v_r_4 = __pyx_1;
  __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":207
 *         r_2 = x*x + y*y
 *         r_4 = r_2**2
 *         term1 = self.k1*r_2 + self.k2*r_4             # <<<<<<<<<<<<<<
 * 
 *         # OpenCV manual (chaper 6, "3D reconstruction", "camera
 */
  __pyx_1 = PyFloat_FromDouble((((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->k1 * __pyx_v_r_2)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->k2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyNumber_Multiply(__pyx_2, __pyx_v_r_4); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyNumber_Add(__pyx_1, __pyx_3); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_4 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_v_term1 = __pyx_4;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":217
 *         # consistent with his webpage and this below.
 * 
 *         xd = x + x*term1 + (2*self.p1*x*y + self.p2*(r_2+2*x**2))             # <<<<<<<<<<<<<<
 *         yd = y + y*term1 + (self.p1*(r_2+2*y**2) + 2*self.p2*x*y)
 * 
 */
  __pyx_v_xd = ((__pyx_v_x + (__pyx_v_x * __pyx_v_term1)) + ((((2 * ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p1) * __pyx_v_x) * __pyx_v_y) + (((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p2 * (__pyx_v_r_2 + (2 * pow(__pyx_v_x, 2))))));

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":218
 * 
 *         xd = x + x*term1 + (2*self.p1*x*y + self.p2*(r_2+2*x**2))
 *         yd = y + y*term1 + (self.p1*(r_2+2*y**2) + 2*self.p2*x*y)             # <<<<<<<<<<<<<<
 * 
 *         xd = (self.fc1)*xd + (self.cc1)
 */
  __pyx_v_yd = ((__pyx_v_y + (__pyx_v_y * __pyx_v_term1)) + ((((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p1 * (__pyx_v_r_2 + (2 * pow(__pyx_v_y, 2)))) + (((2 * ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p2) * __pyx_v_x) * __pyx_v_y)));

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":220
 *         yd = y + y*term1 + (self.p1*(r_2+2*y**2) + 2*self.p2*x*y)
 * 
 *         xd = (self.fc1)*xd + (self.cc1)             # <<<<<<<<<<<<<<
 *         yd = (self.fc2)*yd + (self.cc2)
 * 
 */
  __pyx_v_xd = ((((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc1 * __pyx_v_xd) + ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc1);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":221
 * 
 *         xd = (self.fc1)*xd + (self.cc1)
 *         yd = (self.fc2)*yd + (self.cc2)             # <<<<<<<<<<<<<<
 * 
 *         return (xd, yd)
 */
  __pyx_v_yd = ((((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc2 * __pyx_v_yd) + ((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc2);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":223
 *         yd = (self.fc2)*yd + (self.cc2)
 * 
 *         return (xd, yd)             # <<<<<<<<<<<<<<
 * 
 *     def undistort_image(self, numpy_image ):
 */
  __pyx_1 = PyFloat_FromDouble(__pyx_v_xd); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyFloat_FromDouble(__pyx_v_yd); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyTuple_New(2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 223; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_2, 1, __pyx_3);
  __pyx_1 = 0;
  __pyx_3 = 0;
  __pyx_r = ((PyObject *)__pyx_2);
  __pyx_2 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_3);
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.distort");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_r_4);
  return __pyx_r;
}

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":225
 *         return (xd, yd)
 * 
 *     def undistort_image(self, numpy_image ):             # <<<<<<<<<<<<<<
 *         assert len(numpy_image.shape)==2
 *         assert numpy_image.dtype == numpy.uint8
 */

static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper_undistort_image(PyObject *__pyx_v_self, PyObject *__pyx_v_numpy_image); /*proto*/
static PyObject *__pyx_pf_17reconstruct_utils_17ReconstructHelper_undistort_image(PyObject *__pyx_v_self, PyObject *__pyx_v_numpy_image) {
  PyObject *__pyx_v_f;
  PyObject *__pyx_v_c;
  PyObject *__pyx_v_k;
  PyObject *__pyx_v_imnew;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  Py_ssize_t __pyx_2 = 0;
  PyObject *__pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  __pyx_v_f = Py_None; Py_INCREF(Py_None);
  __pyx_v_c = Py_None; Py_INCREF(Py_None);
  __pyx_v_k = Py_None; Py_INCREF(Py_None);
  __pyx_v_imnew = Py_None; Py_INCREF(Py_None);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":226
 * 
 *     def undistort_image(self, numpy_image ):
 *         assert len(numpy_image.shape)==2             # <<<<<<<<<<<<<<
 *         assert numpy_image.dtype == numpy.uint8
 * 
 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_1 = PyObject_GetAttr(__pyx_v_numpy_image, __pyx_kp_shape); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 226; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyObject_Length(__pyx_1); if (unlikely(__pyx_2 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 226; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (unlikely(!(__pyx_2 == 2))) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 226; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  #endif

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":227
 *     def undistort_image(self, numpy_image ):
 *         assert len(numpy_image.shape)==2
 *         assert numpy_image.dtype == numpy.uint8             # <<<<<<<<<<<<<<
 * 
 *         f = self.fc1, self.fc2 # focal length
 */
  #ifndef PYREX_WITHOUT_ASSERTIONS
  __pyx_1 = PyObject_GetAttr(__pyx_v_numpy_image, __pyx_kp_dtype); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_numpy); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyObject_GetAttr(__pyx_3, __pyx_kp_59); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_3 = PyObject_RichCompare(__pyx_1, __pyx_4, Py_EQ); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  __pyx_5 = __Pyx_PyObject_IsTrue(__pyx_3); if (unlikely(__pyx_5 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  if (unlikely(!__pyx_5)) {
    PyErr_SetNone(PyExc_AssertionError);
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 227; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  #endif

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":229
 *         assert numpy_image.dtype == numpy.uint8
 * 
 *         f = self.fc1, self.fc2 # focal length             # <<<<<<<<<<<<<<
 *         c = self.cc1, self.cc2 # center
 *         k = self.k1, self.k2, self.p1, self.p2, 0  # NL terms: r^2, r^4, tan1, tan2, r^6
 */
  __pyx_1 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->fc2); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyTuple_New(2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 229; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_3, 1, __pyx_4);
  __pyx_1 = 0;
  __pyx_4 = 0;
  Py_DECREF(__pyx_v_f);
  __pyx_v_f = ((PyObject *)__pyx_3);
  __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":230
 * 
 *         f = self.fc1, self.fc2 # focal length
 *         c = self.cc1, self.cc2 # center             # <<<<<<<<<<<<<<
 *         k = self.k1, self.k2, self.p1, self.p2, 0  # NL terms: r^2, r^4, tan1, tan2, r^6
 * 
 */
  __pyx_1 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->cc2); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyTuple_New(2); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 230; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_3, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_3, 1, __pyx_4);
  __pyx_1 = 0;
  __pyx_4 = 0;
  Py_DECREF(__pyx_v_c);
  __pyx_v_c = ((PyObject *)__pyx_3);
  __pyx_3 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":231
 *         f = self.fc1, self.fc2 # focal length
 *         c = self.cc1, self.cc2 # center
 *         k = self.k1, self.k2, self.p1, self.p2, 0  # NL terms: r^2, r^4, tan1, tan2, r^6             # <<<<<<<<<<<<<<
 * 
 *         imnew = flydra.undistort.rect(numpy_image, f=f, c=c, k=k) # perform the undistortion
 */
  __pyx_1 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->k1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->k2); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p1); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_6 = PyFloat_FromDouble(((struct __pyx_obj_17reconstruct_utils_ReconstructHelper *)__pyx_v_self)->p2); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_7 = PyTuple_New(5); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_7, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_7, 1, __pyx_4);
  PyTuple_SET_ITEM(__pyx_7, 2, __pyx_3);
  PyTuple_SET_ITEM(__pyx_7, 3, __pyx_6);
  Py_INCREF(__pyx_int_0);
  PyTuple_SET_ITEM(__pyx_7, 4, __pyx_int_0);
  __pyx_1 = 0;
  __pyx_4 = 0;
  __pyx_3 = 0;
  __pyx_6 = 0;
  Py_DECREF(__pyx_v_k);
  __pyx_v_k = ((PyObject *)__pyx_7);
  __pyx_7 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":233
 *         k = self.k1, self.k2, self.p1, self.p2, 0  # NL terms: r^2, r^4, tan1, tan2, r^6
 * 
 *         imnew = flydra.undistort.rect(numpy_image, f=f, c=c, k=k) # perform the undistortion             # <<<<<<<<<<<<<<
 *         imnew = imnew.astype(numpy.uint8)
 *         return imnew
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_flydra); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyObject_GetAttr(__pyx_1, __pyx_kp_undistort); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_3 = PyObject_GetAttr(__pyx_4, __pyx_kp_rect); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  __pyx_6 = PyTuple_New(1); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_numpy_image);
  PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_numpy_image);
  __pyx_7 = PyDict_New(); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyDict_SetItem(__pyx_7, __pyx_kp_f, __pyx_v_f) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyDict_SetItem(__pyx_7, __pyx_kp_c, __pyx_v_c) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyDict_SetItem(__pyx_7, __pyx_kp_k, __pyx_v_k) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyEval_CallObjectWithKeywords(__pyx_3, ((PyObject *)__pyx_6), ((PyObject *)__pyx_7)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 233; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  Py_DECREF(((PyObject *)__pyx_6)); __pyx_6 = 0;
  Py_DECREF(((PyObject *)__pyx_7)); __pyx_7 = 0;
  Py_DECREF(__pyx_v_imnew);
  __pyx_v_imnew = __pyx_1;
  __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":234
 * 
 *         imnew = flydra.undistort.rect(numpy_image, f=f, c=c, k=k) # perform the undistortion
 *         imnew = imnew.astype(numpy.uint8)             # <<<<<<<<<<<<<<
 *         return imnew
 * 
 */
  __pyx_4 = PyObject_GetAttr(__pyx_v_imnew, __pyx_kp_astype); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = __Pyx_GetName(__pyx_m, __pyx_kp_numpy); if (unlikely(!__pyx_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_6 = PyObject_GetAttr(__pyx_3, __pyx_kp_59); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_3); __pyx_3 = 0;
  __pyx_7 = PyTuple_New(1); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_7, 0, __pyx_6);
  __pyx_6 = 0;
  __pyx_1 = PyObject_Call(__pyx_4, ((PyObject *)__pyx_7), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 234; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  Py_DECREF(((PyObject *)__pyx_7)); __pyx_7 = 0;
  Py_DECREF(__pyx_v_imnew);
  __pyx_v_imnew = __pyx_1;
  __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":235
 *         imnew = flydra.undistort.rect(numpy_image, f=f, c=c, k=k) # perform the undistortion
 *         imnew = imnew.astype(numpy.uint8)
 *         return imnew             # <<<<<<<<<<<<<<
 * 
 * def hypothesis_testing_algorithm__find_best_3d( object recon, object d2,
 */
  Py_INCREF(__pyx_v_imnew);
  __pyx_r = __pyx_v_imnew;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_3);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  __Pyx_AddTraceback("reconstruct_utils.ReconstructHelper.undistort_image");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_f);
  Py_DECREF(__pyx_v_c);
  Py_DECREF(__pyx_v_k);
  Py_DECREF(__pyx_v_imnew);
  return __pyx_r;
}

/* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":237
 *         return imnew
 * 
 * def hypothesis_testing_algorithm__find_best_3d( object recon, object d2,             # <<<<<<<<<<<<<<
 *                                                 double ACCEPTABLE_DISTANCE_PIXELS,
 *                                                 int debug=0, int max_n_cams=5):
 */

static PyObject *__pyx_pf_17reconstruct_utils_hypothesis_testing_algorithm__find_best_3d(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_17reconstruct_utils_hypothesis_testing_algorithm__find_best_3d[] = "Use hypothesis testing algorithm to find best 3D point\n\n    Finds combination of cameras which uses the most number of cameras\n    while minimizing mean reprojection error. Algorithm used accepts\n    any camera combination with reprojection error less than the\n    variable ACCEPTABLE_DISTANCE_PIXELS.\n\n    ";
static PyObject *__pyx_pf_17reconstruct_utils_hypothesis_testing_algorithm__find_best_3d(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_recon = 0;
  PyObject *__pyx_v_d2 = 0;
  double __pyx_v_ACCEPTABLE_DISTANCE_PIXELS;
  int __pyx_v_debug;
  int __pyx_v_max_n_cams;
  int __pyx_v_n_cams;
  int __pyx_v_best_n_cams;
  int __pyx_v_i;
  int __pyx_v_missing_cam_data;
  double __pyx_v_alpha;
  double __pyx_v_x;
  double __pyx_v_y;
  double __pyx_v_orig_x;
  double __pyx_v_orig_y;
  double __pyx_v_new_x;
  double __pyx_v_new_y;
  double __pyx_v_dist;
  double __pyx_v_mean_dist;
  double __pyx_v_least_err;
  PyObject *__pyx_v_svd;
  PyObject *__pyx_v_cam_ids;
  PyObject *__pyx_v_least_err_by_n_cameras;
  PyObject *__pyx_v_allA;
  PyObject *__pyx_v_bad_cam_ids;
  PyObject *__pyx_v_cam_id2idx;
  PyObject *__pyx_v_all2d;
  PyObject *__pyx_v_Pmat_fastnx;
  PyObject *__pyx_v_cam_id;
  PyObject *__pyx_v_value_tuple;
  PyObject *__pyx_v_xy_values;
  PyObject *__pyx_v_Pmat;
  PyObject *__pyx_v_row3;
  PyObject *__pyx_v_cam_ids_for_least_err;
  PyObject *__pyx_v_X_for_least_err;
  PyObject *__pyx_v_cam_ids_used;
  PyObject *__pyx_v_good_A_idx;
  PyObject *__pyx_v_A;
  PyObject *__pyx_v_u;
  PyObject *__pyx_v_d;
  PyObject *__pyx_v_vt;
  PyObject *__pyx_v_X;
  PyObject *__pyx_v_new_xyw;
  PyObject *__pyx_v_P;
  PyObject *__pyx_v_area;
  PyObject *__pyx_v_slope;
  PyObject *__pyx_v_eccentricity;
  PyObject *__pyx_v_p1;
  PyObject *__pyx_v_p2;
  PyObject *__pyx_v_p3;
  PyObject *__pyx_v_p4;
  PyObject *__pyx_v_Lcoords;
  PyObject *__pyx_v_err;
  PyObject *__pyx_v_Q;
  PyObject *__pyx_r;
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  Py_ssize_t __pyx_3 = 0;
  PyObject *__pyx_4 = 0;
  int __pyx_5;
  PyObject *__pyx_6 = 0;
  PyObject *__pyx_7 = 0;
  double __pyx_8;
  long __pyx_9;
  int __pyx_10;
  Py_ssize_t __pyx_11 = 0;
  PyObject *__pyx_12 = 0;
  PyObject *__pyx_13 = 0;
  PyObject *__pyx_14 = 0;
  PyObject *__pyx_15 = 0;
  static char *__pyx_argnames[] = {"recon","d2","ACCEPTABLE_DISTANCE_PIXELS","debug","max_n_cams",0};
  __pyx_self = __pyx_self;
  __pyx_v_debug = 0;
  __pyx_v_max_n_cams = 5;
  if (likely(!__pyx_kwds) && likely(3 <= PyTuple_GET_SIZE(__pyx_args)) && likely(PyTuple_GET_SIZE(__pyx_args) <= 5)) {
    __pyx_v_recon = PyTuple_GET_ITEM(__pyx_args, 0);
    __pyx_v_d2 = PyTuple_GET_ITEM(__pyx_args, 1);
    __pyx_v_ACCEPTABLE_DISTANCE_PIXELS = __pyx_PyFloat_AsDouble(PyTuple_GET_ITEM(__pyx_args, 2)); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 238; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
    if (PyTuple_GET_SIZE(__pyx_args) > 3) {
      __pyx_v_debug = __pyx_PyInt_int(PyTuple_GET_ITEM(__pyx_args, 3)); if (unlikely((__pyx_v_debug == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 239; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      if (PyTuple_GET_SIZE(__pyx_args) > 4) {
        __pyx_v_max_n_cams = __pyx_PyInt_int(PyTuple_GET_ITEM(__pyx_args, 4)); if (unlikely((__pyx_v_max_n_cams == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 239; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
      }
    }
  }
  else {
    if (unlikely(!PyArg_ParseTupleAndKeywords(__pyx_args, __pyx_kwds, "OOd|ii", __pyx_argnames, &__pyx_v_recon, &__pyx_v_d2, &__pyx_v_ACCEPTABLE_DISTANCE_PIXELS, &__pyx_v_debug, &__pyx_v_max_n_cams))) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 237; __pyx_clineno = __LINE__; goto __pyx_L3_error;}
  }
  goto __pyx_L4;
  __pyx_L3_error:;
  __Pyx_AddTraceback("reconstruct_utils.hypothesis_testing_algorithm__find_best_3d");
  return NULL;
  __pyx_L4:;
  __pyx_v_svd = Py_None; Py_INCREF(Py_None);
  __pyx_v_cam_ids = Py_None; Py_INCREF(Py_None);
  __pyx_v_least_err_by_n_cameras = Py_None; Py_INCREF(Py_None);
  __pyx_v_allA = Py_None; Py_INCREF(Py_None);
  __pyx_v_bad_cam_ids = Py_None; Py_INCREF(Py_None);
  __pyx_v_cam_id2idx = Py_None; Py_INCREF(Py_None);
  __pyx_v_all2d = Py_None; Py_INCREF(Py_None);
  __pyx_v_Pmat_fastnx = Py_None; Py_INCREF(Py_None);
  __pyx_v_cam_id = Py_None; Py_INCREF(Py_None);
  __pyx_v_value_tuple = Py_None; Py_INCREF(Py_None);
  __pyx_v_xy_values = Py_None; Py_INCREF(Py_None);
  __pyx_v_Pmat = Py_None; Py_INCREF(Py_None);
  __pyx_v_row3 = Py_None; Py_INCREF(Py_None);
  __pyx_v_cam_ids_for_least_err = Py_None; Py_INCREF(Py_None);
  __pyx_v_X_for_least_err = Py_None; Py_INCREF(Py_None);
  __pyx_v_cam_ids_used = Py_None; Py_INCREF(Py_None);
  __pyx_v_good_A_idx = Py_None; Py_INCREF(Py_None);
  __pyx_v_A = Py_None; Py_INCREF(Py_None);
  __pyx_v_u = Py_None; Py_INCREF(Py_None);
  __pyx_v_d = Py_None; Py_INCREF(Py_None);
  __pyx_v_vt = Py_None; Py_INCREF(Py_None);
  __pyx_v_X = Py_None; Py_INCREF(Py_None);
  __pyx_v_new_xyw = Py_None; Py_INCREF(Py_None);
  __pyx_v_P = Py_None; Py_INCREF(Py_None);
  __pyx_v_area = Py_None; Py_INCREF(Py_None);
  __pyx_v_slope = Py_None; Py_INCREF(Py_None);
  __pyx_v_eccentricity = Py_None; Py_INCREF(Py_None);
  __pyx_v_p1 = Py_None; Py_INCREF(Py_None);
  __pyx_v_p2 = Py_None; Py_INCREF(Py_None);
  __pyx_v_p3 = Py_None; Py_INCREF(Py_None);
  __pyx_v_p4 = Py_None; Py_INCREF(Py_None);
  __pyx_v_Lcoords = Py_None; Py_INCREF(Py_None);
  __pyx_v_err = Py_None; Py_INCREF(Py_None);
  __pyx_v_Q = Py_None; Py_INCREF(Py_None);

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":257
 *     #cdef double *least_err_by_n_cameras # fake dict (index = key)
 * 
 *     svd = numpy.dual.svd # eliminate global name lookup             # <<<<<<<<<<<<<<
 * 
 *     cam_ids = recon.cam_ids # shorthand
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_numpy); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_dual); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_kp_svd); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 257; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  Py_DECREF(__pyx_v_svd);
  __pyx_v_svd = __pyx_1;
  __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":259
 *     svd = numpy.dual.svd # eliminate global name lookup
 * 
 *     cam_ids = recon.cam_ids # shorthand             # <<<<<<<<<<<<<<
 *     max_n_cams = min(len(cam_ids), max_n_cams)
 * 
 */
  __pyx_2 = PyObject_GetAttr(__pyx_v_recon, __pyx_kp_cam_ids); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 259; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_cam_ids);
  __pyx_v_cam_ids = __pyx_2;
  __pyx_2 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":260
 * 
 *     cam_ids = recon.cam_ids # shorthand
 *     max_n_cams = min(len(cam_ids), max_n_cams)             # <<<<<<<<<<<<<<
 * 
 *     # Initialize least_err_by_n_cameras to be infinity.  Note that
 */
  __pyx_3 = PyObject_Length(__pyx_v_cam_ids); if (unlikely(__pyx_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyInt_FromSsize_t(__pyx_3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyInt_FromLong(__pyx_v_max_n_cams); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyTuple_New(2); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_4, 0, __pyx_1);
  PyTuple_SET_ITEM(__pyx_4, 1, __pyx_2);
  __pyx_1 = 0;
  __pyx_2 = 0;
  __pyx_1 = PyObject_Call(__pyx_builtin_min, ((PyObject *)__pyx_4), NULL); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_4)); __pyx_4 = 0;
  __pyx_5 = __pyx_PyInt_int(__pyx_1); if (unlikely((__pyx_5 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_max_n_cams = __pyx_5;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":265
 *     # values at 0th and 1st index will always remain infinity.
 * 
 *     least_err_by_n_cameras = [cinf]*(max_n_cams+1) # allow 0-based indexing to last camera             # <<<<<<<<<<<<<<
 *     allA = numpy.zeros( (2*(len(cam_ids)+1),4), dtype=numpy.float64)
 *     bad_cam_ids = []
 */
  __pyx_2 = PyFloat_FromDouble(__pyx_v_17reconstruct_utils_cinf); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 265; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyList_New(1); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 265; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyList_SET_ITEM(__pyx_4, 0, __pyx_2);
  __pyx_2 = 0;
  __pyx_1 = PyInt_FromLong((__pyx_v_max_n_cams + 1)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 265; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyNumber_Multiply(((PyObject *)__pyx_4), __pyx_1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 265; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_4)); __pyx_4 = 0;
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(__pyx_v_least_err_by_n_cameras);
  __pyx_v_least_err_by_n_cameras = __pyx_2;
  __pyx_2 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":266
 * 
 *     least_err_by_n_cameras = [cinf]*(max_n_cams+1) # allow 0-based indexing to last camera
 *     allA = numpy.zeros( (2*(len(cam_ids)+1),4), dtype=numpy.float64)             # <<<<<<<<<<<<<<
 *     bad_cam_ids = []
 *     cam_id2idx = {}
 */
  __pyx_4 = __Pyx_GetName(__pyx_m, __pyx_kp_numpy); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyObject_GetAttr(__pyx_4, __pyx_kp_zeros); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_4); __pyx_4 = 0;
  __pyx_3 = PyObject_Length(__pyx_v_cam_ids); if (unlikely(__pyx_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyInt_FromSsize_t((2 * (__pyx_3 + 1))); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_4 = PyTuple_New(2); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_4, 0, __pyx_2);
  Py_INCREF(__pyx_int_4);
  PyTuple_SET_ITEM(__pyx_4, 1, __pyx_int_4);
  __pyx_2 = 0;
  __pyx_2 = PyTuple_New(1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  PyTuple_SET_ITEM(__pyx_2, 0, ((PyObject *)__pyx_4));
  __pyx_4 = 0;
  __pyx_4 = PyDict_New(); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_6 = __Pyx_GetName(__pyx_m, __pyx_kp_numpy); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_7 = PyObject_GetAttr(__pyx_6, __pyx_kp_60); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_6); __pyx_6 = 0;
  if (PyDict_SetItem(__pyx_4, __pyx_kp_dtype, __pyx_7) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  __pyx_6 = PyEval_CallObjectWithKeywords(__pyx_1, ((PyObject *)__pyx_2), ((PyObject *)__pyx_4)); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 266; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  Py_DECREF(((PyObject *)__pyx_4)); __pyx_4 = 0;
  Py_DECREF(__pyx_v_allA);
  __pyx_v_allA = __pyx_6;
  __pyx_6 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":267
 *     least_err_by_n_cameras = [cinf]*(max_n_cams+1) # allow 0-based indexing to last camera
 *     allA = numpy.zeros( (2*(len(cam_ids)+1),4), dtype=numpy.float64)
 *     bad_cam_ids = []             # <<<<<<<<<<<<<<
 *     cam_id2idx = {}
 *     all2d = {}
 */
  __pyx_7 = PyList_New(0); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 267; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_bad_cam_ids);
  __pyx_v_bad_cam_ids = ((PyObject *)__pyx_7);
  __pyx_7 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":268
 *     allA = numpy.zeros( (2*(len(cam_ids)+1),4), dtype=numpy.float64)
 *     bad_cam_ids = []
 *     cam_id2idx = {}             # <<<<<<<<<<<<<<
 *     all2d = {}
 *     Pmat_fastnx = recon.Pmat # shorthand
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 268; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_cam_id2idx);
  __pyx_v_cam_id2idx = ((PyObject *)__pyx_1);
  __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":269
 *     bad_cam_ids = []
 *     cam_id2idx = {}
 *     all2d = {}             # <<<<<<<<<<<<<<
 *     Pmat_fastnx = recon.Pmat # shorthand
 *     for i,cam_id in enumerate(cam_ids):
 */
  __pyx_2 = PyDict_New(); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 269; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_all2d);
  __pyx_v_all2d = ((PyObject *)__pyx_2);
  __pyx_2 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":270
 *     cam_id2idx = {}
 *     all2d = {}
 *     Pmat_fastnx = recon.Pmat # shorthand             # <<<<<<<<<<<<<<
 *     for i,cam_id in enumerate(cam_ids):
 *         cam_id2idx[cam_id] = i
 */
  __pyx_4 = PyObject_GetAttr(__pyx_v_recon, __pyx_kp_Pmat); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 270; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_Pmat_fastnx);
  __pyx_v_Pmat_fastnx = __pyx_4;
  __pyx_4 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":271
 *     all2d = {}
 *     Pmat_fastnx = recon.Pmat # shorthand
 *     for i,cam_id in enumerate(cam_ids):             # <<<<<<<<<<<<<<
 *         cam_id2idx[cam_id] = i
 * 
 */
  __pyx_6 = PyTuple_New(1); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_cam_ids);
  PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_cam_ids);
  __pyx_7 = PyObject_Call(__pyx_builtin_enumerate, ((PyObject *)__pyx_6), NULL); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_6)); __pyx_6 = 0;
  if (PyList_CheckExact(__pyx_7) || PyTuple_CheckExact(__pyx_7)) {
    __pyx_3 = 0; __pyx_1 = __pyx_7; Py_INCREF(__pyx_1);
  } else {
    __pyx_3 = -1; __pyx_1 = PyObject_GetIter(__pyx_7); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_1))) {
      if (__pyx_3 >= PyList_GET_SIZE(__pyx_1)) break;
      __pyx_2 = PyList_GET_ITEM(__pyx_1, __pyx_3); Py_INCREF(__pyx_2); __pyx_3++;
    } else if (likely(PyTuple_CheckExact(__pyx_1))) {
      if (__pyx_3 >= PyTuple_GET_SIZE(__pyx_1)) break;
      __pyx_2 = PyTuple_GET_ITEM(__pyx_1, __pyx_3); Py_INCREF(__pyx_2); __pyx_3++;
    } else {
      __pyx_2 = PyIter_Next(__pyx_1);
      if (!__pyx_2) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
    }
    if (PyTuple_CheckExact(__pyx_2) && PyTuple_GET_SIZE(__pyx_2) == 2) {
      PyObject* tuple = __pyx_2;
      __pyx_6 = PyTuple_GET_ITEM(tuple, 0);
      Py_INCREF(__pyx_6);
      __pyx_5 = __pyx_PyInt_int(__pyx_6); if (unlikely((__pyx_5 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_v_i = __pyx_5;
      __pyx_7 = PyTuple_GET_ITEM(tuple, 1);
      Py_INCREF(__pyx_7);
      Py_DECREF(__pyx_v_cam_id);
      __pyx_v_cam_id = __pyx_7;
      __pyx_7 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
    }
    else {
      __pyx_4 = PyObject_GetIter(__pyx_2); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_6 = __Pyx_UnpackItem(__pyx_4, 0); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_5 = __pyx_PyInt_int(__pyx_6); if (unlikely((__pyx_5 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_v_i = __pyx_5;
      __pyx_7 = __Pyx_UnpackItem(__pyx_4, 1); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_v_cam_id);
      __pyx_v_cam_id = __pyx_7;
      __pyx_7 = 0;
      if (__Pyx_EndUnpack(__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
    }

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":272
 *     Pmat_fastnx = recon.Pmat # shorthand
 *     for i,cam_id in enumerate(cam_ids):
 *         cam_id2idx[cam_id] = i             # <<<<<<<<<<<<<<
 * 
 *         # do we have incoming data?
 */
    __pyx_6 = PyInt_FromLong(__pyx_v_i); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (PyObject_SetItem(__pyx_v_cam_id2idx, __pyx_v_cam_id, __pyx_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 272; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":275
 * 
 *         # do we have incoming data?
 *         try:             # <<<<<<<<<<<<<<
 *             value_tuple = d2[cam_id]
 *         except KeyError:
 */
    /*try:*/ {

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":276
 *         # do we have incoming data?
 *         try:
 *             value_tuple = d2[cam_id]             # <<<<<<<<<<<<<<
 *         except KeyError:
 *             bad_cam_ids.append( cam_id )
 */
      __pyx_7 = PyObject_GetItem(__pyx_v_d2, __pyx_v_cam_id); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 276; __pyx_clineno = __LINE__; goto __pyx_L7_error;}
      Py_DECREF(__pyx_v_value_tuple);
      __pyx_v_value_tuple = __pyx_7;
      __pyx_7 = 0;
    }
    goto __pyx_L8;
    __pyx_L7_error:;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;
    Py_XDECREF(__pyx_6); __pyx_6 = 0;
    Py_XDECREF(__pyx_7); __pyx_7 = 0;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":277
 *         try:
 *             value_tuple = d2[cam_id]
 *         except KeyError:             # <<<<<<<<<<<<<<
 *             bad_cam_ids.append( cam_id )
 *             continue # don't build this row
 */
    __pyx_5 = PyErr_ExceptionMatches(__pyx_builtin_KeyError);
    if (__pyx_5) {
      __Pyx_AddTraceback("reconstruct_utils.hypothesis_testing_algorithm__find_best_3d");
      if (__Pyx_GetException(&__pyx_2, &__pyx_4, &__pyx_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":278
 *             value_tuple = d2[cam_id]
 *         except KeyError:
 *             bad_cam_ids.append( cam_id )             # <<<<<<<<<<<<<<
 *             continue # don't build this row
 * 
 */
      __pyx_7 = __Pyx_PyObject_Append(__pyx_v_bad_cam_ids, __pyx_v_cam_id); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 278; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":279
 *         except KeyError:
 *             bad_cam_ids.append( cam_id )
 *             continue # don't build this row             # <<<<<<<<<<<<<<
 * 
 *         # was a 2d point found?
 */
      goto __pyx_L5;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      goto __pyx_L8;
    }
    goto __pyx_L1_error;
    __pyx_L8:;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":282
 * 
 *         # was a 2d point found?
 *         xy_values = value_tuple[:2]             # <<<<<<<<<<<<<<
 *         x,y = xy_values
 *         if isnan(x):
 */
    __pyx_7 = PySequence_GetSlice(__pyx_v_value_tuple, 0, 2); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 282; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_v_xy_values);
    __pyx_v_xy_values = __pyx_7;
    __pyx_7 = 0;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":283
 *         # was a 2d point found?
 *         xy_values = value_tuple[:2]
 *         x,y = xy_values             # <<<<<<<<<<<<<<
 *         if isnan(x):
 *             bad_cam_ids.append( cam_id )
 */
    if (PyTuple_CheckExact(__pyx_v_xy_values) && PyTuple_GET_SIZE(__pyx_v_xy_values) == 2) {
      PyObject* tuple = __pyx_v_xy_values;
      __pyx_4 = PyTuple_GET_ITEM(tuple, 0);
      Py_INCREF(__pyx_4);
      __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_4); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_v_x = __pyx_8;
      __pyx_6 = PyTuple_GET_ITEM(tuple, 1);
      Py_INCREF(__pyx_6);
      __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_6); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_v_y = __pyx_8;
    }
    else {
      __pyx_2 = PyObject_GetIter(__pyx_v_xy_values); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_4 = __Pyx_UnpackItem(__pyx_2, 0); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_4); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_v_x = __pyx_8;
      __pyx_6 = __Pyx_UnpackItem(__pyx_2, 1); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_6); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_v_y = __pyx_8;
      if (__Pyx_EndUnpack(__pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 283; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
    }

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":284
 *         xy_values = value_tuple[:2]
 *         x,y = xy_values
 *         if isnan(x):             # <<<<<<<<<<<<<<
 *             bad_cam_ids.append( cam_id )
 *             continue # don't build this row
 */
    __pyx_5 = isnan(__pyx_v_x);
    if (__pyx_5) {

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":285
 *         x,y = xy_values
 *         if isnan(x):
 *             bad_cam_ids.append( cam_id )             # <<<<<<<<<<<<<<
 *             continue # don't build this row
 * 
 */
      __pyx_7 = __Pyx_PyObject_Append(__pyx_v_bad_cam_ids, __pyx_v_cam_id); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 285; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":286
 *         if isnan(x):
 *             bad_cam_ids.append( cam_id )
 *             continue # don't build this row             # <<<<<<<<<<<<<<
 * 
 * 
 */
      goto __pyx_L5;
      goto __pyx_L9;
    }
    __pyx_L9:;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":289
 * 
 * 
 *         Pmat = Pmat_fastnx[cam_id] # Pmat is 3 rows x 4 columns             # <<<<<<<<<<<<<<
 *         row3 = Pmat[2,:]
 *         allA[ i*2, : ] = x*row3 - Pmat[0,:]
 */
    __pyx_4 = PyObject_GetItem(__pyx_v_Pmat_fastnx, __pyx_v_cam_id); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 289; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_v_Pmat);
    __pyx_v_Pmat = __pyx_4;
    __pyx_4 = 0;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":290
 * 
 *         Pmat = Pmat_fastnx[cam_id] # Pmat is 3 rows x 4 columns
 *         row3 = Pmat[2,:]             # <<<<<<<<<<<<<<
 *         allA[ i*2, : ] = x*row3 - Pmat[0,:]
 *         allA[ i*2+1, :]= y*row3 - Pmat[1,:]
 */
    __pyx_6 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_2 = PyTuple_New(2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_INCREF(__pyx_int_2);
    PyTuple_SET_ITEM(__pyx_2, 0, __pyx_int_2);
    PyTuple_SET_ITEM(__pyx_2, 1, __pyx_6);
    __pyx_6 = 0;
    __pyx_7 = PyObject_GetItem(__pyx_v_Pmat, ((PyObject *)__pyx_2)); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 290; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
    Py_DECREF(__pyx_v_row3);
    __pyx_v_row3 = __pyx_7;
    __pyx_7 = 0;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":291
 *         Pmat = Pmat_fastnx[cam_id] # Pmat is 3 rows x 4 columns
 *         row3 = Pmat[2,:]
 *         allA[ i*2, : ] = x*row3 - Pmat[0,:]             # <<<<<<<<<<<<<<
 *         allA[ i*2+1, :]= y*row3 - Pmat[1,:]
 * 
 */
    __pyx_4 = PyFloat_FromDouble(__pyx_v_x); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_6 = PyNumber_Multiply(__pyx_4, __pyx_v_row3); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_2 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_7 = PyTuple_New(2); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_INCREF(__pyx_int_0);
    PyTuple_SET_ITEM(__pyx_7, 0, __pyx_int_0);
    PyTuple_SET_ITEM(__pyx_7, 1, __pyx_2);
    __pyx_2 = 0;
    __pyx_4 = PyObject_GetItem(__pyx_v_Pmat, ((PyObject *)__pyx_7)); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_7)); __pyx_7 = 0;
    __pyx_2 = PyNumber_Subtract(__pyx_6, __pyx_4); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_7 = PyInt_FromLong((__pyx_v_i * 2)); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_6 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_4 = PyTuple_New(2); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_7);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_6);
    __pyx_7 = 0;
    __pyx_6 = 0;
    if (PyObject_SetItem(__pyx_v_allA, ((PyObject *)__pyx_4), __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 291; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_4)); __pyx_4 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":292
 *         row3 = Pmat[2,:]
 *         allA[ i*2, : ] = x*row3 - Pmat[0,:]
 *         allA[ i*2+1, :]= y*row3 - Pmat[1,:]             # <<<<<<<<<<<<<<
 * 
 *         all2d[cam_id] = xy_values
 */
    __pyx_7 = PyFloat_FromDouble(__pyx_v_y); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_6 = PyNumber_Multiply(__pyx_7, __pyx_v_row3); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    __pyx_2 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_4 = PyTuple_New(2); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_INCREF(__pyx_int_1);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_int_1);
    PyTuple_SET_ITEM(__pyx_4, 1, __pyx_2);
    __pyx_2 = 0;
    __pyx_7 = PyObject_GetItem(__pyx_v_Pmat, ((PyObject *)__pyx_4)); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_4)); __pyx_4 = 0;
    __pyx_2 = PyNumber_Subtract(__pyx_6, __pyx_7); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    __pyx_4 = PyInt_FromLong(((__pyx_v_i * 2) + 1)); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_6 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_7 = PyTuple_New(2); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_7, 0, __pyx_4);
    PyTuple_SET_ITEM(__pyx_7, 1, __pyx_6);
    __pyx_4 = 0;
    __pyx_6 = 0;
    if (PyObject_SetItem(__pyx_v_allA, ((PyObject *)__pyx_7), __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 292; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_7)); __pyx_7 = 0;
    Py_DECREF(__pyx_2); __pyx_2 = 0;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":294
 *         allA[ i*2+1, :]= y*row3 - Pmat[1,:]
 * 
 *         all2d[cam_id] = xy_values             # <<<<<<<<<<<<<<
 * 
 *     cam_ids_for_least_err = {}
 */
    if (PyObject_SetItem(__pyx_v_all2d, __pyx_v_cam_id, __pyx_v_xy_values) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 294; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_L5:;
  }
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":296
 *         all2d[cam_id] = xy_values
 * 
 *     cam_ids_for_least_err = {}             # <<<<<<<<<<<<<<
 *     X_for_least_err = {}
 *     for n_cams from 2<=n_cams<=max_n_cams:
 */
  __pyx_4 = PyDict_New(); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 296; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_cam_ids_for_least_err);
  __pyx_v_cam_ids_for_least_err = ((PyObject *)__pyx_4);
  __pyx_4 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":297
 * 
 *     cam_ids_for_least_err = {}
 *     X_for_least_err = {}             # <<<<<<<<<<<<<<
 *     for n_cams from 2<=n_cams<=max_n_cams:
 * 
 */
  __pyx_6 = PyDict_New(); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 297; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_X_for_least_err);
  __pyx_v_X_for_least_err = ((PyObject *)__pyx_6);
  __pyx_6 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":298
 *     cam_ids_for_least_err = {}
 *     X_for_least_err = {}
 *     for n_cams from 2<=n_cams<=max_n_cams:             # <<<<<<<<<<<<<<
 * 
 *         # Calculate in least reprojection error starting with all
 */
  for (__pyx_v_n_cams = 2; __pyx_v_n_cams <= __pyx_v_max_n_cams; __pyx_v_n_cams++) {

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":306
 *         # reprojection error.
 * 
 *         alpha = 1.0/n_cams             # <<<<<<<<<<<<<<
 * 
 *         # Can we short-circuit the rest of these computations?
 */
    __pyx_v_alpha = (1.0 / __pyx_v_n_cams);

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":309
 * 
 *         # Can we short-circuit the rest of these computations?
 *         if not isinf(least_err_by_n_cameras[n_cams-1]): # if it's infinity, it must be n_cams 0 or 1.             # <<<<<<<<<<<<<<
 *             # If we've calculated error for 2 less than n_cams
 *             if least_err_by_n_cameras[n_cams-1] > ACCEPTABLE_DISTANCE_PIXELS:
 */
    __pyx_9 = (__pyx_v_n_cams - 1);
    __pyx_2 = __Pyx_GetItemInt(__pyx_v_least_err_by_n_cameras, __pyx_9, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 309; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_10 = (!isinf(__pyx_8));
    if (__pyx_10) {

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":311
 *         if not isinf(least_err_by_n_cameras[n_cams-1]): # if it's infinity, it must be n_cams 0 or 1.
 *             # If we've calculated error for 2 less than n_cams
 *             if least_err_by_n_cameras[n_cams-1] > ACCEPTABLE_DISTANCE_PIXELS:             # <<<<<<<<<<<<<<
 *                 if debug>5:
 *                     print 'HYPOTHESIS TEST -    shorting for n_cams %d (this=%f, ACCEPTABLE_DISTANCE_PIXELS=%f)'%(
 */
      __pyx_9 = (__pyx_v_n_cams - 1);
      __pyx_7 = __Pyx_GetItemInt(__pyx_v_least_err_by_n_cameras, __pyx_9, 0); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_1 = PyFloat_FromDouble(__pyx_v_ACCEPTABLE_DISTANCE_PIXELS); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_4 = PyObject_RichCompare(__pyx_7, __pyx_1, Py_GT); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_10 = __Pyx_PyObject_IsTrue(__pyx_4); if (unlikely(__pyx_10 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 311; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      if (__pyx_10) {

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":312
 *             # If we've calculated error for 2 less than n_cams
 *             if least_err_by_n_cameras[n_cams-1] > ACCEPTABLE_DISTANCE_PIXELS:
 *                 if debug>5:             # <<<<<<<<<<<<<<
 *                     print 'HYPOTHESIS TEST -    shorting for n_cams %d (this=%f, ACCEPTABLE_DISTANCE_PIXELS=%f)'%(
 *                         n_cams,least_err_by_n_cameras[n_cams-1],ACCEPTABLE_DISTANCE_PIXELS)
 */
        __pyx_10 = (__pyx_v_debug > 5);
        if (__pyx_10) {

          /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":314
 *                 if debug>5:
 *                     print 'HYPOTHESIS TEST -    shorting for n_cams %d (this=%f, ACCEPTABLE_DISTANCE_PIXELS=%f)'%(
 *                         n_cams,least_err_by_n_cameras[n_cams-1],ACCEPTABLE_DISTANCE_PIXELS)             # <<<<<<<<<<<<<<
 *                 # and if the error for 1 less is too large, don't bother with more.
 *                 break
 */
          __pyx_6 = PyInt_FromLong(__pyx_v_n_cams); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_9 = (__pyx_v_n_cams - 1);
          __pyx_2 = __Pyx_GetItemInt(__pyx_v_least_err_by_n_cameras, __pyx_9, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_7 = PyFloat_FromDouble(__pyx_v_ACCEPTABLE_DISTANCE_PIXELS); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_1 = PyTuple_New(3); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 314; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          PyTuple_SET_ITEM(__pyx_1, 0, __pyx_6);
          PyTuple_SET_ITEM(__pyx_1, 1, __pyx_2);
          PyTuple_SET_ITEM(__pyx_1, 2, __pyx_7);
          __pyx_6 = 0;
          __pyx_2 = 0;
          __pyx_7 = 0;
          __pyx_4 = PyNumber_Remainder(__pyx_kp_61, ((PyObject *)__pyx_1)); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
          __pyx_6 = PyTuple_New(1); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          PyTuple_SET_ITEM(__pyx_6, 0, __pyx_4);
          __pyx_4 = 0;
          if (__Pyx_Print(((PyObject *)__pyx_6), 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 313; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(((PyObject *)__pyx_6)); __pyx_6 = 0;
          goto __pyx_L14;
        }
        __pyx_L14:;

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":316
 *                         n_cams,least_err_by_n_cameras[n_cams-1],ACCEPTABLE_DISTANCE_PIXELS)
 *                 # and if the error for 1 less is too large, don't bother with more.
 *                 break             # <<<<<<<<<<<<<<
 * 
 *         for cam_ids_used in recon.cam_combinations_by_size[n_cams]:
 */
        goto __pyx_L11;
        goto __pyx_L13;
      }
      __pyx_L13:;
      goto __pyx_L12;
    }
    __pyx_L12:;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":318
 *                 break
 * 
 *         for cam_ids_used in recon.cam_combinations_by_size[n_cams]:             # <<<<<<<<<<<<<<
 *             missing_cam_data = 0 #False
 *             good_A_idx = []
 */
    __pyx_2 = PyObject_GetAttr(__pyx_v_recon, __pyx_kp_62); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 318; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_7 = __Pyx_GetItemInt(__pyx_2, __pyx_v_n_cams, 0); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 318; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    if (PyList_CheckExact(__pyx_7) || PyTuple_CheckExact(__pyx_7)) {
      __pyx_3 = 0; __pyx_1 = __pyx_7; Py_INCREF(__pyx_1);
    } else {
      __pyx_3 = -1; __pyx_1 = PyObject_GetIter(__pyx_7); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 318; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    for (;;) {
      if (likely(PyList_CheckExact(__pyx_1))) {
        if (__pyx_3 >= PyList_GET_SIZE(__pyx_1)) break;
        __pyx_4 = PyList_GET_ITEM(__pyx_1, __pyx_3); Py_INCREF(__pyx_4); __pyx_3++;
      } else if (likely(PyTuple_CheckExact(__pyx_1))) {
        if (__pyx_3 >= PyTuple_GET_SIZE(__pyx_1)) break;
        __pyx_4 = PyTuple_GET_ITEM(__pyx_1, __pyx_3); Py_INCREF(__pyx_4); __pyx_3++;
      } else {
        __pyx_4 = PyIter_Next(__pyx_1);
        if (!__pyx_4) {
          if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 318; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          break;
        }
      }
      Py_DECREF(__pyx_v_cam_ids_used);
      __pyx_v_cam_ids_used = __pyx_4;
      __pyx_4 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":319
 * 
 *         for cam_ids_used in recon.cam_combinations_by_size[n_cams]:
 *             missing_cam_data = 0 #False             # <<<<<<<<<<<<<<
 *             good_A_idx = []
 *             if debug>5:
 */
      __pyx_v_missing_cam_data = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":320
 *         for cam_ids_used in recon.cam_combinations_by_size[n_cams]:
 *             missing_cam_data = 0 #False
 *             good_A_idx = []             # <<<<<<<<<<<<<<
 *             if debug>5:
 *                 assert len(cam_ids_used)==n_cams
 */
      __pyx_6 = PyList_New(0); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 320; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_v_good_A_idx);
      __pyx_v_good_A_idx = ((PyObject *)__pyx_6);
      __pyx_6 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":321
 *             missing_cam_data = 0 #False
 *             good_A_idx = []
 *             if debug>5:             # <<<<<<<<<<<<<<
 *                 assert len(cam_ids_used)==n_cams
 *             for cam_id in cam_ids_used:
 */
      __pyx_10 = (__pyx_v_debug > 5);
      if (__pyx_10) {

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":322
 *             good_A_idx = []
 *             if debug>5:
 *                 assert len(cam_ids_used)==n_cams             # <<<<<<<<<<<<<<
 *             for cam_id in cam_ids_used:
 *                 if cam_id in bad_cam_ids:
 */
        #ifndef PYREX_WITHOUT_ASSERTIONS
        __pyx_11 = PyObject_Length(__pyx_v_cam_ids_used); if (unlikely(__pyx_11 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        if (unlikely(!(__pyx_11 == __pyx_v_n_cams))) {
          PyErr_SetNone(PyExc_AssertionError);
          {__pyx_filename = __pyx_f[0]; __pyx_lineno = 322; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        }
        #endif
        goto __pyx_L17;
      }
      __pyx_L17:;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":323
 *             if debug>5:
 *                 assert len(cam_ids_used)==n_cams
 *             for cam_id in cam_ids_used:             # <<<<<<<<<<<<<<
 *                 if cam_id in bad_cam_ids:
 *                     missing_cam_data = 1 #True
 */
      if (PyList_CheckExact(__pyx_v_cam_ids_used) || PyTuple_CheckExact(__pyx_v_cam_ids_used)) {
        __pyx_11 = 0; __pyx_2 = __pyx_v_cam_ids_used; Py_INCREF(__pyx_2);
      } else {
        __pyx_11 = -1; __pyx_2 = PyObject_GetIter(__pyx_v_cam_ids_used); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      for (;;) {
        if (likely(PyList_CheckExact(__pyx_2))) {
          if (__pyx_11 >= PyList_GET_SIZE(__pyx_2)) break;
          __pyx_7 = PyList_GET_ITEM(__pyx_2, __pyx_11); Py_INCREF(__pyx_7); __pyx_11++;
        } else if (likely(PyTuple_CheckExact(__pyx_2))) {
          if (__pyx_11 >= PyTuple_GET_SIZE(__pyx_2)) break;
          __pyx_7 = PyTuple_GET_ITEM(__pyx_2, __pyx_11); Py_INCREF(__pyx_7); __pyx_11++;
        } else {
          __pyx_7 = PyIter_Next(__pyx_2);
          if (!__pyx_7) {
            if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 323; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            break;
          }
        }
        Py_DECREF(__pyx_v_cam_id);
        __pyx_v_cam_id = __pyx_7;
        __pyx_7 = 0;

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":324
 *                 assert len(cam_ids_used)==n_cams
 *             for cam_id in cam_ids_used:
 *                 if cam_id in bad_cam_ids:             # <<<<<<<<<<<<<<
 *                     missing_cam_data = 1 #True
 *                     break
 */
        __pyx_10 = (PySequence_Contains(__pyx_v_bad_cam_ids, __pyx_v_cam_id)); if (unlikely(__pyx_10 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 324; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        if (__pyx_10) {

          /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":325
 *             for cam_id in cam_ids_used:
 *                 if cam_id in bad_cam_ids:
 *                     missing_cam_data = 1 #True             # <<<<<<<<<<<<<<
 *                     break
 *                 else:
 */
          __pyx_v_missing_cam_data = 1;

          /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":326
 *                 if cam_id in bad_cam_ids:
 *                     missing_cam_data = 1 #True
 *                     break             # <<<<<<<<<<<<<<
 *                 else:
 *                     i = cam_id2idx[cam_id]
 */
          goto __pyx_L19;
          goto __pyx_L20;
        }
        /*else*/ {

          /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":328
 *                     break
 *                 else:
 *                     i = cam_id2idx[cam_id]             # <<<<<<<<<<<<<<
 *                     good_A_idx.extend( (i*2, i*2+1) )
 *             if missing_cam_data == 1:
 */
          __pyx_4 = PyObject_GetItem(__pyx_v_cam_id2idx, __pyx_v_cam_id); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_5 = __pyx_PyInt_int(__pyx_4); if (unlikely((__pyx_5 == (int)-1) && PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 328; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(__pyx_4); __pyx_4 = 0;
          __pyx_v_i = __pyx_5;

          /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":329
 *                 else:
 *                     i = cam_id2idx[cam_id]
 *                     good_A_idx.extend( (i*2, i*2+1) )             # <<<<<<<<<<<<<<
 *             if missing_cam_data == 1:
 *                 continue
 */
          __pyx_6 = PyObject_GetAttr(__pyx_v_good_A_idx, __pyx_kp_extend); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_7 = PyInt_FromLong((__pyx_v_i * 2)); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_4 = PyInt_FromLong(((__pyx_v_i * 2) + 1)); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_12 = PyTuple_New(2); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          PyTuple_SET_ITEM(__pyx_12, 0, __pyx_7);
          PyTuple_SET_ITEM(__pyx_12, 1, __pyx_4);
          __pyx_7 = 0;
          __pyx_4 = 0;
          __pyx_7 = PyTuple_New(1); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          PyTuple_SET_ITEM(__pyx_7, 0, ((PyObject *)__pyx_12));
          __pyx_12 = 0;
          __pyx_4 = PyObject_Call(__pyx_6, ((PyObject *)__pyx_7), NULL); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 329; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          Py_DECREF(((PyObject *)__pyx_7)); __pyx_7 = 0;
          Py_DECREF(__pyx_4); __pyx_4 = 0;
        }
        __pyx_L20:;
      }
      __pyx_L19:;
      Py_DECREF(__pyx_2); __pyx_2 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":330
 *                     i = cam_id2idx[cam_id]
 *                     good_A_idx.extend( (i*2, i*2+1) )
 *             if missing_cam_data == 1:             # <<<<<<<<<<<<<<
 *                 continue
 * 
 */
      __pyx_10 = (__pyx_v_missing_cam_data == 1);
      if (__pyx_10) {

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":331
 *                     good_A_idx.extend( (i*2, i*2+1) )
 *             if missing_cam_data == 1:
 *                 continue             # <<<<<<<<<<<<<<
 * 
 *             # find 3D point
 */
        goto __pyx_L15;
        goto __pyx_L21;
      }
      __pyx_L21:;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":334
 * 
 *             # find 3D point
 *             A = allA[good_A_idx,:]             # <<<<<<<<<<<<<<
 *             u,d,vt=svd(A)
 *             X = vt[-1,:]/vt[-1,3] # normalize
 */
      __pyx_12 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_6 = PyTuple_New(2); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_INCREF(__pyx_v_good_A_idx);
      PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_good_A_idx);
      PyTuple_SET_ITEM(__pyx_6, 1, __pyx_12);
      __pyx_12 = 0;
      __pyx_7 = PyObject_GetItem(__pyx_v_allA, ((PyObject *)__pyx_6)); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 334; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(((PyObject *)__pyx_6)); __pyx_6 = 0;
      Py_DECREF(__pyx_v_A);
      __pyx_v_A = __pyx_7;
      __pyx_7 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":335
 *             # find 3D point
 *             A = allA[good_A_idx,:]
 *             u,d,vt=svd(A)             # <<<<<<<<<<<<<<
 *             X = vt[-1,:]/vt[-1,3] # normalize
 * 
 */
      __pyx_4 = PyTuple_New(1); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_INCREF(__pyx_v_A);
      PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_A);
      __pyx_2 = PyObject_Call(__pyx_v_svd, ((PyObject *)__pyx_4), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(((PyObject *)__pyx_4)); __pyx_4 = 0;
      if (PyTuple_CheckExact(__pyx_2) && PyTuple_GET_SIZE(__pyx_2) == 3) {
        PyObject* tuple = __pyx_2;
        __pyx_6 = PyTuple_GET_ITEM(tuple, 0);
        Py_INCREF(__pyx_6);
        Py_DECREF(__pyx_v_u);
        __pyx_v_u = __pyx_6;
        __pyx_6 = 0;
        __pyx_7 = PyTuple_GET_ITEM(tuple, 1);
        Py_INCREF(__pyx_7);
        Py_DECREF(__pyx_v_d);
        __pyx_v_d = __pyx_7;
        __pyx_7 = 0;
        __pyx_4 = PyTuple_GET_ITEM(tuple, 2);
        Py_INCREF(__pyx_4);
        Py_DECREF(__pyx_v_vt);
        __pyx_v_vt = __pyx_4;
        __pyx_4 = 0;
        Py_DECREF(__pyx_2); __pyx_2 = 0;
      }
      else {
        __pyx_12 = PyObject_GetIter(__pyx_2); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_6 = __Pyx_UnpackItem(__pyx_12, 0); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(__pyx_v_u);
        __pyx_v_u = __pyx_6;
        __pyx_6 = 0;
        __pyx_7 = __Pyx_UnpackItem(__pyx_12, 1); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(__pyx_v_d);
        __pyx_v_d = __pyx_7;
        __pyx_7 = 0;
        __pyx_4 = __Pyx_UnpackItem(__pyx_12, 2); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(__pyx_v_vt);
        __pyx_v_vt = __pyx_4;
        __pyx_4 = 0;
        if (__Pyx_EndUnpack(__pyx_12) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 335; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(__pyx_12); __pyx_12 = 0;
      }

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":336
 *             A = allA[good_A_idx,:]
 *             u,d,vt=svd(A)
 *             X = vt[-1,:]/vt[-1,3] # normalize             # <<<<<<<<<<<<<<
 * 
 *             # calculate reprojection error
 */
      __pyx_6 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_7 = PyTuple_New(2); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_INCREF(__pyx_int_neg_1);
      PyTuple_SET_ITEM(__pyx_7, 0, __pyx_int_neg_1);
      PyTuple_SET_ITEM(__pyx_7, 1, __pyx_6);
      __pyx_6 = 0;
      __pyx_4 = PyObject_GetItem(__pyx_v_vt, ((PyObject *)__pyx_7)); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(((PyObject *)__pyx_7)); __pyx_7 = 0;
      __pyx_2 = PyTuple_New(2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_INCREF(__pyx_int_neg_1);
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_int_neg_1);
      Py_INCREF(__pyx_int_3);
      PyTuple_SET_ITEM(__pyx_2, 1, __pyx_int_3);
      __pyx_12 = PyObject_GetItem(__pyx_v_vt, ((PyObject *)__pyx_2)); if (!__pyx_12) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
      __pyx_6 = __Pyx_PyNumber_Divide(__pyx_4, __pyx_12); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 336; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_12); __pyx_12 = 0;
      Py_DECREF(__pyx_v_X);
      __pyx_v_X = __pyx_6;
      __pyx_6 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":339
 * 
 *             # calculate reprojection error
 *             mean_dist = 0.0             # <<<<<<<<<<<<<<
 *             for cam_id in cam_ids_used:
 *                 orig_x,orig_y = all2d[cam_id]
 */
      __pyx_v_mean_dist = 0.0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":340
 *             # calculate reprojection error
 *             mean_dist = 0.0
 *             for cam_id in cam_ids_used:             # <<<<<<<<<<<<<<
 *                 orig_x,orig_y = all2d[cam_id]
 *                 Pmat = Pmat_fastnx[cam_id]
 */
      if (PyList_CheckExact(__pyx_v_cam_ids_used) || PyTuple_CheckExact(__pyx_v_cam_ids_used)) {
        __pyx_11 = 0; __pyx_7 = __pyx_v_cam_ids_used; Py_INCREF(__pyx_7);
      } else {
        __pyx_11 = -1; __pyx_7 = PyObject_GetIter(__pyx_v_cam_ids_used); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 340; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      }
      for (;;) {
        if (likely(PyList_CheckExact(__pyx_7))) {
          if (__pyx_11 >= PyList_GET_SIZE(__pyx_7)) break;
          __pyx_2 = PyList_GET_ITEM(__pyx_7, __pyx_11); Py_INCREF(__pyx_2); __pyx_11++;
        } else if (likely(PyTuple_CheckExact(__pyx_7))) {
          if (__pyx_11 >= PyTuple_GET_SIZE(__pyx_7)) break;
          __pyx_2 = PyTuple_GET_ITEM(__pyx_7, __pyx_11); Py_INCREF(__pyx_2); __pyx_11++;
        } else {
          __pyx_2 = PyIter_Next(__pyx_7);
          if (!__pyx_2) {
            if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 340; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
            break;
          }
        }
        Py_DECREF(__pyx_v_cam_id);
        __pyx_v_cam_id = __pyx_2;
        __pyx_2 = 0;

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":341
 *             mean_dist = 0.0
 *             for cam_id in cam_ids_used:
 *                 orig_x,orig_y = all2d[cam_id]             # <<<<<<<<<<<<<<
 *                 Pmat = Pmat_fastnx[cam_id]
 *                 new_xyw = numpy.dot( Pmat, X ) # reproject 3d to 2d
 */
        __pyx_4 = PyObject_GetItem(__pyx_v_all2d, __pyx_v_cam_id); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        if (PyTuple_CheckExact(__pyx_4) && PyTuple_GET_SIZE(__pyx_4) == 2) {
          PyObject* tuple = __pyx_4;
          __pyx_6 = PyTuple_GET_ITEM(tuple, 0);
          Py_INCREF(__pyx_6);
          __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_6); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          __pyx_v_orig_x = __pyx_8;
          __pyx_2 = PyTuple_GET_ITEM(tuple, 1);
          Py_INCREF(__pyx_2);
          __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_v_orig_y = __pyx_8;
          Py_DECREF(__pyx_4); __pyx_4 = 0;
        }
        else {
          __pyx_12 = PyObject_GetIter(__pyx_4); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(__pyx_4); __pyx_4 = 0;
          __pyx_6 = __Pyx_UnpackItem(__pyx_12, 0); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_6); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
          __pyx_v_orig_x = __pyx_8;
          __pyx_2 = __Pyx_UnpackItem(__pyx_12, 1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_v_orig_y = __pyx_8;
          if (__Pyx_EndUnpack(__pyx_12) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 341; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(__pyx_12); __pyx_12 = 0;
        }

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":342
 *             for cam_id in cam_ids_used:
 *                 orig_x,orig_y = all2d[cam_id]
 *                 Pmat = Pmat_fastnx[cam_id]             # <<<<<<<<<<<<<<
 *                 new_xyw = numpy.dot( Pmat, X ) # reproject 3d to 2d
 *                 new_x, new_y = new_xyw[0:2]/new_xyw[2]
 */
        __pyx_6 = PyObject_GetItem(__pyx_v_Pmat_fastnx, __pyx_v_cam_id); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 342; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(__pyx_v_Pmat);
        __pyx_v_Pmat = __pyx_6;
        __pyx_6 = 0;

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":343
 *                 orig_x,orig_y = all2d[cam_id]
 *                 Pmat = Pmat_fastnx[cam_id]
 *                 new_xyw = numpy.dot( Pmat, X ) # reproject 3d to 2d             # <<<<<<<<<<<<<<
 *                 new_x, new_y = new_xyw[0:2]/new_xyw[2]
 * 
 */
        __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_numpy); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_4 = PyObject_GetAttr(__pyx_2, __pyx_kp_dot); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_12 = PyTuple_New(2); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_INCREF(__pyx_v_Pmat);
        PyTuple_SET_ITEM(__pyx_12, 0, __pyx_v_Pmat);
        Py_INCREF(__pyx_v_X);
        PyTuple_SET_ITEM(__pyx_12, 1, __pyx_v_X);
        __pyx_6 = PyObject_Call(__pyx_4, ((PyObject *)__pyx_12), NULL); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 343; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        Py_DECREF(((PyObject *)__pyx_12)); __pyx_12 = 0;
        Py_DECREF(__pyx_v_new_xyw);
        __pyx_v_new_xyw = __pyx_6;
        __pyx_6 = 0;

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":344
 *                 Pmat = Pmat_fastnx[cam_id]
 *                 new_xyw = numpy.dot( Pmat, X ) # reproject 3d to 2d
 *                 new_x, new_y = new_xyw[0:2]/new_xyw[2]             # <<<<<<<<<<<<<<
 * 
 *                 dist = sqrt((orig_x-new_x)**2 + (orig_y-new_y)**2)
 */
        __pyx_2 = PySequence_GetSlice(__pyx_v_new_xyw, 0, 2); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_4 = __Pyx_GetItemInt(__pyx_v_new_xyw, 2, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_12 = __Pyx_PyNumber_Divide(__pyx_2, __pyx_4); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        Py_DECREF(__pyx_4); __pyx_4 = 0;
        if (PyTuple_CheckExact(__pyx_12) && PyTuple_GET_SIZE(__pyx_12) == 2) {
          PyObject* tuple = __pyx_12;
          __pyx_2 = PyTuple_GET_ITEM(tuple, 0);
          Py_INCREF(__pyx_2);
          __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_v_new_x = __pyx_8;
          __pyx_4 = PyTuple_GET_ITEM(tuple, 1);
          Py_INCREF(__pyx_4);
          __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_4); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(__pyx_4); __pyx_4 = 0;
          __pyx_v_new_y = __pyx_8;
          Py_DECREF(__pyx_12); __pyx_12 = 0;
        }
        else {
          __pyx_6 = PyObject_GetIter(__pyx_12); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(__pyx_12); __pyx_12 = 0;
          __pyx_2 = __Pyx_UnpackItem(__pyx_6, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(__pyx_2); __pyx_2 = 0;
          __pyx_v_new_x = __pyx_8;
          __pyx_4 = __Pyx_UnpackItem(__pyx_6, 1); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_4); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(__pyx_4); __pyx_4 = 0;
          __pyx_v_new_y = __pyx_8;
          if (__Pyx_EndUnpack(__pyx_6) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 344; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
          Py_DECREF(__pyx_6); __pyx_6 = 0;
        }

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":346
 *                 new_x, new_y = new_xyw[0:2]/new_xyw[2]
 * 
 *                 dist = sqrt((orig_x-new_x)**2 + (orig_y-new_y)**2)             # <<<<<<<<<<<<<<
 *                 mean_dist = mean_dist + dist*alpha
 *             if debug>5:
 */
        __pyx_v_dist = sqrt((pow((__pyx_v_orig_x - __pyx_v_new_x), 2) + pow((__pyx_v_orig_y - __pyx_v_new_y), 2)));

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":347
 * 
 *                 dist = sqrt((orig_x-new_x)**2 + (orig_y-new_y)**2)
 *                 mean_dist = mean_dist + dist*alpha             # <<<<<<<<<<<<<<
 *             if debug>5:
 *                 print 'HYPOTHESIS TEST - mean_dist = %f for cam_ids_used = %s (always pt 0)'%(mean_dist,str(cam_ids_used))
 */
        __pyx_v_mean_dist = (__pyx_v_mean_dist + (__pyx_v_dist * __pyx_v_alpha));
      }
      Py_DECREF(__pyx_7); __pyx_7 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":348
 *                 dist = sqrt((orig_x-new_x)**2 + (orig_y-new_y)**2)
 *                 mean_dist = mean_dist + dist*alpha
 *             if debug>5:             # <<<<<<<<<<<<<<
 *                 print 'HYPOTHESIS TEST - mean_dist = %f for cam_ids_used = %s (always pt 0)'%(mean_dist,str(cam_ids_used))
 * 
 */
      __pyx_10 = (__pyx_v_debug > 5);
      if (__pyx_10) {

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":349
 *                 mean_dist = mean_dist + dist*alpha
 *             if debug>5:
 *                 print 'HYPOTHESIS TEST - mean_dist = %f for cam_ids_used = %s (always pt 0)'%(mean_dist,str(cam_ids_used))             # <<<<<<<<<<<<<<
 * 
 *             least_err = least_err_by_n_cameras[n_cams]
 */
        __pyx_2 = PyFloat_FromDouble(__pyx_v_mean_dist); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        __pyx_4 = PyTuple_New(1); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_INCREF(__pyx_v_cam_ids_used);
        PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_cam_ids_used);
        __pyx_12 = PyObject_Call(((PyObject*)&PyBytes_Type), ((PyObject *)__pyx_4), NULL); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(((PyObject *)__pyx_4)); __pyx_4 = 0;
        __pyx_6 = PyTuple_New(2); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        PyTuple_SET_ITEM(__pyx_6, 0, __pyx_2);
        PyTuple_SET_ITEM(__pyx_6, 1, __pyx_12);
        __pyx_2 = 0;
        __pyx_12 = 0;
        __pyx_7 = PyNumber_Remainder(__pyx_kp_63, ((PyObject *)__pyx_6)); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(((PyObject *)__pyx_6)); __pyx_6 = 0;
        __pyx_4 = PyTuple_New(1); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        PyTuple_SET_ITEM(__pyx_4, 0, __pyx_7);
        __pyx_7 = 0;
        if (__Pyx_Print(((PyObject *)__pyx_4), 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 349; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(((PyObject *)__pyx_4)); __pyx_4 = 0;
        goto __pyx_L24;
      }
      __pyx_L24:;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":351
 *                 print 'HYPOTHESIS TEST - mean_dist = %f for cam_ids_used = %s (always pt 0)'%(mean_dist,str(cam_ids_used))
 * 
 *             least_err = least_err_by_n_cameras[n_cams]             # <<<<<<<<<<<<<<
 *             if mean_dist < least_err:
 *                 least_err_by_n_cameras[n_cams] = mean_dist
 */
      __pyx_2 = __Pyx_GetItemInt(__pyx_v_least_err_by_n_cameras, __pyx_v_n_cams, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 351; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_v_least_err = __pyx_8;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":352
 * 
 *             least_err = least_err_by_n_cameras[n_cams]
 *             if mean_dist < least_err:             # <<<<<<<<<<<<<<
 *                 least_err_by_n_cameras[n_cams] = mean_dist
 *                 cam_ids_for_least_err[n_cams] = cam_ids_used
 */
      __pyx_10 = (__pyx_v_mean_dist < __pyx_v_least_err);
      if (__pyx_10) {

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":353
 *             least_err = least_err_by_n_cameras[n_cams]
 *             if mean_dist < least_err:
 *                 least_err_by_n_cameras[n_cams] = mean_dist             # <<<<<<<<<<<<<<
 *                 cam_ids_for_least_err[n_cams] = cam_ids_used
 *                 X_for_least_err[n_cams] = X[:3]
 */
        __pyx_12 = PyFloat_FromDouble(__pyx_v_mean_dist); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        if (__Pyx_SetItemInt(__pyx_v_least_err_by_n_cameras, __pyx_v_n_cams, __pyx_12, 0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 353; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(__pyx_12); __pyx_12 = 0;

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":354
 *             if mean_dist < least_err:
 *                 least_err_by_n_cameras[n_cams] = mean_dist
 *                 cam_ids_for_least_err[n_cams] = cam_ids_used             # <<<<<<<<<<<<<<
 *                 X_for_least_err[n_cams] = X[:3]
 * 
 */
        if (__Pyx_SetItemInt(__pyx_v_cam_ids_for_least_err, __pyx_v_n_cams, __pyx_v_cam_ids_used, 0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 354; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":355
 *                 least_err_by_n_cameras[n_cams] = mean_dist
 *                 cam_ids_for_least_err[n_cams] = cam_ids_used
 *                 X_for_least_err[n_cams] = X[:3]             # <<<<<<<<<<<<<<
 * 
 *     # now we have the best estimate for 2 views, 3 views, ...
 */
        __pyx_6 = PySequence_GetSlice(__pyx_v_X, 0, 3); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        if (__Pyx_SetItemInt(__pyx_v_X_for_least_err, __pyx_v_n_cams, __pyx_6, 0) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 355; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        Py_DECREF(__pyx_6); __pyx_6 = 0;
        goto __pyx_L25;
      }
      __pyx_L25:;
      __pyx_L15:;
    }
    Py_DECREF(__pyx_1); __pyx_1 = 0;
  }
  __pyx_L11:;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":358
 * 
 *     # now we have the best estimate for 2 views, 3 views, ...
 *     best_n_cams = 2             # <<<<<<<<<<<<<<
 *     least_err = least_err_by_n_cameras[2]
 *     if debug>5:
 */
  __pyx_v_best_n_cams = 2;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":359
 *     # now we have the best estimate for 2 views, 3 views, ...
 *     best_n_cams = 2
 *     least_err = least_err_by_n_cameras[2]             # <<<<<<<<<<<<<<
 *     if debug>5:
 *         print 'HYPOTHESIS TEST - least_err, ACCEPTABLE_DISTANCE_PIXELS: %f, %f'%(least_err,ACCEPTABLE_DISTANCE_PIXELS)
 */
  __pyx_7 = __Pyx_GetItemInt(__pyx_v_least_err_by_n_cameras, 2, 0); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_7); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 359; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_7); __pyx_7 = 0;
  __pyx_v_least_err = __pyx_8;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":360
 *     best_n_cams = 2
 *     least_err = least_err_by_n_cameras[2]
 *     if debug>5:             # <<<<<<<<<<<<<<
 *         print 'HYPOTHESIS TEST - least_err, ACCEPTABLE_DISTANCE_PIXELS: %f, %f'%(least_err,ACCEPTABLE_DISTANCE_PIXELS)
 *     mean_dist = least_err
 */
  __pyx_10 = (__pyx_v_debug > 5);
  if (__pyx_10) {

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":361
 *     least_err = least_err_by_n_cameras[2]
 *     if debug>5:
 *         print 'HYPOTHESIS TEST - least_err, ACCEPTABLE_DISTANCE_PIXELS: %f, %f'%(least_err,ACCEPTABLE_DISTANCE_PIXELS)             # <<<<<<<<<<<<<<
 *     mean_dist = least_err
 *     if not (least_err < ACCEPTABLE_DISTANCE_PIXELS):
 */
    __pyx_4 = PyFloat_FromDouble(__pyx_v_least_err); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_2 = PyFloat_FromDouble(__pyx_v_ACCEPTABLE_DISTANCE_PIXELS); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_12 = PyTuple_New(2); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_12, 0, __pyx_4);
    PyTuple_SET_ITEM(__pyx_12, 1, __pyx_2);
    __pyx_4 = 0;
    __pyx_2 = 0;
    __pyx_6 = PyNumber_Remainder(__pyx_kp_64, ((PyObject *)__pyx_12)); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_12)); __pyx_12 = 0;
    __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_1, 0, __pyx_6);
    __pyx_6 = 0;
    if (__Pyx_Print(((PyObject *)__pyx_1), 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 361; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
    goto __pyx_L26;
  }
  __pyx_L26:;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":362
 *     if debug>5:
 *         print 'HYPOTHESIS TEST - least_err, ACCEPTABLE_DISTANCE_PIXELS: %f, %f'%(least_err,ACCEPTABLE_DISTANCE_PIXELS)
 *     mean_dist = least_err             # <<<<<<<<<<<<<<
 *     if not (least_err < ACCEPTABLE_DISTANCE_PIXELS):
 *         raise NoAcceptablePointFound('least error was %f'%least_err)
 */
  __pyx_v_mean_dist = __pyx_v_least_err;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":363
 *         print 'HYPOTHESIS TEST - least_err, ACCEPTABLE_DISTANCE_PIXELS: %f, %f'%(least_err,ACCEPTABLE_DISTANCE_PIXELS)
 *     mean_dist = least_err
 *     if not (least_err < ACCEPTABLE_DISTANCE_PIXELS):             # <<<<<<<<<<<<<<
 *         raise NoAcceptablePointFound('least error was %f'%least_err)
 * 
 */
  __pyx_10 = (!(__pyx_v_least_err < __pyx_v_ACCEPTABLE_DISTANCE_PIXELS));
  if (__pyx_10) {

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":364
 *     mean_dist = least_err
 *     if not (least_err < ACCEPTABLE_DISTANCE_PIXELS):
 *         raise NoAcceptablePointFound('least error was %f'%least_err)             # <<<<<<<<<<<<<<
 * 
 *     for n_cams from 3 <= n_cams <= max_n_cams:
 */
    __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_kp_7); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_4 = PyFloat_FromDouble(__pyx_v_least_err); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_2 = PyNumber_Remainder(__pyx_kp_65, __pyx_4); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    __pyx_12 = PyTuple_New(1); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    PyTuple_SET_ITEM(__pyx_12, 0, __pyx_2);
    __pyx_2 = 0;
    __pyx_6 = PyObject_Call(__pyx_7, ((PyObject *)__pyx_12), NULL); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    Py_DECREF(((PyObject *)__pyx_12)); __pyx_12 = 0;
    __Pyx_Raise(__pyx_6, 0, 0);
    Py_DECREF(__pyx_6); __pyx_6 = 0;
    {__pyx_filename = __pyx_f[0]; __pyx_lineno = 364; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    goto __pyx_L27;
  }
  __pyx_L27:;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":366
 *         raise NoAcceptablePointFound('least error was %f'%least_err)
 * 
 *     for n_cams from 3 <= n_cams <= max_n_cams:             # <<<<<<<<<<<<<<
 *         least_err = least_err_by_n_cameras[n_cams]
 *         if debug>5:
 */
  for (__pyx_v_n_cams = 3; __pyx_v_n_cams <= __pyx_v_max_n_cams; __pyx_v_n_cams++) {

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":367
 * 
 *     for n_cams from 3 <= n_cams <= max_n_cams:
 *         least_err = least_err_by_n_cameras[n_cams]             # <<<<<<<<<<<<<<
 *         if debug>5:
 *             print 'HYPOTHESIS TEST - n_cams %d: %f'%(n_cams,least_err)
 */
    __pyx_1 = __Pyx_GetItemInt(__pyx_v_least_err_by_n_cameras, __pyx_v_n_cams, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 367; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_v_least_err = __pyx_8;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":368
 *     for n_cams from 3 <= n_cams <= max_n_cams:
 *         least_err = least_err_by_n_cameras[n_cams]
 *         if debug>5:             # <<<<<<<<<<<<<<
 *             print 'HYPOTHESIS TEST - n_cams %d: %f'%(n_cams,least_err)
 *         if isinf(least_err):
 */
    __pyx_10 = (__pyx_v_debug > 5);
    if (__pyx_10) {

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":369
 *         least_err = least_err_by_n_cameras[n_cams]
 *         if debug>5:
 *             print 'HYPOTHESIS TEST - n_cams %d: %f'%(n_cams,least_err)             # <<<<<<<<<<<<<<
 *         if isinf(least_err):
 *             break # if we don't have e.g. 4 cameras, we won't have 5
 */
      __pyx_4 = PyInt_FromLong(__pyx_v_n_cams); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_2 = PyFloat_FromDouble(__pyx_v_least_err); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_7 = PyTuple_New(2); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      PyTuple_SET_ITEM(__pyx_7, 0, __pyx_4);
      PyTuple_SET_ITEM(__pyx_7, 1, __pyx_2);
      __pyx_4 = 0;
      __pyx_2 = 0;
      __pyx_12 = PyNumber_Remainder(__pyx_kp_66, ((PyObject *)__pyx_7)); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(((PyObject *)__pyx_7)); __pyx_7 = 0;
      __pyx_6 = PyTuple_New(1); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      PyTuple_SET_ITEM(__pyx_6, 0, __pyx_12);
      __pyx_12 = 0;
      if (__Pyx_Print(((PyObject *)__pyx_6), 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 369; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(((PyObject *)__pyx_6)); __pyx_6 = 0;
      goto __pyx_L30;
    }
    __pyx_L30:;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":370
 *         if debug>5:
 *             print 'HYPOTHESIS TEST - n_cams %d: %f'%(n_cams,least_err)
 *         if isinf(least_err):             # <<<<<<<<<<<<<<
 *             break # if we don't have e.g. 4 cameras, we won't have 5
 *         if least_err < ACCEPTABLE_DISTANCE_PIXELS:
 */
    __pyx_5 = isinf(__pyx_v_least_err);
    if (__pyx_5) {

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":371
 *             print 'HYPOTHESIS TEST - n_cams %d: %f'%(n_cams,least_err)
 *         if isinf(least_err):
 *             break # if we don't have e.g. 4 cameras, we won't have 5             # <<<<<<<<<<<<<<
 *         if least_err < ACCEPTABLE_DISTANCE_PIXELS:
 *             mean_dist = least_err
 */
      goto __pyx_L29;
      goto __pyx_L31;
    }
    __pyx_L31:;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":372
 *         if isinf(least_err):
 *             break # if we don't have e.g. 4 cameras, we won't have 5
 *         if least_err < ACCEPTABLE_DISTANCE_PIXELS:             # <<<<<<<<<<<<<<
 *             mean_dist = least_err
 *             best_n_cams = n_cams
 */
    __pyx_10 = (__pyx_v_least_err < __pyx_v_ACCEPTABLE_DISTANCE_PIXELS);
    if (__pyx_10) {

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":373
 *             break # if we don't have e.g. 4 cameras, we won't have 5
 *         if least_err < ACCEPTABLE_DISTANCE_PIXELS:
 *             mean_dist = least_err             # <<<<<<<<<<<<<<
 *             best_n_cams = n_cams
 * 
 */
      __pyx_v_mean_dist = __pyx_v_least_err;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":374
 *         if least_err < ACCEPTABLE_DISTANCE_PIXELS:
 *             mean_dist = least_err
 *             best_n_cams = n_cams             # <<<<<<<<<<<<<<
 * 
 *     # now calculate final values
 */
      __pyx_v_best_n_cams = __pyx_v_n_cams;
      goto __pyx_L32;
    }
    __pyx_L32:;
  }
  __pyx_L29:;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":377
 * 
 *     # now calculate final values
 *     cam_ids_used = cam_ids_for_least_err[best_n_cams]             # <<<<<<<<<<<<<<
 *     X = X_for_least_err[best_n_cams]
 * 
 */
  __pyx_1 = __Pyx_GetItemInt(__pyx_v_cam_ids_for_least_err, __pyx_v_best_n_cams, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 377; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_cam_ids_used);
  __pyx_v_cam_ids_used = __pyx_1;
  __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":378
 *     # now calculate final values
 *     cam_ids_used = cam_ids_for_least_err[best_n_cams]
 *     X = X_for_least_err[best_n_cams]             # <<<<<<<<<<<<<<
 * 
 *     # calculate line3d
 */
  __pyx_4 = __Pyx_GetItemInt(__pyx_v_X_for_least_err, __pyx_v_best_n_cams, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 378; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_X);
  __pyx_v_X = __pyx_4;
  __pyx_4 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":381
 * 
 *     # calculate line3d
 *     P = []             # <<<<<<<<<<<<<<
 *     for cam_id in cam_ids_used:
 *         x,y,area,slope,eccentricity, p1,p2,p3,p4 = d2[cam_id]
 */
  __pyx_2 = PyList_New(0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 381; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_v_P);
  __pyx_v_P = ((PyObject *)__pyx_2);
  __pyx_2 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":382
 *     # calculate line3d
 *     P = []
 *     for cam_id in cam_ids_used:             # <<<<<<<<<<<<<<
 *         x,y,area,slope,eccentricity, p1,p2,p3,p4 = d2[cam_id]
 *         if eccentricity > MINIMUM_ECCENTRICITY and not numpy.isnan(p1):
 */
  if (PyList_CheckExact(__pyx_v_cam_ids_used) || PyTuple_CheckExact(__pyx_v_cam_ids_used)) {
    __pyx_11 = 0; __pyx_7 = __pyx_v_cam_ids_used; Py_INCREF(__pyx_7);
  } else {
    __pyx_11 = -1; __pyx_7 = PyObject_GetIter(__pyx_v_cam_ids_used); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 382; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  }
  for (;;) {
    if (likely(PyList_CheckExact(__pyx_7))) {
      if (__pyx_11 >= PyList_GET_SIZE(__pyx_7)) break;
      __pyx_12 = PyList_GET_ITEM(__pyx_7, __pyx_11); Py_INCREF(__pyx_12); __pyx_11++;
    } else if (likely(PyTuple_CheckExact(__pyx_7))) {
      if (__pyx_11 >= PyTuple_GET_SIZE(__pyx_7)) break;
      __pyx_12 = PyTuple_GET_ITEM(__pyx_7, __pyx_11); Py_INCREF(__pyx_12); __pyx_11++;
    } else {
      __pyx_12 = PyIter_Next(__pyx_7);
      if (!__pyx_12) {
        if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 382; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
        break;
      }
    }
    Py_DECREF(__pyx_v_cam_id);
    __pyx_v_cam_id = __pyx_12;
    __pyx_12 = 0;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":383
 *     P = []
 *     for cam_id in cam_ids_used:
 *         x,y,area,slope,eccentricity, p1,p2,p3,p4 = d2[cam_id]             # <<<<<<<<<<<<<<
 *         if eccentricity > MINIMUM_ECCENTRICITY and not numpy.isnan(p1):
 *                 P.append( (p1,p2,p3,p4) )
 */
    __pyx_6 = PyObject_GetItem(__pyx_v_d2, __pyx_v_cam_id); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (PyTuple_CheckExact(__pyx_6) && PyTuple_GET_SIZE(__pyx_6) == 9) {
      PyObject* tuple = __pyx_6;
      __pyx_4 = PyTuple_GET_ITEM(tuple, 0);
      Py_INCREF(__pyx_4);
      __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_4); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_v_x = __pyx_8;
      __pyx_2 = PyTuple_GET_ITEM(tuple, 1);
      Py_INCREF(__pyx_2);
      __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_v_y = __pyx_8;
      __pyx_12 = PyTuple_GET_ITEM(tuple, 2);
      Py_INCREF(__pyx_12);
      Py_DECREF(__pyx_v_area);
      __pyx_v_area = __pyx_12;
      __pyx_12 = 0;
      __pyx_4 = PyTuple_GET_ITEM(tuple, 3);
      Py_INCREF(__pyx_4);
      Py_DECREF(__pyx_v_slope);
      __pyx_v_slope = __pyx_4;
      __pyx_4 = 0;
      __pyx_2 = PyTuple_GET_ITEM(tuple, 4);
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_eccentricity);
      __pyx_v_eccentricity = __pyx_2;
      __pyx_2 = 0;
      __pyx_12 = PyTuple_GET_ITEM(tuple, 5);
      Py_INCREF(__pyx_12);
      Py_DECREF(__pyx_v_p1);
      __pyx_v_p1 = __pyx_12;
      __pyx_12 = 0;
      __pyx_4 = PyTuple_GET_ITEM(tuple, 6);
      Py_INCREF(__pyx_4);
      Py_DECREF(__pyx_v_p2);
      __pyx_v_p2 = __pyx_4;
      __pyx_4 = 0;
      __pyx_2 = PyTuple_GET_ITEM(tuple, 7);
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_p3);
      __pyx_v_p3 = __pyx_2;
      __pyx_2 = 0;
      __pyx_12 = PyTuple_GET_ITEM(tuple, 8);
      Py_INCREF(__pyx_12);
      Py_DECREF(__pyx_v_p4);
      __pyx_v_p4 = __pyx_12;
      __pyx_12 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
    }
    else {
      __pyx_1 = PyObject_GetIter(__pyx_6); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_4 = __Pyx_UnpackItem(__pyx_1, 0); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_4); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_v_x = __pyx_8;
      __pyx_2 = __Pyx_UnpackItem(__pyx_1, 1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_v_y = __pyx_8;
      __pyx_12 = __Pyx_UnpackItem(__pyx_1, 2); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_v_area);
      __pyx_v_area = __pyx_12;
      __pyx_12 = 0;
      __pyx_4 = __Pyx_UnpackItem(__pyx_1, 3); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_v_slope);
      __pyx_v_slope = __pyx_4;
      __pyx_4 = 0;
      __pyx_2 = __Pyx_UnpackItem(__pyx_1, 4); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_v_eccentricity);
      __pyx_v_eccentricity = __pyx_2;
      __pyx_2 = 0;
      __pyx_12 = __Pyx_UnpackItem(__pyx_1, 5); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_v_p1);
      __pyx_v_p1 = __pyx_12;
      __pyx_12 = 0;
      __pyx_4 = __Pyx_UnpackItem(__pyx_1, 6); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_v_p2);
      __pyx_v_p2 = __pyx_4;
      __pyx_4 = 0;
      __pyx_2 = __Pyx_UnpackItem(__pyx_1, 7); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_v_p3);
      __pyx_v_p3 = __pyx_2;
      __pyx_2 = 0;
      __pyx_12 = __Pyx_UnpackItem(__pyx_1, 8); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_v_p4);
      __pyx_v_p4 = __pyx_12;
      __pyx_12 = 0;
      if (__Pyx_EndUnpack(__pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 383; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
    }

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":384
 *     for cam_id in cam_ids_used:
 *         x,y,area,slope,eccentricity, p1,p2,p3,p4 = d2[cam_id]
 *         if eccentricity > MINIMUM_ECCENTRICITY and not numpy.isnan(p1):             # <<<<<<<<<<<<<<
 *                 P.append( (p1,p2,p3,p4) )
 *     if len(P) < 2:
 */
    __pyx_2 = PyFloat_FromDouble(__pyx_v_17reconstruct_utils_MINIMUM_ECCENTRICITY); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_4 = PyObject_RichCompare(__pyx_v_eccentricity, __pyx_2, Py_GT); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    __pyx_10 = __Pyx_PyObject_IsTrue(__pyx_4); if (unlikely(__pyx_10 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    if (__pyx_10) {
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_12 = __Pyx_GetName(__pyx_m, __pyx_kp_numpy); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_6 = PyObject_GetAttr(__pyx_12, __pyx_kp_isnan); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_12); __pyx_12 = 0;
      __pyx_1 = PyTuple_New(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_INCREF(__pyx_v_p1);
      PyTuple_SET_ITEM(__pyx_1, 0, __pyx_v_p1);
      __pyx_2 = PyObject_Call(__pyx_6, ((PyObject *)__pyx_1), NULL); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;
      __pyx_10 = __Pyx_PyObject_IsTrue(__pyx_2); if (unlikely(__pyx_10 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_4 = __Pyx_PyBool_FromLong((!__pyx_10)); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    }
    __pyx_10 = __Pyx_PyObject_IsTrue(__pyx_4); if (unlikely(__pyx_10 < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 384; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_4); __pyx_4 = 0;
    if (__pyx_10) {

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":385
 *         x,y,area,slope,eccentricity, p1,p2,p3,p4 = d2[cam_id]
 *         if eccentricity > MINIMUM_ECCENTRICITY and not numpy.isnan(p1):
 *                 P.append( (p1,p2,p3,p4) )             # <<<<<<<<<<<<<<
 *     if len(P) < 2:
 *         Lcoords = None
 */
      __pyx_12 = PyTuple_New(4); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_INCREF(__pyx_v_p1);
      PyTuple_SET_ITEM(__pyx_12, 0, __pyx_v_p1);
      Py_INCREF(__pyx_v_p2);
      PyTuple_SET_ITEM(__pyx_12, 1, __pyx_v_p2);
      Py_INCREF(__pyx_v_p3);
      PyTuple_SET_ITEM(__pyx_12, 2, __pyx_v_p3);
      Py_INCREF(__pyx_v_p4);
      PyTuple_SET_ITEM(__pyx_12, 3, __pyx_v_p4);
      __pyx_6 = __Pyx_PyObject_Append(__pyx_v_P, ((PyObject *)__pyx_12)); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 385; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(((PyObject *)__pyx_12)); __pyx_12 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      goto __pyx_L35;
    }
    __pyx_L35:;
  }
  Py_DECREF(__pyx_7); __pyx_7 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":386
 *         if eccentricity > MINIMUM_ECCENTRICITY and not numpy.isnan(p1):
 *                 P.append( (p1,p2,p3,p4) )
 *     if len(P) < 2:             # <<<<<<<<<<<<<<
 *         Lcoords = None
 *     else:
 */
  __pyx_3 = PyObject_Length(__pyx_v_P); if (unlikely(__pyx_3 == -1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 386; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_10 = (__pyx_3 < 2);
  if (__pyx_10) {

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":387
 *                 P.append( (p1,p2,p3,p4) )
 *     if len(P) < 2:
 *         Lcoords = None             # <<<<<<<<<<<<<<
 *     else:
 *         P = numpy.array(P)
 */
    Py_INCREF(Py_None);
    Py_DECREF(__pyx_v_Lcoords);
    __pyx_v_Lcoords = Py_None;
    goto __pyx_L36;
  }
  /*else*/ {

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":389
 *         Lcoords = None
 *     else:
 *         P = numpy.array(P)             # <<<<<<<<<<<<<<
 *         try:
 *             u,d,vt=svd(P,full_matrices=True)
 */
    __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_numpy); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_array); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    __pyx_4 = PyTuple_New(1); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_INCREF(__pyx_v_P);
    PyTuple_SET_ITEM(__pyx_4, 0, __pyx_v_P);
    __pyx_12 = PyObject_Call(__pyx_2, ((PyObject *)__pyx_4), NULL); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 389; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_2); __pyx_2 = 0;
    Py_DECREF(((PyObject *)__pyx_4)); __pyx_4 = 0;
    Py_DECREF(__pyx_v_P);
    __pyx_v_P = __pyx_12;
    __pyx_12 = 0;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":390
 *     else:
 *         P = numpy.array(P)
 *         try:             # <<<<<<<<<<<<<<
 *             u,d,vt=svd(P,full_matrices=True)
 *         except numpy.linalg.LinAlgError, err:
 */
    /*try:*/ {

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":391
 *         P = numpy.array(P)
 *         try:
 *             u,d,vt=svd(P,full_matrices=True)             # <<<<<<<<<<<<<<
 *         except numpy.linalg.LinAlgError, err:
 *             print 'SVD error, P=',repr(P)
 */
      __pyx_6 = PyTuple_New(1); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L37_error;}
      Py_INCREF(__pyx_v_P);
      PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_P);
      __pyx_7 = PyDict_New(); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L37_error;}
      __pyx_1 = __Pyx_PyBool_FromLong(1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L37_error;}
      if (PyDict_SetItem(__pyx_7, __pyx_kp_full_matrices, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L37_error;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      __pyx_2 = PyEval_CallObjectWithKeywords(__pyx_v_svd, ((PyObject *)__pyx_6), ((PyObject *)__pyx_7)); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L37_error;}
      Py_DECREF(((PyObject *)__pyx_6)); __pyx_6 = 0;
      Py_DECREF(((PyObject *)__pyx_7)); __pyx_7 = 0;
      if (PyTuple_CheckExact(__pyx_2) && PyTuple_GET_SIZE(__pyx_2) == 3) {
        PyObject* tuple = __pyx_2;
        __pyx_12 = PyTuple_GET_ITEM(tuple, 0);
        Py_INCREF(__pyx_12);
        Py_DECREF(__pyx_v_u);
        __pyx_v_u = __pyx_12;
        __pyx_12 = 0;
        __pyx_1 = PyTuple_GET_ITEM(tuple, 1);
        Py_INCREF(__pyx_1);
        Py_DECREF(__pyx_v_d);
        __pyx_v_d = __pyx_1;
        __pyx_1 = 0;
        __pyx_6 = PyTuple_GET_ITEM(tuple, 2);
        Py_INCREF(__pyx_6);
        Py_DECREF(__pyx_v_vt);
        __pyx_v_vt = __pyx_6;
        __pyx_6 = 0;
        Py_DECREF(__pyx_2); __pyx_2 = 0;
      }
      else {
        __pyx_4 = PyObject_GetIter(__pyx_2); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L37_error;}
        Py_DECREF(__pyx_2); __pyx_2 = 0;
        __pyx_12 = __Pyx_UnpackItem(__pyx_4, 0); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L37_error;}
        Py_DECREF(__pyx_v_u);
        __pyx_v_u = __pyx_12;
        __pyx_12 = 0;
        __pyx_1 = __Pyx_UnpackItem(__pyx_4, 1); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L37_error;}
        Py_DECREF(__pyx_v_d);
        __pyx_v_d = __pyx_1;
        __pyx_1 = 0;
        __pyx_6 = __Pyx_UnpackItem(__pyx_4, 2); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L37_error;}
        Py_DECREF(__pyx_v_vt);
        __pyx_v_vt = __pyx_6;
        __pyx_6 = 0;
        if (__Pyx_EndUnpack(__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 391; __pyx_clineno = __LINE__; goto __pyx_L37_error;}
        Py_DECREF(__pyx_4); __pyx_4 = 0;
      }
    }
    /*else:*/ {

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":400
 *             raise
 *         else:
 *             P = vt[0,:] # P,Q are planes (take row because this is transpose(V))             # <<<<<<<<<<<<<<
 *             Q = vt[1,:]
 * 
 */
      __pyx_4 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 400; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_6 = PyTuple_New(2); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 400; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_INCREF(__pyx_int_0);
      PyTuple_SET_ITEM(__pyx_6, 0, __pyx_int_0);
      PyTuple_SET_ITEM(__pyx_6, 1, __pyx_4);
      __pyx_4 = 0;
      __pyx_2 = PyObject_GetItem(__pyx_v_vt, ((PyObject *)__pyx_6)); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 400; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(((PyObject *)__pyx_6)); __pyx_6 = 0;
      Py_DECREF(__pyx_v_P);
      __pyx_v_P = __pyx_2;
      __pyx_2 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":401
 *         else:
 *             P = vt[0,:] # P,Q are planes (take row because this is transpose(V))
 *             Q = vt[1,:]             # <<<<<<<<<<<<<<
 * 
 *             # directly to Pluecker line coordinates
 */
      __pyx_1 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_7 = PyTuple_New(2); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_INCREF(__pyx_int_1);
      PyTuple_SET_ITEM(__pyx_7, 0, __pyx_int_1);
      PyTuple_SET_ITEM(__pyx_7, 1, __pyx_1);
      __pyx_1 = 0;
      __pyx_12 = PyObject_GetItem(__pyx_v_vt, ((PyObject *)__pyx_7)); if (!__pyx_12) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 401; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(((PyObject *)__pyx_7)); __pyx_7 = 0;
      Py_DECREF(__pyx_v_Q);
      __pyx_v_Q = __pyx_12;
      __pyx_12 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":404
 * 
 *             # directly to Pluecker line coordinates
 *             Lcoords = ( -(P[3]*Q[2]) + P[2]*Q[3],             # <<<<<<<<<<<<<<
 *                           P[3]*Q[1]  - P[1]*Q[3],
 *                         -(P[2]*Q[1]) + P[1]*Q[2],
 */
      __pyx_4 = __Pyx_GetItemInt(__pyx_v_P, 3, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_6 = __Pyx_GetItemInt(__pyx_v_Q, 2, 0); if (!__pyx_6) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_2 = PyNumber_Multiply(__pyx_4, __pyx_6); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      __pyx_1 = PyNumber_Negative(__pyx_2); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_7 = __Pyx_GetItemInt(__pyx_v_P, 2, 0); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_12 = __Pyx_GetItemInt(__pyx_v_Q, 3, 0); if (!__pyx_12) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_4 = PyNumber_Multiply(__pyx_7, __pyx_12); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_12); __pyx_12 = 0;
      __pyx_6 = PyNumber_Add(__pyx_1, __pyx_4); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":405
 *             # directly to Pluecker line coordinates
 *             Lcoords = ( -(P[3]*Q[2]) + P[2]*Q[3],
 *                           P[3]*Q[1]  - P[1]*Q[3],             # <<<<<<<<<<<<<<
 *                         -(P[2]*Q[1]) + P[1]*Q[2],
 *                         -(P[3]*Q[0]) + P[0]*Q[3],
 */
      __pyx_2 = __Pyx_GetItemInt(__pyx_v_P, 3, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_7 = __Pyx_GetItemInt(__pyx_v_Q, 1, 0); if (!__pyx_7) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_12 = PyNumber_Multiply(__pyx_2, __pyx_7); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      __pyx_1 = __Pyx_GetItemInt(__pyx_v_P, 1, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_4 = __Pyx_GetItemInt(__pyx_v_Q, 3, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_2 = PyNumber_Multiply(__pyx_1, __pyx_4); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_7 = PyNumber_Subtract(__pyx_12, __pyx_2); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 405; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_12); __pyx_12 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":406
 *             Lcoords = ( -(P[3]*Q[2]) + P[2]*Q[3],
 *                           P[3]*Q[1]  - P[1]*Q[3],
 *                         -(P[2]*Q[1]) + P[1]*Q[2],             # <<<<<<<<<<<<<<
 *                         -(P[3]*Q[0]) + P[0]*Q[3],
 *                         -(P[2]*Q[0]) + P[0]*Q[2],
 */
      __pyx_1 = __Pyx_GetItemInt(__pyx_v_P, 2, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 406; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_4 = __Pyx_GetItemInt(__pyx_v_Q, 1, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 406; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_12 = PyNumber_Multiply(__pyx_1, __pyx_4); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 406; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_2 = PyNumber_Negative(__pyx_12); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 406; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_12); __pyx_12 = 0;
      __pyx_1 = __Pyx_GetItemInt(__pyx_v_P, 1, 0); if (!__pyx_1) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 406; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_4 = __Pyx_GetItemInt(__pyx_v_Q, 2, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 406; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_12 = PyNumber_Multiply(__pyx_1, __pyx_4); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 406; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_1 = PyNumber_Add(__pyx_2, __pyx_12); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 406; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_12); __pyx_12 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":407
 *                           P[3]*Q[1]  - P[1]*Q[3],
 *                         -(P[2]*Q[1]) + P[1]*Q[2],
 *                         -(P[3]*Q[0]) + P[0]*Q[3],             # <<<<<<<<<<<<<<
 *                         -(P[2]*Q[0]) + P[0]*Q[2],
 *                         -(P[1]*Q[0]) + P[0]*Q[1] )
 */
      __pyx_4 = __Pyx_GetItemInt(__pyx_v_P, 3, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_2 = __Pyx_GetItemInt(__pyx_v_Q, 0, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_12 = PyNumber_Multiply(__pyx_4, __pyx_2); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      __pyx_4 = PyNumber_Negative(__pyx_12); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_12); __pyx_12 = 0;
      __pyx_2 = __Pyx_GetItemInt(__pyx_v_P, 0, 0); if (!__pyx_2) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_12 = __Pyx_GetItemInt(__pyx_v_Q, 3, 0); if (!__pyx_12) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_13 = PyNumber_Multiply(__pyx_2, __pyx_12); if (unlikely(!__pyx_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_12); __pyx_12 = 0;
      __pyx_2 = PyNumber_Add(__pyx_4, __pyx_13); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 407; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_13); __pyx_13 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":408
 *                         -(P[2]*Q[1]) + P[1]*Q[2],
 *                         -(P[3]*Q[0]) + P[0]*Q[3],
 *                         -(P[2]*Q[0]) + P[0]*Q[2],             # <<<<<<<<<<<<<<
 *                         -(P[1]*Q[0]) + P[0]*Q[1] )
 *             if isnan(Lcoords[0]):
 */
      __pyx_12 = __Pyx_GetItemInt(__pyx_v_P, 2, 0); if (!__pyx_12) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_4 = __Pyx_GetItemInt(__pyx_v_Q, 0, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_13 = PyNumber_Multiply(__pyx_12, __pyx_4); if (unlikely(!__pyx_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_12); __pyx_12 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      __pyx_12 = PyNumber_Negative(__pyx_13); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_13); __pyx_13 = 0;
      __pyx_4 = __Pyx_GetItemInt(__pyx_v_P, 0, 0); if (!__pyx_4) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_13 = __Pyx_GetItemInt(__pyx_v_Q, 2, 0); if (!__pyx_13) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_14 = PyNumber_Multiply(__pyx_4, __pyx_13); if (unlikely(!__pyx_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      Py_DECREF(__pyx_13); __pyx_13 = 0;
      __pyx_4 = PyNumber_Add(__pyx_12, __pyx_14); if (unlikely(!__pyx_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 408; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_12); __pyx_12 = 0;
      Py_DECREF(__pyx_14); __pyx_14 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":409
 *                         -(P[3]*Q[0]) + P[0]*Q[3],
 *                         -(P[2]*Q[0]) + P[0]*Q[2],
 *                         -(P[1]*Q[0]) + P[0]*Q[1] )             # <<<<<<<<<<<<<<
 *             if isnan(Lcoords[0]):
 *                 Lcoords = None
 */
      __pyx_13 = __Pyx_GetItemInt(__pyx_v_P, 1, 0); if (!__pyx_13) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_12 = __Pyx_GetItemInt(__pyx_v_Q, 0, 0); if (!__pyx_12) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_14 = PyNumber_Multiply(__pyx_13, __pyx_12); if (unlikely(!__pyx_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_13); __pyx_13 = 0;
      Py_DECREF(__pyx_12); __pyx_12 = 0;
      __pyx_13 = PyNumber_Negative(__pyx_14); if (unlikely(!__pyx_13)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_14); __pyx_14 = 0;
      __pyx_12 = __Pyx_GetItemInt(__pyx_v_P, 0, 0); if (!__pyx_12) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_14 = __Pyx_GetItemInt(__pyx_v_Q, 1, 0); if (!__pyx_14) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_15 = PyNumber_Multiply(__pyx_12, __pyx_14); if (unlikely(!__pyx_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_12); __pyx_12 = 0;
      Py_DECREF(__pyx_14); __pyx_14 = 0;
      __pyx_12 = PyNumber_Add(__pyx_13, __pyx_15); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 409; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_13); __pyx_13 = 0;
      Py_DECREF(__pyx_15); __pyx_15 = 0;
      __pyx_14 = PyTuple_New(6); if (unlikely(!__pyx_14)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 404; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      PyTuple_SET_ITEM(__pyx_14, 0, __pyx_6);
      PyTuple_SET_ITEM(__pyx_14, 1, __pyx_7);
      PyTuple_SET_ITEM(__pyx_14, 2, __pyx_1);
      PyTuple_SET_ITEM(__pyx_14, 3, __pyx_2);
      PyTuple_SET_ITEM(__pyx_14, 4, __pyx_4);
      PyTuple_SET_ITEM(__pyx_14, 5, __pyx_12);
      __pyx_6 = 0;
      __pyx_7 = 0;
      __pyx_1 = 0;
      __pyx_2 = 0;
      __pyx_4 = 0;
      __pyx_12 = 0;
      Py_DECREF(__pyx_v_Lcoords);
      __pyx_v_Lcoords = ((PyObject *)__pyx_14);
      __pyx_14 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":410
 *                         -(P[2]*Q[0]) + P[0]*Q[2],
 *                         -(P[1]*Q[0]) + P[0]*Q[1] )
 *             if isnan(Lcoords[0]):             # <<<<<<<<<<<<<<
 *                 Lcoords = None
 *     ## c_lib.free(least_err_by_n_cameras)
 */
      __pyx_13 = __Pyx_GetItemInt(__pyx_v_Lcoords, 0, 0); if (!__pyx_13) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_8 = __pyx_PyFloat_AsDouble(__pyx_13); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 410; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_13); __pyx_13 = 0;
      __pyx_5 = isnan(__pyx_8);
      if (__pyx_5) {

        /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":411
 *                         -(P[1]*Q[0]) + P[0]*Q[1] )
 *             if isnan(Lcoords[0]):
 *                 Lcoords = None             # <<<<<<<<<<<<<<
 *     ## c_lib.free(least_err_by_n_cameras)
 *     return X, Lcoords, cam_ids_used, mean_dist
 */
        Py_INCREF(Py_None);
        Py_DECREF(__pyx_v_Lcoords);
        __pyx_v_Lcoords = Py_None;
        goto __pyx_L39;
      }
      __pyx_L39:;
    }
    goto __pyx_L38;
    __pyx_L37_error:;
    Py_XDECREF(__pyx_7); __pyx_7 = 0;
    Py_XDECREF(__pyx_12); __pyx_12 = 0;
    Py_XDECREF(__pyx_1); __pyx_1 = 0;
    Py_XDECREF(__pyx_6); __pyx_6 = 0;
    Py_XDECREF(__pyx_2); __pyx_2 = 0;
    Py_XDECREF(__pyx_4); __pyx_4 = 0;

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":392
 *         try:
 *             u,d,vt=svd(P,full_matrices=True)
 *         except numpy.linalg.LinAlgError, err:             # <<<<<<<<<<<<<<
 *             print 'SVD error, P=',repr(P)
 *             Lcoords = None
 */
    __pyx_7 = __Pyx_GetName(__pyx_m, __pyx_kp_numpy); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    __pyx_12 = PyObject_GetAttr(__pyx_7, __pyx_kp_linalg); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_7); __pyx_7 = 0;
    __pyx_1 = PyObject_GetAttr(__pyx_12, __pyx_kp_LinAlgError); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
    Py_DECREF(__pyx_12); __pyx_12 = 0;
    __pyx_5 = PyErr_ExceptionMatches(__pyx_1);
    Py_DECREF(__pyx_1); __pyx_1 = 0;
    if (__pyx_5) {
      __Pyx_AddTraceback("reconstruct_utils.hypothesis_testing_algorithm__find_best_3d");
      if (__Pyx_GetException(&__pyx_6, &__pyx_2, &__pyx_4) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 392; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_INCREF(__pyx_2);
      Py_DECREF(__pyx_v_err);
      __pyx_v_err = __pyx_2;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":393
 *             u,d,vt=svd(P,full_matrices=True)
 *         except numpy.linalg.LinAlgError, err:
 *             print 'SVD error, P=',repr(P)             # <<<<<<<<<<<<<<
 *             Lcoords = None
 *         except:
 */
      __pyx_7 = PyObject_Repr(__pyx_v_P); if (unlikely(!__pyx_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 393; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      __pyx_12 = PyTuple_New(2); if (unlikely(!__pyx_12)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 393; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_INCREF(__pyx_kp_67);
      PyTuple_SET_ITEM(__pyx_12, 0, __pyx_kp_67);
      PyTuple_SET_ITEM(__pyx_12, 1, __pyx_7);
      __pyx_7 = 0;
      if (__Pyx_Print(((PyObject *)__pyx_12), 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 393; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(((PyObject *)__pyx_12)); __pyx_12 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":394
 *         except numpy.linalg.LinAlgError, err:
 *             print 'SVD error, P=',repr(P)
 *             Lcoords = None             # <<<<<<<<<<<<<<
 *         except:
 *             print 'Error on P'
 */
      Py_INCREF(Py_None);
      Py_DECREF(__pyx_v_Lcoords);
      __pyx_v_Lcoords = Py_None;
      Py_DECREF(__pyx_6); __pyx_6 = 0;
      Py_DECREF(__pyx_2); __pyx_2 = 0;
      Py_DECREF(__pyx_4); __pyx_4 = 0;
      goto __pyx_L38;
    }

    /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":395
 *             print 'SVD error, P=',repr(P)
 *             Lcoords = None
 *         except:             # <<<<<<<<<<<<<<
 *             print 'Error on P'
 *             print P
 */
    /*except:*/ {
      __Pyx_AddTraceback("reconstruct_utils.hypothesis_testing_algorithm__find_best_3d");
      if (__Pyx_GetException(&__pyx_1, &__pyx_7, &__pyx_12) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 395; __pyx_clineno = __LINE__; goto __pyx_L1_error;}

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":396
 *             Lcoords = None
 *         except:
 *             print 'Error on P'             # <<<<<<<<<<<<<<
 *             print P
 *             raise
 */
      __pyx_6 = PyTuple_New(1); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_INCREF(__pyx_kp_68);
      PyTuple_SET_ITEM(__pyx_6, 0, __pyx_kp_68);
      if (__Pyx_Print(((PyObject *)__pyx_6), 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 396; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(((PyObject *)__pyx_6)); __pyx_6 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":397
 *         except:
 *             print 'Error on P'
 *             print P             # <<<<<<<<<<<<<<
 *             raise
 *         else:
 */
      __pyx_2 = PyTuple_New(1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 397; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_INCREF(__pyx_v_P);
      PyTuple_SET_ITEM(__pyx_2, 0, __pyx_v_P);
      if (__Pyx_Print(((PyObject *)__pyx_2), 1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 397; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;

      /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":398
 *             print 'Error on P'
 *             print P
 *             raise             # <<<<<<<<<<<<<<
 *         else:
 *             P = vt[0,:] # P,Q are planes (take row because this is transpose(V))
 */
      __Pyx_Raise(__pyx_1, __pyx_7, __pyx_12);
      {__pyx_filename = __pyx_f[0]; __pyx_lineno = 398; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
      Py_DECREF(__pyx_1); __pyx_1 = 0;
      Py_DECREF(__pyx_7); __pyx_7 = 0;
      Py_DECREF(__pyx_12); __pyx_12 = 0;
      goto __pyx_L38;
    }
    __pyx_L38:;
  }
  __pyx_L36:;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":413
 *                 Lcoords = None
 *     ## c_lib.free(least_err_by_n_cameras)
 *     return X, Lcoords, cam_ids_used, mean_dist             # <<<<<<<<<<<<<<
 * 
 * ## def undistort_image( char* src, int srcstep,
 */
  __pyx_15 = PyFloat_FromDouble(__pyx_v_mean_dist); if (unlikely(!__pyx_15)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_6 = PyTuple_New(4); if (unlikely(!__pyx_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 413; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_v_X);
  PyTuple_SET_ITEM(__pyx_6, 0, __pyx_v_X);
  Py_INCREF(__pyx_v_Lcoords);
  PyTuple_SET_ITEM(__pyx_6, 1, __pyx_v_Lcoords);
  Py_INCREF(__pyx_v_cam_ids_used);
  PyTuple_SET_ITEM(__pyx_6, 2, __pyx_v_cam_ids_used);
  PyTuple_SET_ITEM(__pyx_6, 3, __pyx_15);
  __pyx_15 = 0;
  __pyx_r = ((PyObject *)__pyx_6);
  __pyx_6 = 0;
  goto __pyx_L0;

  __pyx_r = Py_None; Py_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_4);
  Py_XDECREF(__pyx_6);
  Py_XDECREF(__pyx_7);
  Py_XDECREF(__pyx_12);
  Py_XDECREF(__pyx_13);
  Py_XDECREF(__pyx_14);
  Py_XDECREF(__pyx_15);
  __Pyx_AddTraceback("reconstruct_utils.hypothesis_testing_algorithm__find_best_3d");
  __pyx_r = NULL;
  __pyx_L0:;
  Py_DECREF(__pyx_v_svd);
  Py_DECREF(__pyx_v_cam_ids);
  Py_DECREF(__pyx_v_least_err_by_n_cameras);
  Py_DECREF(__pyx_v_allA);
  Py_DECREF(__pyx_v_bad_cam_ids);
  Py_DECREF(__pyx_v_cam_id2idx);
  Py_DECREF(__pyx_v_all2d);
  Py_DECREF(__pyx_v_Pmat_fastnx);
  Py_DECREF(__pyx_v_cam_id);
  Py_DECREF(__pyx_v_value_tuple);
  Py_DECREF(__pyx_v_xy_values);
  Py_DECREF(__pyx_v_Pmat);
  Py_DECREF(__pyx_v_row3);
  Py_DECREF(__pyx_v_cam_ids_for_least_err);
  Py_DECREF(__pyx_v_X_for_least_err);
  Py_DECREF(__pyx_v_cam_ids_used);
  Py_DECREF(__pyx_v_good_A_idx);
  Py_DECREF(__pyx_v_A);
  Py_DECREF(__pyx_v_u);
  Py_DECREF(__pyx_v_d);
  Py_DECREF(__pyx_v_vt);
  Py_DECREF(__pyx_v_X);
  Py_DECREF(__pyx_v_new_xyw);
  Py_DECREF(__pyx_v_P);
  Py_DECREF(__pyx_v_area);
  Py_DECREF(__pyx_v_slope);
  Py_DECREF(__pyx_v_eccentricity);
  Py_DECREF(__pyx_v_p1);
  Py_DECREF(__pyx_v_p2);
  Py_DECREF(__pyx_v_p3);
  Py_DECREF(__pyx_v_p4);
  Py_DECREF(__pyx_v_Lcoords);
  Py_DECREF(__pyx_v_err);
  Py_DECREF(__pyx_v_Q);
  return __pyx_r;
}

static PyObject *__pyx_tp_new_17reconstruct_utils_ReconstructHelper(PyTypeObject *t, PyObject *a, PyObject *k) {
  PyObject *o = (*t->tp_alloc)(t, 0);
  if (!o) return 0;
  return o;
}

static void __pyx_tp_dealloc_17reconstruct_utils_ReconstructHelper(PyObject *o) {
  (*Py_TYPE(o)->tp_free)(o);
}

static struct PyMethodDef __pyx_methods_17reconstruct_utils_ReconstructHelper[] = {
  {"__reduce__", (PyCFunction)__pyx_pf_17reconstruct_utils_17ReconstructHelper___reduce__, METH_NOARGS, __pyx_doc_17reconstruct_utils_17ReconstructHelper___reduce__},
  {"add_element", (PyCFunction)__pyx_pf_17reconstruct_utils_17ReconstructHelper_add_element, METH_O, __pyx_doc_17reconstruct_utils_17ReconstructHelper_add_element},
  {"save_to_rad_file", (PyCFunction)__pyx_pf_17reconstruct_utils_17ReconstructHelper_save_to_rad_file, METH_VARARGS|METH_KEYWORDS, 0},
  {"get_K", (PyCFunction)__pyx_pf_17reconstruct_utils_17ReconstructHelper_get_K, METH_NOARGS, 0},
  {"get_nlparams", (PyCFunction)__pyx_pf_17reconstruct_utils_17ReconstructHelper_get_nlparams, METH_NOARGS, 0},
  {"undistort", (PyCFunction)__pyx_pf_17reconstruct_utils_17ReconstructHelper_undistort, METH_VARARGS|METH_KEYWORDS, __pyx_doc_17reconstruct_utils_17ReconstructHelper_undistort},
  {"distort", (PyCFunction)__pyx_pf_17reconstruct_utils_17ReconstructHelper_distort, METH_VARARGS|METH_KEYWORDS, __pyx_doc_17reconstruct_utils_17ReconstructHelper_distort},
  {"undistort_image", (PyCFunction)__pyx_pf_17reconstruct_utils_17ReconstructHelper_undistort_image, METH_O, 0},
  {0, 0, 0, 0}
};

static struct PyMemberDef __pyx_members_17reconstruct_utils_ReconstructHelper[] = {
  {"fc1", T_DOUBLE, offsetof(struct __pyx_obj_17reconstruct_utils_ReconstructHelper, fc1), READONLY, 0},
  {"fc2", T_DOUBLE, offsetof(struct __pyx_obj_17reconstruct_utils_ReconstructHelper, fc2), READONLY, 0},
  {"cc1", T_DOUBLE, offsetof(struct __pyx_obj_17reconstruct_utils_ReconstructHelper, cc1), READONLY, 0},
  {"cc2", T_DOUBLE, offsetof(struct __pyx_obj_17reconstruct_utils_ReconstructHelper, cc2), READONLY, 0},
  {"k1", T_DOUBLE, offsetof(struct __pyx_obj_17reconstruct_utils_ReconstructHelper, k1), READONLY, 0},
  {"k2", T_DOUBLE, offsetof(struct __pyx_obj_17reconstruct_utils_ReconstructHelper, k2), READONLY, 0},
  {"p1", T_DOUBLE, offsetof(struct __pyx_obj_17reconstruct_utils_ReconstructHelper, p1), READONLY, 0},
  {"p2", T_DOUBLE, offsetof(struct __pyx_obj_17reconstruct_utils_ReconstructHelper, p2), READONLY, 0},
  {"alpha_c", T_DOUBLE, offsetof(struct __pyx_obj_17reconstruct_utils_ReconstructHelper, alpha_c), READONLY, 0},
  {0, 0, 0, 0, 0}
};

static PyNumberMethods __pyx_tp_as_number_ReconstructHelper = {
  0, /*nb_add*/
  0, /*nb_subtract*/
  0, /*nb_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_divide*/
  #endif
  0, /*nb_remainder*/
  0, /*nb_divmod*/
  0, /*nb_power*/
  0, /*nb_negative*/
  0, /*nb_positive*/
  0, /*nb_absolute*/
  0, /*nb_nonzero*/
  0, /*nb_invert*/
  0, /*nb_lshift*/
  0, /*nb_rshift*/
  0, /*nb_and*/
  0, /*nb_xor*/
  0, /*nb_or*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_coerce*/
  #endif
  0, /*nb_int*/
  0, /*nb_long*/
  0, /*nb_float*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_oct*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*nb_hex*/
  #endif
  0, /*nb_inplace_add*/
  0, /*nb_inplace_subtract*/
  0, /*nb_inplace_multiply*/
  #if PY_MAJOR_VERSION < 3
  0, /*nb_inplace_divide*/
  #endif
  0, /*nb_inplace_remainder*/
  0, /*nb_inplace_power*/
  0, /*nb_inplace_lshift*/
  0, /*nb_inplace_rshift*/
  0, /*nb_inplace_and*/
  0, /*nb_inplace_xor*/
  0, /*nb_inplace_or*/
  0, /*nb_floor_divide*/
  0, /*nb_true_divide*/
  0, /*nb_inplace_floor_divide*/
  0, /*nb_inplace_true_divide*/
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_INDEX)
  0, /*nb_index*/
  #endif
};

static PySequenceMethods __pyx_tp_as_sequence_ReconstructHelper = {
  0, /*sq_length*/
  0, /*sq_concat*/
  0, /*sq_repeat*/
  0, /*sq_item*/
  0, /*sq_slice*/
  0, /*sq_ass_item*/
  0, /*sq_ass_slice*/
  0, /*sq_contains*/
  0, /*sq_inplace_concat*/
  0, /*sq_inplace_repeat*/
};

static PyMappingMethods __pyx_tp_as_mapping_ReconstructHelper = {
  0, /*mp_length*/
  0, /*mp_subscript*/
  0, /*mp_ass_subscript*/
};

static PyBufferProcs __pyx_tp_as_buffer_ReconstructHelper = {
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getreadbuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getwritebuffer*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getsegcount*/
  #endif
  #if PY_MAJOR_VERSION < 3
  0, /*bf_getcharbuffer*/
  #endif
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_NEWBUFFER)
  0, /*bf_getbuffer*/
  #endif
  #if (PY_MAJOR_VERSION >= 3) || (Py_TPFLAGS_DEFAULT & Py_TPFLAGS_HAVE_NEWBUFFER)
  0, /*bf_releasebuffer*/
  #endif
};

PyTypeObject __pyx_type_17reconstruct_utils_ReconstructHelper = {
  PyVarObject_HEAD_INIT(0, 0)
  "reconstruct_utils.ReconstructHelper", /*tp_name*/
  sizeof(struct __pyx_obj_17reconstruct_utils_ReconstructHelper), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_17reconstruct_utils_ReconstructHelper, /*tp_dealloc*/
  0, /*tp_print*/
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  0, /*tp_compare*/
  0, /*tp_repr*/
  &__pyx_tp_as_number_ReconstructHelper, /*tp_as_number*/
  &__pyx_tp_as_sequence_ReconstructHelper, /*tp_as_sequence*/
  &__pyx_tp_as_mapping_ReconstructHelper, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  &__pyx_tp_as_buffer_ReconstructHelper, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_BASETYPE, /*tp_flags*/
  0, /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  __pyx_pf_17reconstruct_utils_17ReconstructHelper___richcmp__, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  __pyx_methods_17reconstruct_utils_ReconstructHelper, /*tp_methods*/
  __pyx_members_17reconstruct_utils_ReconstructHelper, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  0, /*tp_dictoffset*/
  __pyx_pf_17reconstruct_utils_17ReconstructHelper___init__, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_17reconstruct_utils_ReconstructHelper, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
};

static struct PyMethodDef __pyx_methods[] = {
  {"make_ReconstructHelper_from_rad_file", (PyCFunction)__pyx_pf_17reconstruct_utils_make_ReconstructHelper_from_rad_file, METH_O, 0},
  {"ReconstructHelper_from_xml", (PyCFunction)__pyx_pf_17reconstruct_utils_ReconstructHelper_from_xml, METH_O, 0},
  {"make_ReconstructHelper", (PyCFunction)__pyx_pf_17reconstruct_utils_make_ReconstructHelper, METH_VARARGS|METH_KEYWORDS, 0},
  {"hypothesis_testing_algorithm__find_best_3d", (PyCFunction)__pyx_pf_17reconstruct_utils_hypothesis_testing_algorithm__find_best_3d, METH_VARARGS|METH_KEYWORDS, __pyx_doc_17reconstruct_utils_hypothesis_testing_algorithm__find_best_3d},
  {0, 0, 0, 0}
};

static void __pyx_init_filenames(void); /*proto*/

#if PY_MAJOR_VERSION >= 3
static struct PyModuleDef __pyx_moduledef = {
    PyModuleDef_HEAD_INIT,
    "reconstruct_utils",
    0, /* m_doc */
    -1, /* m_size */
    __pyx_methods /* m_methods */,
    NULL, /* m_reload */
    NULL, /* m_traverse */
    NULL, /* m_clear */
    NULL /* m_free */
};
#endif

static __Pyx_StringTabEntry __pyx_string_tab[] = {
  {&__pyx_kp___init__, __pyx_k___init__, sizeof(__pyx_k___init__), 0, 1, 1},
  {&__pyx_kp___reduce__, __pyx_k___reduce__, sizeof(__pyx_k___reduce__), 0, 1, 1},
  {&__pyx_kp_add_element, __pyx_k_add_element, sizeof(__pyx_k_add_element), 0, 1, 1},
  {&__pyx_kp_save_to_rad_file, __pyx_k_save_to_rad_file, sizeof(__pyx_k_save_to_rad_file), 0, 1, 1},
  {&__pyx_kp___richcmp__, __pyx_k___richcmp__, sizeof(__pyx_k___richcmp__), 0, 1, 1},
  {&__pyx_kp_get_K, __pyx_k_get_K, sizeof(__pyx_k_get_K), 0, 1, 1},
  {&__pyx_kp_get_nlparams, __pyx_k_get_nlparams, sizeof(__pyx_k_get_nlparams), 0, 1, 1},
  {&__pyx_kp_undistort, __pyx_k_undistort, sizeof(__pyx_k_undistort), 0, 1, 1},
  {&__pyx_kp_distort, __pyx_k_distort, sizeof(__pyx_k_distort), 0, 1, 1},
  {&__pyx_kp_undistort_image, __pyx_k_undistort_image, sizeof(__pyx_k_undistort_image), 0, 1, 1},
  {&__pyx_kp_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 1, 1, 1},
  {&__pyx_kp_1, __pyx_k_1, sizeof(__pyx_k_1), 1, 1, 1},
  {&__pyx_kp_inf, __pyx_k_inf, sizeof(__pyx_k_inf), 1, 1, 1},
  {&__pyx_kp_2, __pyx_k_2, sizeof(__pyx_k_2), 1, 1, 1},
  {&__pyx_kp_flydra, __pyx_k_flydra, sizeof(__pyx_k_flydra), 0, 1, 1},
  {&__pyx_kp_3, __pyx_k_3, sizeof(__pyx_k_3), 1, 1, 1},
  {&__pyx_kp_4, __pyx_k_4, sizeof(__pyx_k_4), 1, 1, 1},
  {&__pyx_kp_ET, __pyx_k_ET, sizeof(__pyx_k_ET), 0, 1, 1},
  {&__pyx_kp_common_variables, __pyx_k_common_variables, sizeof(__pyx_k_common_variables), 1, 1, 1},
  {&__pyx_kp_6, __pyx_k_6, sizeof(__pyx_k_6), 1, 1, 1},
  {&__pyx_kp_7, __pyx_k_7, sizeof(__pyx_k_7), 0, 1, 1},
  {&__pyx_kp_Exception, __pyx_k_Exception, sizeof(__pyx_k_Exception), 1, 1, 1},
  {&__pyx_kp_8, __pyx_k_8, sizeof(__pyx_k_8), 0, 1, 1},
  {&__pyx_kp_9, __pyx_k_9, sizeof(__pyx_k_9), 1, 1, 1},
  {&__pyx_kp_execfile, __pyx_k_execfile, sizeof(__pyx_k_execfile), 1, 1, 1},
  {&__pyx_kp_10, __pyx_k_10, sizeof(__pyx_k_10), 0, 1, 0},
  {&__pyx_kp_NotImplementedError, __pyx_k_NotImplementedError, sizeof(__pyx_k_NotImplementedError), 1, 1, 1},
  {&__pyx_kp_12, __pyx_k_12, sizeof(__pyx_k_12), 0, 1, 0},
  {&__pyx_kp_13, __pyx_k_13, sizeof(__pyx_k_13), 0, 1, 0},
  {&__pyx_kp_14, __pyx_k_14, sizeof(__pyx_k_14), 0, 1, 0},
  {&__pyx_kp_15, __pyx_k_15, sizeof(__pyx_k_15), 0, 1, 0},
  {&__pyx_kp_16, __pyx_k_16, sizeof(__pyx_k_16), 0, 1, 0},
  {&__pyx_kp_17, __pyx_k_17, sizeof(__pyx_k_17), 0, 1, 0},
  {&__pyx_kp_18, __pyx_k_18, sizeof(__pyx_k_18), 0, 1, 0},
  {&__pyx_kp_19, __pyx_k_19, sizeof(__pyx_k_19), 0, 1, 0},
  {&__pyx_kp_iselement, __pyx_k_iselement, sizeof(__pyx_k_iselement), 1, 1, 1},
  {&__pyx_kp_tag, __pyx_k_tag, sizeof(__pyx_k_tag), 1, 1, 1},
  {&__pyx_kp_20, __pyx_k_20, sizeof(__pyx_k_20), 0, 1, 0},
  {&__pyx_kp_21, __pyx_k_21, sizeof(__pyx_k_21), 0, 1, 0},
  {&__pyx_kp_22, __pyx_k_22, sizeof(__pyx_k_22), 0, 1, 0},
  {&__pyx_kp_23, __pyx_k_23, sizeof(__pyx_k_23), 0, 1, 0},
  {&__pyx_kp_24, __pyx_k_24, sizeof(__pyx_k_24), 0, 1, 0},
  {&__pyx_kp_25, __pyx_k_25, sizeof(__pyx_k_25), 0, 1, 0},
  {&__pyx_kp_26, __pyx_k_26, sizeof(__pyx_k_26), 0, 1, 0},
  {&__pyx_kp_27, __pyx_k_27, sizeof(__pyx_k_27), 0, 1, 0},
  {&__pyx_kp_28, __pyx_k_28, sizeof(__pyx_k_28), 0, 1, 0},
  {&__pyx_kp_29, __pyx_k_29, sizeof(__pyx_k_29), 0, 1, 0},
  {&__pyx_kp_append, __pyx_k_append, sizeof(__pyx_k_append), 1, 1, 1},
  {&__pyx_kp_find, __pyx_k_find, sizeof(__pyx_k_find), 1, 1, 1},
  {&__pyx_kp_text, __pyx_k_text, sizeof(__pyx_k_text), 1, 1, 1},
  {&__pyx_kp_30, __pyx_k_30, sizeof(__pyx_k_30), 0, 1, 1},
  {&__pyx_kp_SubElement, __pyx_k_SubElement, sizeof(__pyx_k_SubElement), 1, 1, 1},
  {&__pyx_kp_31, __pyx_k_31, sizeof(__pyx_k_31), 0, 1, 0},
  {&__pyx_kp_32, __pyx_k_32, sizeof(__pyx_k_32), 0, 1, 0},
  {&__pyx_kp_33, __pyx_k_33, sizeof(__pyx_k_33), 0, 1, 0},
  {&__pyx_kp_34, __pyx_k_34, sizeof(__pyx_k_34), 0, 1, 0},
  {&__pyx_kp_35, __pyx_k_35, sizeof(__pyx_k_35), 0, 1, 0},
  {&__pyx_kp_36, __pyx_k_36, sizeof(__pyx_k_36), 0, 1, 0},
  {&__pyx_kp_37, __pyx_k_37, sizeof(__pyx_k_37), 0, 1, 0},
  {&__pyx_kp_38, __pyx_k_38, sizeof(__pyx_k_38), 0, 1, 0},
  {&__pyx_kp_39, __pyx_k_39, sizeof(__pyx_k_39), 0, 1, 0},
  {&__pyx_kp_40, __pyx_k_40, sizeof(__pyx_k_40), 0, 1, 0},
  {&__pyx_kp_open, __pyx_k_open, sizeof(__pyx_k_open), 1, 1, 1},
  {&__pyx_kp_41, __pyx_k_41, sizeof(__pyx_k_41), 0, 1, 0},
  {&__pyx_kp_write, __pyx_k_write, sizeof(__pyx_k_write), 1, 1, 1},
  {&__pyx_kp_close, __pyx_k_close, sizeof(__pyx_k_close), 1, 1, 1},
  {&__pyx_kp_allclose, __pyx_k_allclose, sizeof(__pyx_k_allclose), 1, 1, 1},
  {&__pyx_kp_array, __pyx_k_array, sizeof(__pyx_k_array), 1, 1, 1},
  {&__pyx_kp_shape, __pyx_k_shape, sizeof(__pyx_k_shape), 1, 1, 1},
  {&__pyx_kp_dtype, __pyx_k_dtype, sizeof(__pyx_k_dtype), 1, 1, 1},
  {&__pyx_kp_59, __pyx_k_59, sizeof(__pyx_k_59), 1, 1, 1},
  {&__pyx_kp_rect, __pyx_k_rect, sizeof(__pyx_k_rect), 1, 1, 1},
  {&__pyx_kp_f, __pyx_k_f, sizeof(__pyx_k_f), 1, 1, 1},
  {&__pyx_kp_c, __pyx_k_c, sizeof(__pyx_k_c), 1, 1, 1},
  {&__pyx_kp_k, __pyx_k_k, sizeof(__pyx_k_k), 1, 1, 1},
  {&__pyx_kp_astype, __pyx_k_astype, sizeof(__pyx_k_astype), 1, 1, 1},
  {&__pyx_kp_dual, __pyx_k_dual, sizeof(__pyx_k_dual), 1, 1, 1},
  {&__pyx_kp_svd, __pyx_k_svd, sizeof(__pyx_k_svd), 1, 1, 1},
  {&__pyx_kp_cam_ids, __pyx_k_cam_ids, sizeof(__pyx_k_cam_ids), 1, 1, 1},
  {&__pyx_kp_min, __pyx_k_min, sizeof(__pyx_k_min), 1, 1, 1},
  {&__pyx_kp_zeros, __pyx_k_zeros, sizeof(__pyx_k_zeros), 1, 1, 1},
  {&__pyx_kp_60, __pyx_k_60, sizeof(__pyx_k_60), 1, 1, 1},
  {&__pyx_kp_Pmat, __pyx_k_Pmat, sizeof(__pyx_k_Pmat), 1, 1, 1},
  {&__pyx_kp_enumerate, __pyx_k_enumerate, sizeof(__pyx_k_enumerate), 1, 1, 1},
  {&__pyx_kp_KeyError, __pyx_k_KeyError, sizeof(__pyx_k_KeyError), 1, 1, 1},
  {&__pyx_kp_62, __pyx_k_62, sizeof(__pyx_k_62), 1, 1, 1},
  {&__pyx_kp_extend, __pyx_k_extend, sizeof(__pyx_k_extend), 1, 1, 1},
  {&__pyx_kp_dot, __pyx_k_dot, sizeof(__pyx_k_dot), 1, 1, 1},
  {&__pyx_kp_isnan, __pyx_k_isnan, sizeof(__pyx_k_isnan), 1, 1, 1},
  {&__pyx_kp_full_matrices, __pyx_k_full_matrices, sizeof(__pyx_k_full_matrices), 1, 1, 1},
  {&__pyx_kp_linalg, __pyx_k_linalg, sizeof(__pyx_k_linalg), 1, 1, 1},
  {&__pyx_kp_LinAlgError, __pyx_k_LinAlgError, sizeof(__pyx_k_LinAlgError), 1, 1, 1},
  {&__pyx_kp_5, __pyx_k_5, sizeof(__pyx_k_5), 1, 0, 0},
  {&__pyx_kp_11, __pyx_k_11, sizeof(__pyx_k_11), 0, 0, 0},
  {&__pyx_kp_42, __pyx_k_42, sizeof(__pyx_k_42), 0, 0, 0},
  {&__pyx_kp_43, __pyx_k_43, sizeof(__pyx_k_43), 0, 0, 0},
  {&__pyx_kp_44, __pyx_k_44, sizeof(__pyx_k_44), 0, 0, 0},
  {&__pyx_kp_45, __pyx_k_45, sizeof(__pyx_k_45), 0, 0, 0},
  {&__pyx_kp_46, __pyx_k_46, sizeof(__pyx_k_46), 0, 0, 0},
  {&__pyx_kp_47, __pyx_k_47, sizeof(__pyx_k_47), 0, 0, 0},
  {&__pyx_kp_48, __pyx_k_48, sizeof(__pyx_k_48), 0, 0, 0},
  {&__pyx_kp_49, __pyx_k_49, sizeof(__pyx_k_49), 0, 0, 0},
  {&__pyx_kp_50, __pyx_k_50, sizeof(__pyx_k_50), 0, 0, 0},
  {&__pyx_kp_51, __pyx_k_51, sizeof(__pyx_k_51), 0, 0, 0},
  {&__pyx_kp_52, __pyx_k_52, sizeof(__pyx_k_52), 0, 0, 0},
  {&__pyx_kp_53, __pyx_k_53, sizeof(__pyx_k_53), 0, 0, 0},
  {&__pyx_kp_54, __pyx_k_54, sizeof(__pyx_k_54), 0, 0, 0},
  {&__pyx_kp_55, __pyx_k_55, sizeof(__pyx_k_55), 0, 0, 0},
  {&__pyx_kp_56, __pyx_k_56, sizeof(__pyx_k_56), 0, 0, 0},
  {&__pyx_kp_57, __pyx_k_57, sizeof(__pyx_k_57), 0, 0, 0},
  {&__pyx_kp_58, __pyx_k_58, sizeof(__pyx_k_58), 0, 0, 0},
  {&__pyx_kp_61, __pyx_k_61, sizeof(__pyx_k_61), 0, 0, 0},
  {&__pyx_kp_63, __pyx_k_63, sizeof(__pyx_k_63), 0, 0, 0},
  {&__pyx_kp_64, __pyx_k_64, sizeof(__pyx_k_64), 0, 0, 0},
  {&__pyx_kp_65, __pyx_k_65, sizeof(__pyx_k_65), 0, 0, 0},
  {&__pyx_kp_66, __pyx_k_66, sizeof(__pyx_k_66), 0, 0, 0},
  {&__pyx_kp_67, __pyx_k_67, sizeof(__pyx_k_67), 0, 0, 0},
  {&__pyx_kp_68, __pyx_k_68, sizeof(__pyx_k_68), 0, 0, 0},
  {0, 0, 0, 0, 0, 0}
};
static int __Pyx_InitCachedBuiltins(void) {
  __pyx_builtin_Exception = __Pyx_GetName(__pyx_b, __pyx_kp_Exception); if (!__pyx_builtin_Exception) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_execfile = __Pyx_GetName(__pyx_b, __pyx_kp_execfile); if (!__pyx_builtin_execfile) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 29; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_NotImplementedError = __Pyx_GetName(__pyx_b, __pyx_kp_NotImplementedError); if (!__pyx_builtin_NotImplementedError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 31; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_open = __Pyx_GetName(__pyx_b, __pyx_kp_open); if (!__pyx_builtin_open) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 93; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_min = __Pyx_GetName(__pyx_b, __pyx_kp_min); if (!__pyx_builtin_min) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 260; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_enumerate = __Pyx_GetName(__pyx_b, __pyx_kp_enumerate); if (!__pyx_builtin_enumerate) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 271; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_builtin_KeyError = __Pyx_GetName(__pyx_b, __pyx_kp_KeyError); if (!__pyx_builtin_KeyError) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  return 0;
  __pyx_L1_error:;
  return -1;
}

static int __Pyx_InitGlobals(void) {
  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_2 = PyInt_FromLong(2); if (unlikely(!__pyx_int_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_5 = PyInt_FromLong(5); if (unlikely(!__pyx_int_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_3 = PyInt_FromLong(3); if (unlikely(!__pyx_int_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_4 = PyInt_FromLong(4); if (unlikely(!__pyx_int_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  if (__Pyx_InitStrings(__pyx_string_tab) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  return 0;
  __pyx_L1_error:;
  return -1;
}

#if PY_MAJOR_VERSION < 3
PyMODINIT_FUNC initreconstruct_utils(void); /*proto*/
PyMODINIT_FUNC initreconstruct_utils(void)
#else
PyMODINIT_FUNC PyInit_reconstruct_utils(void); /*proto*/
PyMODINIT_FUNC PyInit_reconstruct_utils(void)
#endif
{
  PyObject *__pyx_1 = 0;
  PyObject *__pyx_2 = 0;
  double __pyx_3;
  float __pyx_4;
  PyObject *__pyx_5 = 0;
  __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Libary function declarations ---*/
  __pyx_init_filenames();
  /*--- Initialize various global constants etc. ---*/
  if (unlikely(__Pyx_InitGlobals() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  /*--- Module creation code ---*/
  #if PY_MAJOR_VERSION < 3
  __pyx_m = Py_InitModule4("reconstruct_utils", __pyx_methods, 0, 0, PYTHON_API_VERSION);
  #else
  __pyx_m = PyModule_Create(&__pyx_moduledef);
  #endif
  if (!__pyx_m) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  #if PY_MAJOR_VERSION < 3
  Py_INCREF(__pyx_m);
  #endif
  __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME);
  if (!__pyx_b) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;};
  /*--- Builtin init code ---*/
  if (unlikely(__Pyx_InitCachedBuiltins() < 0)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_skip_dispatch = 0;
  /*--- Global init code ---*/
  /*--- Function export code ---*/
  /*--- Type init code ---*/
  if (PyType_Ready(&__pyx_type_17reconstruct_utils_ReconstructHelper) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyObject_SetAttrString(__pyx_m, "ReconstructHelper", (PyObject *)&__pyx_type_17reconstruct_utils_ReconstructHelper) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 51; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_ptype_17reconstruct_utils_ReconstructHelper = &__pyx_type_17reconstruct_utils_ReconstructHelper;
  /*--- Type import code ---*/
  /*--- Function import code ---*/
  /*--- Execution code ---*/

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":5
 * #cimport c_lib
 * 
 * import numpy             # <<<<<<<<<<<<<<
 * import numpy.dual
 * inf = numpy.inf
 */
  __pyx_1 = __Pyx_Import(__pyx_kp_numpy, 0); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_numpy, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 5; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":6
 * 
 * import numpy
 * import numpy.dual             # <<<<<<<<<<<<<<
 * inf = numpy.inf
 * 
 */
  __pyx_1 = __Pyx_Import(__pyx_kp_1, 0); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_numpy, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 6; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":7
 * import numpy
 * import numpy.dual
 * inf = numpy.inf             # <<<<<<<<<<<<<<
 * 
 * cdef double cinf
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_numpy); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_inf); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_inf, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 7; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":10
 * 
 * cdef double cinf
 * cinf = inf             # <<<<<<<<<<<<<<
 * 
 * import flydra.common_variables
 */
  __pyx_1 = __Pyx_GetName(__pyx_m, __pyx_kp_inf); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_3 = __pyx_PyFloat_AsDouble(__pyx_1); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 10; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_v_17reconstruct_utils_cinf = __pyx_3;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":12
 * cinf = inf
 * 
 * import flydra.common_variables             # <<<<<<<<<<<<<<
 * import flydra.undistort
 * import xml.etree.ElementTree as ET
 */
  __pyx_2 = __Pyx_Import(__pyx_kp_2, 0); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_flydra, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 12; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":13
 * 
 * import flydra.common_variables
 * import flydra.undistort             # <<<<<<<<<<<<<<
 * import xml.etree.ElementTree as ET
 * 
 */
  __pyx_1 = __Pyx_Import(__pyx_kp_3, 0); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_flydra, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 13; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":14
 * import flydra.common_variables
 * import flydra.undistort
 * import xml.etree.ElementTree as ET             # <<<<<<<<<<<<<<
 * 
 * cdef float MINIMUM_ECCENTRICITY
 */
  __pyx_2 = PyList_New(1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 14; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_kp_5);
  PyList_SET_ITEM(__pyx_2, 0, __pyx_kp_5);
  __pyx_1 = __Pyx_Import(__pyx_kp_4, ((PyObject *)__pyx_2)); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 14; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_ET, __pyx_1) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 14; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":17
 * 
 * cdef float MINIMUM_ECCENTRICITY
 * MINIMUM_ECCENTRICITY = flydra.common_variables.MINIMUM_ECCENTRICITY             # <<<<<<<<<<<<<<
 * 
 * class NoAcceptablePointFound(Exception):
 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_flydra); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 17; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_1 = PyObject_GetAttr(__pyx_2, __pyx_kp_common_variables); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 17; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_2 = PyObject_GetAttr(__pyx_1, __pyx_kp_6); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 17; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_1); __pyx_1 = 0;
  __pyx_4 = __pyx_PyFloat_AsDouble(__pyx_2); if (unlikely(PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 17; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  __pyx_v_17reconstruct_utils_MINIMUM_ECCENTRICITY = __pyx_4;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":19
 * MINIMUM_ECCENTRICITY = flydra.common_variables.MINIMUM_ECCENTRICITY
 * 
 * class NoAcceptablePointFound(Exception):             # <<<<<<<<<<<<<<
 *     pass
 * 
 */
  __pyx_1 = PyDict_New(); if (unlikely(!__pyx_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  __pyx_2 = PyTuple_New(1); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_INCREF(__pyx_builtin_Exception);
  PyTuple_SET_ITEM(__pyx_2, 0, __pyx_builtin_Exception);
  __pyx_5 = __Pyx_CreateClass(((PyObject *)__pyx_2), ((PyObject *)__pyx_1), __pyx_kp_7, "reconstruct_utils"); if (unlikely(!__pyx_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(((PyObject *)__pyx_2)); __pyx_2 = 0;
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_7, __pyx_5) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 19; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_5); __pyx_5 = 0;
  Py_DECREF(((PyObject *)__pyx_1)); __pyx_1 = 0;

  /* "/home/aza/src/kookaburra/flydra/src/reconstruct_utils.pyx":474
 * ##                     dst[u*cn + i] = 0
 * 
 * find_best_3d = hypothesis_testing_algorithm__find_best_3d # old name             # <<<<<<<<<<<<<<
 */
  __pyx_2 = __Pyx_GetName(__pyx_m, __pyx_kp_8); if (unlikely(!__pyx_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  if (PyObject_SetAttr(__pyx_m, __pyx_kp_9, __pyx_2) < 0) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 474; __pyx_clineno = __LINE__; goto __pyx_L1_error;}
  Py_DECREF(__pyx_2); __pyx_2 = 0;
  #if PY_MAJOR_VERSION < 3
  return;
  #else
  return __pyx_m;
  #endif
  __pyx_L1_error:;
  Py_XDECREF(__pyx_1);
  Py_XDECREF(__pyx_2);
  Py_XDECREF(__pyx_5);
  __Pyx_AddTraceback("reconstruct_utils");
  #if PY_MAJOR_VERSION >= 3
  return NULL;
  #endif
}

static const char *__pyx_filenames[] = {
  "reconstruct_utils.pyx",
};

/* Runtime support code */

static void __pyx_init_filenames(void) {
  __pyx_f = __pyx_filenames;
}

static INLINE int __Pyx_SplitStarArg(
    PyObject **args, 
    Py_ssize_t nargs,
    PyObject **args2)
{
    PyObject *args1 = 0;
    args1 = PyTuple_GetSlice(*args, 0, nargs);
    if (!args1) {
        *args2 = 0;
        return -1;
    }
    *args2 = PyTuple_GetSlice(*args, nargs, PyTuple_GET_SIZE(*args));
    if (!*args2) {
        Py_DECREF(args1);
        return -1;
    }
    *args = args1;
    return 0;
}

static int __Pyx_CheckKeywordStrings(
    PyObject *kwdict,
    const char* function_name,
    int kw_allowed)
{
    PyObject* key = 0;
    Py_ssize_t pos = 0;
    while (PyDict_Next(kwdict, &pos, &key, 0)) {
        #if PY_MAJOR_VERSION < 3
        if (unlikely(!PyString_Check(key))) {
        #else
        if (unlikely(!PyUnicode_Check(key))) {
        #endif
            PyErr_Format(PyExc_TypeError,
                         "%s() keywords must be strings", function_name);
            return 0;
        }
    }
    if (unlikely(!kw_allowed) && unlikely(key)) {
        PyErr_Format(PyExc_TypeError,
        #if PY_MAJOR_VERSION < 3
                     "'%s' is an invalid keyword argument for this function",
                     PyString_AsString(key));
        #else
                     "'%U' is an invalid keyword argument for this function",
                     key);
        #endif
        return 0;
    }
    return 1;
}

static INLINE void __Pyx_RaiseArgtupleTooLong(
    Py_ssize_t num_expected,
    Py_ssize_t num_found)
{
    const char* error_message =
    #if PY_VERSION_HEX < 0x02050000
        "function takes at most %d positional arguments (%d given)";
    #else
        "function takes at most %zd positional arguments (%zd given)";
    #endif
    PyErr_Format(PyExc_TypeError, error_message, num_expected, num_found);
}

static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list) {
    PyObject *__import__ = 0;
    PyObject *empty_list = 0;
    PyObject *module = 0;
    PyObject *global_dict = 0;
    PyObject *empty_dict = 0;
    PyObject *list;
    __import__ = PyObject_GetAttrString(__pyx_b, "__import__");
    if (!__import__)
        goto bad;
    if (from_list)
        list = from_list;
    else {
        empty_list = PyList_New(0);
        if (!empty_list)
            goto bad;
        list = empty_list;
    }
    global_dict = PyModule_GetDict(__pyx_m);
    if (!global_dict)
        goto bad;
    empty_dict = PyDict_New();
    if (!empty_dict)
        goto bad;
    module = PyObject_CallFunction(__import__, "OOOO",
        name, global_dict, empty_dict, list);
bad:
    Py_XDECREF(empty_list);
    Py_XDECREF(__import__);
    Py_XDECREF(empty_dict);
    return module;
}

static PyObject *__Pyx_GetName(PyObject *dict, PyObject *name) {
    PyObject *result;
    result = PyObject_GetAttr(dict, name);
    if (!result)
        PyErr_SetObject(PyExc_NameError, name);
    return result;
}

static PyObject *__Pyx_CreateClass(
    PyObject *bases, PyObject *dict, PyObject *name, char *modname)
{
    PyObject *py_modname;
    PyObject *result = 0;

    #if PY_MAJOR_VERSION < 3
    py_modname = PyString_FromString(modname);
    #else
    py_modname = PyUnicode_FromString(modname);
    #endif
    if (!py_modname)
        goto bad;
    if (PyDict_SetItemString(dict, "__module__", py_modname) < 0)
        goto bad;
    #if PY_MAJOR_VERSION < 3
    result = PyClass_New(bases, dict, name);
    #else
    result = PyObject_CallFunctionObjArgs((PyObject *)&PyType_Type, name, bases, dict, NULL);
    #endif
bad:
    Py_XDECREF(py_modname);
    return result;
}

static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb) {
    Py_XINCREF(type);
    Py_XINCREF(value);
    Py_XINCREF(tb);
    /* First, check the traceback argument, replacing None with NULL. */
    if (tb == Py_None) {
        Py_DECREF(tb);
        tb = 0;
    }
    else if (tb != NULL && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto raise_error;
    }
    /* Next, replace a missing value with None */
    if (value == NULL) {
        value = Py_None;
        Py_INCREF(value);
    }
    #if PY_VERSION_HEX < 0x02050000
    if (!PyClass_Check(type))
    #else
    if (!PyType_Check(type))
    #endif
    {
        /* Raising an instance.  The value should be a dummy. */
        if (value != Py_None) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        /* Normalize to raise <class>, <instance> */
        Py_DECREF(value);
        value = type;
        #if PY_VERSION_HEX < 0x02050000
            if (PyInstance_Check(type)) {
                type = (PyObject*) ((PyInstanceObject*)type)->in_class;
                Py_INCREF(type);
            }
            else {
                type = 0;
                PyErr_SetString(PyExc_TypeError,
                    "raise: exception must be an old-style class or instance");
                goto raise_error;
            }
        #else
            type = (PyObject*) Py_TYPE(type);
            Py_INCREF(type);
            if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
                PyErr_SetString(PyExc_TypeError,
                    "raise: exception class must be a subclass of BaseException");
                goto raise_error;
            }
        #endif
    }
    PyErr_Restore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}

static PyObject *__Pyx_UnpackItem(PyObject *iter, Py_ssize_t index) {
    PyObject *item;
    if (!(item = PyIter_Next(iter))) {
        if (!PyErr_Occurred()) {
            PyErr_Format(PyExc_ValueError,
                #if PY_VERSION_HEX < 0x02050000
                    "need more than %d values to unpack", (int)index);
                #else
                    "need more than %zd values to unpack", index);
                #endif
        }
    }
    return item;
}

static int __Pyx_EndUnpack(PyObject *iter) {
    PyObject *item;
    if ((item = PyIter_Next(iter))) {
        Py_DECREF(item);
        PyErr_SetString(PyExc_ValueError, "too many values to unpack");
        return -1;
    }
    else if (!PyErr_Occurred())
        return 0;
    else
        return -1;
}

static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyThreadState *tstate = PyThreadState_Get();
    PyErr_Fetch(type, value, tb);
    PyErr_NormalizeException(type, value, tb);
    if (PyErr_Occurred())
        goto bad;
    Py_INCREF(*type);
    Py_INCREF(*value);
    Py_INCREF(*tb);
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = *type;
    tstate->exc_value = *value;
    tstate->exc_traceback = *tb;
    /* Make sure tstate is in a consistent state when we XDECREF
    these objects (XDECREF may run arbitrary code). */
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
    return 0;
bad:
    Py_XDECREF(*type);
    Py_XDECREF(*value);
    Py_XDECREF(*tb);
    return -1;
}



#if PY_MAJOR_VERSION < 3
static PyObject *__Pyx_GetStdout(void) {
    PyObject *f = PySys_GetObject("stdout");
    if (!f) {
        PyErr_SetString(PyExc_RuntimeError, "lost sys.stdout");
    }
    return f;
}

static int __Pyx_Print(PyObject *arg_tuple, int newline) {
    PyObject *f;
    PyObject* v;
    int i;
    
    if (!(f = __Pyx_GetStdout()))
        return -1;
    for (i=0; i < PyTuple_GET_SIZE(arg_tuple); i++) {
        if (PyFile_SoftSpace(f, 1)) {
            if (PyFile_WriteString(" ", f) < 0)
                return -1;
        }
        v = PyTuple_GET_ITEM(arg_tuple, i);
        if (PyFile_WriteObject(v, f, Py_PRINT_RAW) < 0)
            return -1;
        if (PyString_Check(v)) {
            char *s = PyString_AsString(v);
            Py_ssize_t len = PyString_Size(v);
            if (len > 0 &&
                isspace(Py_CHARMASK(s[len-1])) &&
                s[len-1] != ' ')
                    PyFile_SoftSpace(f, 0);
        }
    }
    if (newline) {
        if (PyFile_WriteString("\n", f) < 0)
            return -1;
        PyFile_SoftSpace(f, 0);
    }
    return 0;
}

#else /* Python 3 has a print function */
static int __Pyx_Print(PyObject *arg_tuple, int newline) {
    PyObject* kwargs = 0;
    PyObject* result = 0;
    PyObject* end_string;
    if (!__pyx_print) {
        __pyx_print = PyObject_GetAttrString(__pyx_b, "print");
        if (!__pyx_print)
            return -1;
    }
    if (!newline) {
        if (!__pyx_print_kwargs) {
            __pyx_print_kwargs = PyDict_New();
            if (!__pyx_print_kwargs)
                return -1;
            end_string = PyUnicode_FromStringAndSize(" ", 1);
            if (!end_string)
                return -1;
            if (PyDict_SetItemString(__pyx_print_kwargs, "end", end_string) < 0) {
                Py_DECREF(end_string);
                return -1;
            }
            Py_DECREF(end_string);
        }
        kwargs = __pyx_print_kwargs;
    }
    result = PyObject_Call(__pyx_print, arg_tuple, kwargs);
    if (!result)
        return -1;
    Py_DECREF(result);
    return 0;
}
#endif


#include "compile.h"
#include "frameobject.h"
#include "traceback.h"

static void __Pyx_AddTraceback(const char *funcname) {
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    PyObject *py_globals = 0;
    PyObject *empty_string = 0;
    PyCodeObject *py_code = 0;
    PyFrameObject *py_frame = 0;

    #if PY_MAJOR_VERSION < 3
    py_srcfile = PyString_FromString(__pyx_filename);
    #else
    py_srcfile = PyUnicode_FromString(__pyx_filename);
    #endif
    if (!py_srcfile) goto bad;
    if (__pyx_clineno) {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, __pyx_clineno);
        #else
        py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, __pyx_clineno);
        #endif
    }
    else {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromString(funcname);
        #else
        py_funcname = PyUnicode_FromString(funcname);
        #endif
    }
    if (!py_funcname) goto bad;
    py_globals = PyModule_GetDict(__pyx_m);
    if (!py_globals) goto bad;
    #if PY_MAJOR_VERSION < 3
    empty_string = PyString_FromStringAndSize("", 0);
    #else
    empty_string = PyBytes_FromStringAndSize("", 0);
    #endif
    if (!empty_string) goto bad;
    py_code = PyCode_New(
        0,            /*int argcount,*/
        #if PY_MAJOR_VERSION >= 3
        0,            /*int kwonlyargcount,*/
        #endif
        0,            /*int nlocals,*/
        0,            /*int stacksize,*/
        0,            /*int flags,*/
        empty_string, /*PyObject *code,*/
        __pyx_empty_tuple,  /*PyObject *consts,*/
        __pyx_empty_tuple,  /*PyObject *names,*/
        __pyx_empty_tuple,  /*PyObject *varnames,*/
        __pyx_empty_tuple,  /*PyObject *freevars,*/
        __pyx_empty_tuple,  /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        __pyx_lineno,   /*int firstlineno,*/
        empty_string  /*PyObject *lnotab*/
    );
    if (!py_code) goto bad;
    py_frame = PyFrame_New(
        PyThreadState_Get(), /*PyThreadState *tstate,*/
        py_code,             /*PyCodeObject *code,*/
        py_globals,          /*PyObject *globals,*/
        0                    /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    py_frame->f_lineno = __pyx_lineno;
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
    Py_XDECREF(empty_string);
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}

static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        #if PY_MAJOR_VERSION < 3
        if (t->is_unicode && (!t->is_identifier)) {
            *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
        } else if (t->intern) {
            *t->p = PyString_InternFromString(t->s);
        } else {
            *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        }
        #else  /* Python 3+ has unicode identifiers */
        if (t->is_identifier || (t->is_unicode && t->intern)) {
            *t->p = PyUnicode_InternFromString(t->s);
        } else if (t->is_unicode) {
            *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
        } else {
            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
        }
        #endif
        if (!*t->p)
            return -1;
        ++t;
    }
    return 0;
}

/* Type Conversion Functions */

static INLINE Py_ssize_t __pyx_PyIndex_AsSsize_t(PyObject* b) {
  Py_ssize_t ival;
  PyObject* x = PyNumber_Index(b);
  if (!x) return -1;
  ival = PyInt_AsSsize_t(x);
  Py_DECREF(x);
  return ival;
}

static INLINE int __Pyx_PyObject_IsTrue(PyObject* x) {
   if (x == Py_True) return 1;
   else if (x == Py_False) return 0;
   else return PyObject_IsTrue(x);
}

static INLINE PY_LONG_LONG __pyx_PyInt_AsLongLong(PyObject* x) {
    if (PyInt_CheckExact(x)) {
        return PyInt_AS_LONG(x);
    }
    else if (PyLong_CheckExact(x)) {
        return PyLong_AsLongLong(x);
    }
    else {
        PY_LONG_LONG val;
        PyObject* tmp = PyNumber_Int(x); if (!tmp) return (PY_LONG_LONG)-1;
        val = __pyx_PyInt_AsLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}

static INLINE unsigned PY_LONG_LONG __pyx_PyInt_AsUnsignedLongLong(PyObject* x) {
    if (PyInt_CheckExact(x)) {
        long val = PyInt_AS_LONG(x);
        if (unlikely(val < 0)) {
            PyErr_SetString(PyExc_TypeError, "Negative assignment to unsigned type.");
            return (unsigned PY_LONG_LONG)-1;
        }
        return val;
    }
    else if (PyLong_CheckExact(x)) {
        return PyLong_AsUnsignedLongLong(x);
    }
    else {
        PY_LONG_LONG val;
        PyObject* tmp = PyNumber_Int(x); if (!tmp) return (PY_LONG_LONG)-1;
        val = __pyx_PyInt_AsUnsignedLongLong(tmp);
        Py_DECREF(tmp);
        return val;
    }
}


static INLINE unsigned char __pyx_PyInt_unsigned_char(PyObject* x) {
    if (sizeof(unsigned char) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        unsigned char val = (unsigned char)long_val;
        if (unlikely((val != long_val)  || (long_val < 0))) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to unsigned char");
            return (unsigned char)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE unsigned short __pyx_PyInt_unsigned_short(PyObject* x) {
    if (sizeof(unsigned short) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        unsigned short val = (unsigned short)long_val;
        if (unlikely((val != long_val)  || (long_val < 0))) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to unsigned short");
            return (unsigned short)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE char __pyx_PyInt_char(PyObject* x) {
    if (sizeof(char) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        char val = (char)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to char");
            return (char)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE short __pyx_PyInt_short(PyObject* x) {
    if (sizeof(short) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        short val = (short)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to short");
            return (short)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE int __pyx_PyInt_int(PyObject* x) {
    if (sizeof(int) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        int val = (int)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to int");
            return (int)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE long __pyx_PyInt_long(PyObject* x) {
    if (sizeof(long) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        long val = (long)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to long");
            return (long)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE signed char __pyx_PyInt_signed_char(PyObject* x) {
    if (sizeof(signed char) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        signed char val = (signed char)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to signed char");
            return (signed char)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE signed short __pyx_PyInt_signed_short(PyObject* x) {
    if (sizeof(signed short) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        signed short val = (signed short)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to signed short");
            return (signed short)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE signed int __pyx_PyInt_signed_int(PyObject* x) {
    if (sizeof(signed int) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        signed int val = (signed int)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to signed int");
            return (signed int)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE signed long __pyx_PyInt_signed_long(PyObject* x) {
    if (sizeof(signed long) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        signed long val = (signed long)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to signed long");
            return (signed long)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

static INLINE long double __pyx_PyInt_long_double(PyObject* x) {
    if (sizeof(long double) < sizeof(long)) {
        long long_val = __pyx_PyInt_AsLong(x);
        long double val = (long double)long_val;
        if (unlikely((val != long_val) )) {
            PyErr_SetString(PyExc_OverflowError, "value too large to convert to long double");
            return (long double)-1;
        }
        return val;
    }
    else {
        return __pyx_PyInt_AsLong(x);
    }
}

