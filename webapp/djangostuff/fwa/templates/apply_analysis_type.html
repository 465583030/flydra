{% extends "site_base.html" %}

{% load i18n %}

{% block head_title %}Apply analysis type - {{name}}{% endblock %}

{% block extra_head %}
<script src="/site_media/static/pinax/js/jquery-1.3.2.min.js" type="text/javascript"></script>
<script src="/site_media/static/fwa/js/couch.js" type="text/javascript"></script>
{% endblock %}

{% block tab_id %}id="home_tab"{% endblock %}

{% block body %}

<h2>Apply analysis type - {{name}}</h2>

<div id="parent-datanode-selection">
</div>

<script>

function ads_selector_escape(str) {
  return str.replace(" ","-");
}

function load_datanodes( db, parent_dom_node, node_type ) {
    var dom_node = parent_dom_node.find("#"+ads_selector_escape(node_type));
    dom_node.append( node_type + ": " + db.info().doc_count + " documents" );
}

function load_parents() {

{% autoescape off %}
    var dbname = {{dbname_json}};
    var parent_node_types = {{parent_node_types_json}};
{% endautoescape %}

    // requires couch.js from CouchDB share/www/script
    CouchDB.host = window.location.host;
    CouchDB.inBrowser = true;
    CouchDB.urlPrefix = "/analysis/couch-proxy/";

    var db = new CouchDB( dbname );

    var dom_node = $("#parent-datanode-selection");

    dbv = CouchDB.getVersion();
    dom_node.append("Couch version "+dbv+"\n");

    //dom_node.replaceWith("");
    for (var i in parent_node_types) {
        dom_node.append("<div id=\"" + ads_selector_escape(parent_node_types[i]) + "\"></div>");
        nodes = load_datanodes( db, dom_node, parent_node_types[i] );
    }
}
$(document).ready(load_parents);
</script>

{% endblock %}
